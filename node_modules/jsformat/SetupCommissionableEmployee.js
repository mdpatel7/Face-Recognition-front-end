var ddlsectarget = '#cscl';
var ddlsource = '#cmcd';
var ddltarget = '#cmcd1';
var url = './../CommissionableEmployee/GetCommissionRoleList';
$('.ddlcommrole').change(function () {
var row = $(this).closest('tr');
var value = row.find('#comschcode').val();
var newddl = row.find('.ScheduleCode');
var type = $(this).val();
var url = './../CommissionableEmployee/GetScheduleCodeList';
var ddlsource = this;
var editddlid = 'ScheduleCode';
$.getJSON(url, { commroleid: type }, function (data, Desc) {
newddl += '<select class="' + editddlid + '"><option value="">--Select--</option>';
$.each(data, function (index, optionData) {
newddl += '<option value="' + optionData.Value + '">' + optionData.Text + '</option>';
});
newddl += '</select>';
row.find('#colcommsch').html(newddl);
});
});
$('.ddlcommrole').change(function () {
role = $(this).val();
var row = $(this).closest('tr');
var empid = row.find('#item_EmployeeId').val();
var id = row.find('#item_CommissionableEmployeeId').val();
var URL = './../CommissionableEmployee/UpdateCommissionSchedule';
$.ajax({
type: 'Post',
url: URL,
data: {
id: id,
commissionrole: role,
empid: empid
},
success: function (result) {
if (result.Msg == 'Duplicate') {
row.find('input[id*=cbxPrimary]').attr('checked', false);
row.find('input[id*=cbxPrimary]').removeAttr('disabled');
}
else if (result.Msg == 'NA') {
row.find('input[id*=cbxPrimary]').attr('checked', true);
row.find('input[id*=cbxPrimary]').attr('disabled', 'disabled');
}
else {
ShowAlertMessageEmployee('Commission for the user with this role already exists. Please select another commission role.');
$('#alertHidden').val('');
row.find('.ddlcommrole').val(row.find('#CommissionRole').val());
}
},
error: function (error) {

}
});
});
$('.popupContactClose').click(function () {
popupdisable('#backgroundsearch', '#vieweditComisssion');
});
$('.ScheduleCode').change(function () {
var value = $(this).val();
var row = $(this).closest('tr');
var id = row.find('#item_CommissionableEmployeeId').val();
var URL = './../CommissionableEmployee/UpdateCommissionScheduleCodeID';
$.ajax({
type: 'Post',
url: URL,
data: {
id: id,
CommissionSchedulecodeID: value
},
success: function (result) {

},
error: function (error) {

}
});
});
$('.split1').blur(function () {
var val = 0;
var row = $(this).closest('tr');
$('[class=split1]').each(function () {
var val1 = 0;
if ($(this).val().length > 0) {
val1 = 0;
val1 = $(this).val();
val += parseInt(val1);
}
else {
$(this).val(0.00);
}
});
if ($(this).val() > 100) {
ShowAlertMessage('Split can\'t be more than 100. Update canceled.');
$(this).val('');
$('#alertHidden').val('#' + row.find('.split1').attr('id'));
return;
}
if (val > 100) {
ShowAlertMessage('Total commission % cannot be more than 100. Update canceled.');
$(this).val('');
$('#alertHidden').val('#' + row.find('.split1').attr('id'));
return;
}
var URL = './../CommissionableEmployee/UpdateSplit';
var value = $(this).val();
var commempid = row.find('#item_CommissionableEmployeeId').val();
$.ajax({
type: 'Post',
url: URL,
data: {
id: commempid,
split: value
},
success: function (result) {

},
error: function (error) {

}
});
});
$('.split1, #splt').live('change', function () {
$(this).val(addDecimalPointIfNot($(this).val()));
});
$('.split1, #splt').live('keypress', function (event) {
if (event.keyCode == '39') {
return false;
}
else {
return validatedecimaluserdefined(event, this, 3, 2);
}
});
$('.titleNone').hide();
$('#alertcommok, #alert_comm').click(function () {
popupdisable('#alert_comm', '#alertPOp_commission');
$('#cmcd1').focus();
$('#cmcd1').after('<div class="ErrorDiv" style="position:absolute; color:red; padding:8px 0px;">Select some value for Commission Role.</div>');
$('#cmcd1').addClass('error');
});
$('#btn_delete').live('click', function (e) {
if ($(this).attr('disabled') == false || $(this).attr('disabled') == undefined) {
var btn = $(this);
var row = btn.closest('tr');
var id = row.find('#hidden_commempid').val();
$('#rowIDEmployee').val(id);
centrpop('#popupDeleteEmpCommission');
popupload('#backgroundPopupDelete', '#popupDeleteEmpCommission');
}
});
$('#btncommVoucher').click(function () {
$('#LoadingInProgress').show();
var URL = './../CommissionableEmployee/ViewEditCommissionVoucher';
$.ajax({
type: 'Post',
url: URL,
success: function (result) {
$('#contactAreaCommission').html(result);
centrpop('#vieweditComisssion');
popupload('#backgroundsearch', '#vieweditComisssion');
$('#LoadingInProgress').hide();
},
error: function (error) {
$('#LoadingInProgress').hide();
}
});
});
$('#btnNoDeleteEmpCommission, #delCrossBtn').click(function () {
popupdisable('#backgroundPopupDelete', '#popupDeleteEmpCommission');
});
$('#btnYesDeleteEmpCommission').click(function () {
var id = $('#rowIDEmployee').val();
$.ajax({
url: './../CommissionableEmployee/DeleteCommissionEmployee',
type: 'Post',
cache: false,
data: { commempid: id },
success: function (result) {
var deskid = $('#HiddenDeskID').val();
var URL = './../CommissionableEmployee/SetupCommissionableEmployee';
$.ajax({
type: 'Post',
url: URL,
data: {
id: deskid
},
success: function (result) {
$('.finance_contr').hide();
$('#Internaldropdownpage').show();
$('#Internaldropdownpage').html('');
$('#Internaldropdownpage').html(result);

}
});

},
error: function (error) {

}
});



popupdisable('#backgroundPopupDelete', '#popupDeleteEmpCommission');
});
$('#cmcd').change(function (event) {
$.ajax({
url: './../SetupCommissionCode/GetEmployeeDetails',
type: 'Post',
data: {
empid: $('#cmcd').val()
},
success: function (result) {

$.getJSON(url, { empid: $('#cmcd').val() }, function (data, Desc) {
$(ddltarget).empty();
$(ddlsectarget).empty();
$(ddlsectarget).append('<option value=" ">--Select--</option>');
$(ddltarget).removeAttr('disabled');
$(ddltarget).append('<option value=" ">--Select--</option>');
$.each(data.commissionrolelist, function (index, optionData) {
$(ddltarget).append('<option value="' + optionData.Value + '">' + optionData.Text + '</option>');
});
$(ddltarget).val(data.defaultvalue);

if (data.defaultvalue != '' && data.defaultvalue != undefined) {
Getschedulecodelist(data.defaultvalue);
$('.ErrorDiv').html('');

}
});
}
});
setTimeout(function () {
checkRequiredFields();
}, 500);
});
$('#cmcd1').change(function (e) {
var value = $(this).val();
Getschedulecodelist(value);

GetAllDetails();
if ($('#cmcd1').val() == '' || $('#cmcd1').val() == ' ') {
$('.ErrorDiv').html('');
$('input, select').removeClass('error');
$('#cmcd1').after('<div class="ErrorDiv" style="position:absolute; color:red; padding:8px 0px;">Select some value for Commission Role.</div>');
$('#cmcd1').addClass('error');
return false;
}
else {
$('#cmcd1').removeClass('error');
$('.ErrorDiv').html('');
}
$('#splt').focus();
});
$('#commisnd').live('click', function () {
var val = $(this).val();
var row = $(this).closest('tr');
row.find('#colcommisnd').html('');
var innerhtml = '<select name="commisnd" id="editcommisnd"><option value="">--Select--</option>';
innerhtml += '<option value="Y">Y</option>';
innerhtml += ' <option value="N">N</option>';
innerhtml += ' </select>';
row.find('#colcommisnd').html(innerhtml);
row.find('#editcommisnd').val(val);
});
$('#comschcode').live('click', function (ev) {
ev.preventDefault();
var row = $(this).closest('tr');
var value = $(this).val();
var newddl = '';
var type = row.find('#temp1').val();
var url = './../CommissionableEmployee/GetScheduleCodeList';
var editddlid = 'ScheduleCode';
$.getJSON(url, { commroleid: type }, function (data, Desc) {
newddl += '<select class="' + editddlid + '"><option value="">--Select--</option>';
$.each(data, function (index, optionData) {
newddl += '<option value="' + optionData.Value + '">' + optionData.Text + '</option>';
});
newddl += '</select>';
row.find('#colcommsch').html(newddl)
row.find('.ScheduleCode').each(function () {
$('option', this).each(function () {
if ($(this).text() == value) {
$(this).attr('selected', 'selected');
}
});
});

});
});
$('#cscl, #ddlcommisnd').live('change', function (event) {
checkRequiredFields();
});
$('#editcommisnd').live('blur', function () {
var row = $(this).closest('tr');
var commempid = row.find('#item_CommissionableEmployeeId').val();
var URL = './../CommissionableEmployee/EditEmployeeCommissioned';
$.ajax({
type: 'Post',
url: URL,
data: {
id: commempid,
isCommissioned: $(this).val()

},
success: function (result) {
var innerhtml = '<input type="text" value="' + result.Msg + '" name="item.Commissioned" id="commisnd">';
row.find('#colcommisnd').html(innerhtml);
},
error: function (error) {

}
});
});
$('#intopt').change(function (e) {
if ($('#intopt').val() == 'CommissionableEmployee') {
$('#table_CommissionSchedule').show();
}
if ($('#intopt').val() == 'BookDeal') {
$('#table_CommissionSchedule').hide();
}
});
$('#splt').bind('focusout', function (event) {
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
if (($('#cmcd').val() == '' || $('#cmcd').val() == ' ') && ($('#cmcd1').val() == '' || $('#cmcd1').val() == ' ') && ($('#cscl').val() == '' || $('#cscl').val() == ' ')
&& ($('#ddlcommisnd').val() == '' || $('#ddlcommisnd').val() == ' ') && ($('#splt').val() == '0.00')) {
return;
}
else {
if (checkRequiredFields() == false) {
return false;
}
if (($('#splt').val()) * 1 > 100) {
ShowAlertMessage('Split can\'t be more than 100. Please revise it.');
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
$('#splt').val('0.00');
$('#alertHidden').val('#splt');
return false;
}
setTimeout(function () {
var isCheckedPrimary = false;
if ($('#cbxNewPrimary').is(':checked')) {
isCheckedPrimary = true;
}

$.ajax({
url: './../CommissionableEmployee/GetTotalSplit',
type: 'Post',
success: function (result) {
if ((result.Msg * 1 + $('#splt').val() * 1) > 100) {
ShowAlertMessage('Total commission % cannot be more than 100. Please revise it.');
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
$('#splt').val('0.00');
$('#alertHidden').val('#splt');
}
else {
$.ajax({
type: 'POST',
url: './../CommissionableEmployee/AddCommissionEmployee',
beforeSend: function () {
$('#EmpProgress').show();
},
data: {
EmployeeId: $('#cmcd').val(),
CommissionRole: $('#cmcd1').val(),
CommissionScheduleId: $('#cscl').val(),
Commissioned: $('#ddlcommisnd').val(),
Split: $('#splt').val(),
IsPrimary: isCheckedPrimary
},
success: function (result) {
$('#EmpProgress').hide();
if (result.Msg == 'success') {
var URL = './../CommissionableEmployee/SetupCommissionableEmployee?id=11';
$.ajax({
type: 'Post',
url: URL,
success: function (result) {
$('#Internaldropdownpage').html('');
$('.finance_contr').hide();
$('#Internaldropdownpage').show();
$('#Internaldropdownpage').html(result);
}
});
}
if (result.Msg == 'duplicate') {
ShowAlertMessageEmployee('The Employee with the same Commission Role is already selected. Please select another commission role and try again.');
$('#alertHidden').val('#splt');
$('#cmcd1').val(' ');
$('#cscl').empty();
$('#cscl').append('<option value=" ">--Select--</option>');
$('#ddlcommisnd').val('');
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
$('#splt').val('0.00');
}
}
});
}
}
});
}, 2000);
}
});
$('#splt').live('blur', function (event) {
checkRequiredFields();
});
$('a').each(function () { $(this).attr('tabindex', '-1'); }) //making the tabindex -1 for all a tag to avoid tabing.
$('input, select, textarea').live('keydown', function (e) {
if (e.keyCode == 13) {
var focusable, next;
focusable = $('body').find('input:not([readonly="readonly"]),a,select,button,textarea').filter(':visible');
next = focusable.eq(focusable.index(this) + 1);
if (next.length) {
var disable = next.attr('disabled');
var readonly = next.attr("readonly");
if (disable == 'disabled' || readonly == "readonly") { return; }
else {
if (document.activeElement.type != "button" && document.activeElement.type != "submit") {
event.keyCode = 9; //trigger tab
}
}

}
}
});
$('input[id*=cbxPrimary]').click(function () {
var row = $(this).closest('tr');
var commempid = row.find('#item_CommissionableEmployeeId').val();
var isCheckedPrimary = false;
if ($(this).is(':checked')) {
isCheckedPrimary = true;
}
var URL = './../CommissionableEmployee/EditPrimaryIndicator';
$.ajax({
type: 'Post',
url: URL,
data: {
id: commempid,
isCheckedPrimary: isCheckedPrimary
},
success: function (result) {
if (result.Msg == 'true') {
var URL = './../CommissionableEmployee/SetupCommissionableEmployee?id=11';
$.ajax({
type: 'Post',
url: URL,
success: function (result) {
$('#Internaldropdownpage').html('');
$('.finance_contr').hide();
$('#Internaldropdownpage').show();
$('#Internaldropdownpage').html(result);
}
});
}
},
error: function (error) {

}
});
});
$('input[readonly = "readonly"]').each(function () { $(this).attr('tabindex', '-1'); }) //making the tabindex -1 for all readonly text box to avoid tabing.
$('td input[type=button][id=btn_cancel]').live('click', function () {
$('tr[id=newEmpCommissionRow] input[type=text]').val('0.00');
$('tr[id=newEmpCommissionRow] select')[0].selectedIndex = 0;
$('#cbxNewPrimary').attr('checked', false);
$('#ddlcommisnd')[0].selectedIndex = 0;
$('#cmcd1').empty();
$('#cmcd1').append('<option value=" ">--Select--</option>');
$('#cscl').empty();
$('#cscl').append('<option value=" ">--Select--</option>');
$('.ErrorDiv, .ErrorDivUpdate').html('');
$('input, select').removeClass('error');
$('tr[id*=existingEmpCommRow_]:nth-child(odd)').css('background', '#f2f2f2');
$('tr[id*=existingEmpCommRow_]:nth-child(even)').css('background', '#fff');
$('tr[id*=existingEmpCommRow_] input[id=commisnd], tr[id*=existingEmpCommRow_] input[id*=split], tr[id*=existingEmpCommRow_] input[id*=cbxPrimary]').removeAttr('disabled');
$('tr[id*=existingEmpCommRow_] select, tr[id*=existingEmpCommRow_] input[type=button], tr[id*=existingEmpCommRow_]').removeAttr('disabled');
$('#newEmpCommissionRow').css('background', '#f2f2f2');
$('input[type=button][id=btn_delete]').css({ 'background-color': 'rgb(0, 151, 252)', 'cursor': 'pointer' });
});
$('tr[id*=existingEmpCommRow_]').live('click', function () {
if ($(this).attr('disabled') == false || $(this).attr('disabled') == undefined) {
$('tr[id*=existingEmpCommRow_]:nth-child(odd)').css('background', '#f2f2f2');
$('tr[id*=existingEmpCommRow_]:nth-child(even)').css('background', '#fff');
var row = $(this).closest('tr');
$('#' + row.attr('id')).css('background', '#555');
$('tr[id*=existingEmpCommRow_] input, tr[id*=existingEmpCommRow_] select').removeClass('error');
}
});
$('tr[id=newEmpCommissionRow] input[type!=button], tr[id=newEmpCommissionRow] select').live('click', function () {
$('tr[id*=existingEmpCommRow_] input, tr[id*=existingEmpCommRow_] select, tr[id*=existingEmpCommRow_]').attr('disabled', 'disabled');
$('tr[id*=existingEmpCommRow_]:nth-child(odd)').css('background', '#f2f2f2');
$('tr[id*=existingEmpCommRow_]:nth-child(even)').css('background', '#fff');
$('input[type=button][id=btn_delete]').css({ 'background-color': 'rgb(225, 225, 225)', 'cursor': 'default' });
$('#newEmpCommissionRow').css('background', '#555');
});
function checkRequiredFields() {
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
if (($('#cmcd').val() == '' || $('#cmcd').val() == ' ') && ($('#cmcd1').val() == '' || $('#cmcd1').val() == ' ') && ($('#cscl').val() == '' || $('#cscl').val() == ' ')
&& ($('#ddlcommisnd').val() == '' || $('#ddlcommisnd').val() == ' ') && ($('#splt').val() == '0.00')) {
return true;
}
if ($('#cmcd').val() == '' || $('#cmcd').val() == ' ') {
$('.ErrorDiv').html('');
$('input, select').removeClass('error');
$('#cmcd').after('<div class="ErrorDiv" style="position:absolute; color:red; padding:8px 0px;">Select some value for Employee No.</div>');
$('#cmcd').addClass('error');
return false;
}
else {
$('#cmcd').removeClass('error');
$('.ErrorDiv').html('');
}

if ($('#cmcd1').val() == '' || $('#cmcd1').val() == ' ') {
$('.ErrorDiv').html('');
$('input, select').removeClass('error');
$('#cmcd1').after('<div class="ErrorDiv" style="position:absolute; color:red; padding:8px 0px;">Select some value for Commission Role.</div>');
$('#cmcd1').addClass('error');
return false;
}
else {
$('#cmcd1').removeClass('error');
$('.ErrorDiv').html('');
}

//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
if ($('#cscl').val() == '' || $('#cscl').val() == ' ') {
$('.ErrorDiv').html('');
$('input, select').removeClass('error');
$('#cscl').after('<div class="ErrorDiv" style="position:absolute; color:red; padding:8px 0px;">Select some value for Commission Schedule Code.</div>');
$('#cscl').addClass('error');
return false;
}
else {
$('#cscl').removeClass('error');
$('.ErrorDiv').html('');
}

if ($('#ddlcommisnd').val() == '' || $('#ddlcommisnd').val() == ' ') {
$('.ErrorDiv').html('');
$('input, select').removeClass('error');
$('#ddlcommisnd').after('<div class="ErrorDiv" style="position:absolute; color:red; padding:8px 0px;">Select some value for Commissioned.</div>');
$('#ddlcommisnd').addClass('error');
return false;
}
else {
$('#ddlcommisnd').removeClass('error');
$('.ErrorDiv').html('');
}
return true;
}
function DisableCommissions(deskstatus) {
if (deskstatus == 'Closed Deal' || deskstatus == 'Posted Deal') {
$('input[type="text"], input[type="checkbox"],input[type="button"],input[type="submit"], select').attr('disabled', true);
$('.RightDropdown').removeAttr('disabled', 'disabled');
$('#CommissionsBack').removeAttr('disabled', true);
$('#btncommVoucher').removeAttr('disabled', true);
$.ajax({
type: 'Post',
url: './../Scenario/GetDeskAndScenarioStatus',
success: function (result) {
if (result.DeskStatus == 'Closed Deal' || result.DeskStatus == 'Posted Deal') {
if (result.IsPendingDeal == true || result.WaitOnProcessComplete == true) {
if (result.ErrorMessage != null && result.ErrorMessage != '') {
$('#unwind_deal').show();
$('#unwind_deal').removeAttr('disabled', 'disabled');
document.getElementById('error_message').style.display = '';
}
else {
$('#unwind_deal').hide();
$('#unwind_deal').attr('disabled', 'disabled');
document.getElementById('error_message').style.display = 'none';
}
}
else {
$('#unwind_deal').show();
$('#unwind_deal').attr('disabled', 'disabled');
$('#unwind_deal').addClass('disableLinkUnwind');
}
}
}
});
}
}
function GetAllDetails() {
$.ajax({
type: 'POST',
url: './../CommissionableEmployee/GetDetails',
data: { commschcode: $('#cscl').val(), empid: $('#cmcd').val(), commroleid: $('#cmcd1').val() },
success: function (result) {
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
$('#splt').val(addDecimalPointIfNot(result.Split));
$('#ddlcommisnd').val(result.Commissioned);
},
error: function (error) {

}
});
}
function Getschedulecodelist(rolevalue) {
var value = rolevalue;
var url = './../CommissionableEmployee/GetScheduleCodeList';
var ddlsource = '#cmcd1';
var ddltarget = '#cscl';
$.getJSON(url, { commroleid: value, empid: $('#cmcd').val() }, function (data, Desc) {
$(ddltarget).empty();
$(ddltarget).removeAttr('disabled');
$(ddltarget).append('<option value=" ">--Select--</option>');
$.each(data.companieslist, function (index, optionData) {
$(ddltarget).append('<option value="' + optionData.Value + '">' + optionData.Text + '</option>');
$(ddltarget).val(optionData.Value);
$('#ddlcommisnd').val(data.commissioned);
});

$.ajax({
type: 'Post',
url: './../CommissionableEmployee/GetPrimaryIndicatorInfo',
data: {
code: value
},
success: function (result) {
if (result.Msg == true) {
$('#cbxNewPrimary').attr('checked', true);
$('#cbxNewPrimary').attr('disabled', 'disabled');
}
else if (result.Msg == false) {
$('#cbxNewPrimary').attr('checked', false);
$('#cbxNewPrimary').attr('disabled', 'disabled');
}
}
});
});

}
function RedirectToScenario(ScenarioID, DetailsYesNo) {
var deskid = $('#HiddenDeskID').val();
if (DetailsYesNo != 'Yes') {
URL = './../Scenario/Index?DID=' + deskid + '&SID=' + ScenarioID;
window.location.href = URL;
} else {
if ($('#HiddenScenDetailsLoad').val() == '1')
var scenDetClicked = true;
else
var scenDetClicked = false;

var URL = './../Scenario/_ScenarioDetails?Detailsclicked=' + scenDetClicked;
$.ajax({
type: 'POST',
url: URL,
data: { id: ScenarioID },
success: function (LoadScenarioDetails) {
$('#DivScenarioDetails').html(LoadScenarioDetails);
}
});
}
}
function RowClick(control) {
if (!($(control).attr('disabled') == false || $(control).attr('disabled') == undefined)) {
$('.ErrorDivUpdate').html('');
$('#CommissionsBack').after('<div class="ErrorDivUpdate" style="position:absolute; left:40%; color:red; font-size:18px;">Press CANCEL to update existing data.</div>');
$('.ErrorDivUpdate').animate({
opacity: 1
}, 3000, function () {
$('.ErrorDivUpdate').fadeOut(1000);
});
}
}
function ShowAlertMessageEmployee(message) {
centrpop('#alert_comm');
popupload('#alertPOp_commission', '#alert_comm');
$('#alert_comm p').html(message);
}
function SplitChange() {
if (checkRequiredFields() == false) {
return false;
}
if (($('#splt').val()) * 1 > 100) {
ShowAlertMessage('Split can\'t be more than 100. Please revise it.');
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
$('#splt').val('0.00');
$('#alertHidden').val('#splt');
return false;
}
$.ajax({
url: './../CommissionableEmployee/GetTotalSplit',
type: 'Post',
success: function (result) {
if ((result.Msg * 1 + $('#splt').val() * 1) > 100) {
ShowAlertMessage('Total commission % cannot be more than 100. Please revise it.');
//Bug 19134:Change Order: 03.06.FRD039 Employee Commission Default employee split to 0%
$('#splt').val('0.00');
$('#alertHidden').val('#splt');
}
}
});
}


































