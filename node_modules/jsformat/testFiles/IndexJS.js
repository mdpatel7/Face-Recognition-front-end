// Prevent the backspace key from navigating back.
$(document).unbind('keydown').bind('keydown', function (event) {
    var doPrevent = false;

    if (event.keyCode === 8) {
        var d = event.srcElement || event.target;
        if ((d.tagName.toUpperCase() === 'INPUT' && (d.type.toUpperCase() === 'TEXT' || d.type.toUpperCase() === 'PASSWORD'))
    || d.tagName.toUpperCase() === 'TEXTAREA') {
            doPrevent = d.readOnly || d.disabled;
        } else {
            doPrevent = true;
        }
    }

    if (doPrevent) {
        event.preventDefault();
    }
});

$(document).ready(function () {
    //03.02.FRD004 Finance Terms - Browser refresh returns focus to Scenario Summary
    var detailsContainer = $('#DivScenarioDetails');
    if (detailsContainer.attr('data-show') === 'True') {
        var id = detailsContainer.attr('data-scenario-active') + '|';
        LoadScenarioDetails(id);
    }
    else {

        $("#bgPopup").data("state", 0);
        $('#IndexrefreshCustomer_message').hide();
        var fin_type = $('#HiddenActiveFinanceID').val();
        if (fin_type == 2) {
            var hiddenscenario = $('#HiddenScenId').val();
            var URL = './../Scenario/GetDealtypeforcash';
            $.ajax({
                type: 'Post',
                url: URL,
                dataType: 'json',
                data: {
                    ScenarioID: hiddenscenario
                },
                success: function (result) {
                    if (result.message == "Exists") {
                        $('#linkindexAftermarket').attr("disabled", "disabled");
                        $('#linkindexInsurance').attr("disabled", "disabled");
                        $('#linkindexServiceContract').attr("disabled", "disabled");
                        $('#linkindexAftermarket').addClass('disableLink');
                        $('#linkindexInsurance').addClass('disableLink');
                        $('#linkindexServiceContract').addClass('disableLink');
                    }
                    else {
                        $('#linkindexAftermarket').removeAttr("disabled", "disabled");
                        $('#linkindexInsurance').removeAttr("disabled", "disabled");
                        $('#linkindexServiceContract').removeAttr("disabled", "disabled");
                        $('#linkindexAftermarket').removeClass('disableLink');
                        $('#linkindexInsurance').removeClass('disableLink');
                        $('#linkindexServiceContract').removeClass('disableLink');
                    }
                },
                error: function (error) {
                }
            });
        }
        var CheckActiveScenario = $("#CheckNewActive").val();
        if (CheckActiveScenario != '') {
            var ScenarioID = $('#CheckNewActiveScenarioID').val();
            var CheckActiveFianancetype = $("#CheckNewFinanceType").val();
            $("#CheckNewActive").val('');
            var id = ScenarioID + '|' + CheckActiveFianancetype;
            LoadScenarioDetails(id)
        }

        var pendingStatus = $("#HiddenIsPendingDeal").val();
        var DeskStatus = $("#ActiveScenarioID").val();
        //TFS ID 19044 -- 03.09.FRD046 Send to Contracting - Not receiving error message from AX
        if (pendingStatus == 'True' && (DeskStatus == "Contracting Deal" || DeskStatus == "Delivered Deal" || DeskStatus == "Closed Deal" || DeskStatus == "Posted Deal")) {
            $(".refresh").everyTime(3000, 'PendingTimer', function (i) {
                $.ajax({
                    type: 'Post',
                    url: "./../Scenario/GetDeskAndScenarioStatus",
                    success: function (result) {
                        if (result.DeskStatus == "Contracting Deal" || result.DeskStatus == "Delivered Deal" || result.DeskStatus == "Closed Deal" || result.DeskStatus == "Posted Deal") {
                            if (result.IsPendingDeal == true || result.WaitOnProcessComplete == true) {
                                $("#HiddenIsPendingDeal").val('True');
                                if (result.ErrorMessage != null && result.ErrorMessage != "") {
                                    $('#unwind_deal').show();
                                    $("#unwind_deal").removeAttr("disabled", "disabled");
                                    document.getElementById("error_message").style.display = "";
                                }
                                else {
                                    $('#unwind_deal').hide();
                                    $("#unwind_deal").attr("disabled", "disabled");
                                    document.getElementById("error_message").style.display = "none";
                                }
                                //TFS ID 19044 -- 03.09.FRD046 Send to Contracting - Not receiving error message from AX
                                if (result.DeskStatus == "Contracting Deal") {
                                    $('#delivered_deal').hide();
                                    $("#contract_console").attr("disabled", "disabled");
                                    $("#contract_console").addClass('disabledbtn');
                                    $("#forms").attr("disabled", "disabled");
                                    $("#forms").addClass('disabledbtn');
                                }
                            }
                            else {
                                $("#HiddenIsPendingDeal").val('False');
                                $("#Label_Title").html(result.DeskStatus + " " + result.DealNumber + " " + result.Finance);
                                if (result.DeskStatus == "Posted Deal" || (result.DeskStatus == "Closed Deal" && result.IsPendingDeal == false && result.WaitOnProcessComplete == false)) {
                                    $('#unwind_deal').show();
                                    $("#unwind_deal").attr("disabled", "disabled");
                                    $("#unwind_deal").addClass('disableLinkUnwind');
                                }
                                    //TFS ID 19044 -- 03.09.FRD046 Send to Contracting - Not receiving error message from AX
                                else if (result.DeskStatus == "Contracting Deal") {
                                    $('#delivered_deal').show();
                                    $('#unwind_deal').show();
                                    $("#unwind_deal").removeAttr("disabled", "disabled");
                                    $("#unwind_deal").removeClass('disableLinkUnwind');
                                    $$("#contract_console").removeAttr("disabled", "disabled");
                                    $("#contract_console").removeClass('disabledbtn');
                                    $("#forms").removeAttr("disabled", "disabled");
                                    $("#forms").removeClass('disabledbtn');

                                    centrpop('#printFormsDeal');
                                    popupload('#backgroundDeal1', '#printFormsDeal');
                                    $("#btnYes_Deal1").removeAttr("disabled", "disabled");
                                    $("#BtnCancel_Deal1").removeAttr("disabled", "disabled");
                                    $("#btnYes_Deal2").removeAttr("disabled", "disabled");
                                    $("#BtnCancel_Deal2").removeAttr("disabled", "disabled");
                                    $(".refresh").stopTime('PendingTimer');
                                }
                                else {
                                    $('#unwind_deal').show();
                                    $("#unwind_deal").removeAttr("disabled", "disabled");
                                    $("#unwind_deal").removeClass('disableLinkUnwind');
                                }
                                document.getElementById("error_message").style.display = "none";
                                if (result.DeskStatus == "Delivered Deal" || result.DeskStatus == "Closed Deal" || result.DeskStatus == "Posted Deal" || deskid == "Contracting Deal") {
                                    $.ajax({
                                        type: 'Post',
                                        url: './../Scenario/GetRDRResponseMessage',
                                        success: function (result) {
                                            if (result.IsPending == true || result.WaitOnProcessComplete == true) {
                                                $("#Span_RDR").hide();
                                                $(".refresh").stopTime('PendingTimer');
                                            }
                                            else if (result.Response == "") {
                                                $("#Span_RDR").hide();
                                            }
                                            else {
                                                $("#Span_RDR").show();
                                                if (result.Response == "Failed") {
                                                    $("#Label_Title_RDR").html("RDR Failed");
                                                    $('#Label_Title_RDR').css('color', 'red');
                                                    $(".refresh").stopTime('PendingTimer');
                                                }
                                                else if (result.Response == "Success") {
                                                    $('#Label_Title_RDR').css('color', 'white');
                                                    $("#Label_Title_RDR").html("RDR Successful");
                                                    $(".refresh").stopTime('PendingTimer');
                                                }
                                                else if (result.Response == "Complete") {
                                                    $('#Label_Title_RDR').css('color', 'white');
                                                    $("#Label_Title_RDR").html("RDR Complete");
                                                }
                                                else {
                                                    $("#Span_RDR").show();
                                                    $("#Label_Title_RDR").html("RDR In Progress");
                                                    $('#Label_Title_RDR').css('color', 'white');
                                                }
                                            }
                                        },
                                        error: function (error) {
                                        }
                                    });
                                }
                                else {
                                    $(".refresh").stopTime('PendingTimer');
                                }
                            }
                        }
                    }
                });
            });
        }
        else {
            $(".refresh").stopTime('PendingTimer');
        }
    }
    if ($('#ShowCustomerDetail').val() === 'true') {
        $($('#CustomerNameOnIndex').children('a:first')).trigger('click');
    }
});

var jQConflict = jQuery.noConflict();
function AddDatepicker(date) {
    var Date = '#' + date.id;
    focusToNextfield(Date);
    jQConflict(date).datepicker({
        showOn: 'focus',
        onClose: function (dateText, inst) {
            focusable = jQConflict('body').find('input:not([readonly="readonly"]),a,select,button, input[type="checkbox"]').filter(':visible');
            next = focusable.eq(focusable.index(this) + 1);
            next.focus();
        }
    }).focus();
}

function DisableDesk(deskid) {
    if (deskid == "Contracting Deal" || deskid == "Delivered Deal" || deskid == "Cancelled Deal" || deskid == "Closed Deal" || deskid == "Posted Deal"
            || deskid == "Rejected Deal" || deskid == "Rejected Posted Deal" || deskid == "Rejected Closed Deal") {
        $('input[type=button],input[type=text], select').attr("disabled", "disabled");
        $('#tbxDeskName').attr('disabled', 'disabled');
        $('.RightDropdown').removeAttr('disabled', 'disabled');
        $('.homeicon').removeAttr('disabled', 'disabled');
        $('.EmployeeCommissionLink').removeAttr('disabled', 'disabled');
        $("#CreateQuote").removeAttr("disabled", "disabled");
        $('.BookOutDealLink').removeAttr('disabled', 'disabled');
        $('.DealRecapLink').removeAttr('disabled', 'disabled');
        if (deskid == "Posted Deal" || deskid == "Cancelled Deal") {
            $("#unwind_deal").attr("disabled", "disabled");
            $("#unwind_deal").addClass('disableLinkUnwind');
        }
        else {
            $("#unwind_deal").removeAttr("disabled", "disabled");
            $("#unwind_deal").removeClass('disableLinkUnwind');
        }

        $.ajax({
            type: 'Post',
            url: "./../Scenario/GetDeskAndScenarioStatus",
            success: function (result) {
                if (result.DeskStatus == "Closed Deal") {
                    if (result.IsPendingDeal == true || result.WaitOnProcessComplete == true) {
                        $("#HiddenIsPendingDeal").val('True');
                        if (result.ErrorMessage != null && result.ErrorMessage != "") {
                            $('#unwind_deal').show();
                            $("#unwind_deal").removeAttr("disabled", "disabled");
                            document.getElementById("error_message").style.display = "";
                        }
                        else {
                            $('#unwind_deal').hide();
                            $("#unwind_deal").attr("disabled", "disabled");
                            document.getElementById("error_message").style.display = "none";
                        }
                    }
                    else {
                        $("#HiddenIsPendingDeal").val('False');
                        $('#unwind_deal').show();
                        $("#unwind_deal").attr("disabled", "disabled");
                        $("#unwind_deal").addClass('disableLinkUnwind');
                    }
                }
            }
        });

        $("#delivered_deal").removeAttr("disabled", "disabled");
        $("#btnYesUnwind").removeAttr("disabled", "disabled");
        $("#BtnCancelUnwind").removeAttr("disabled", "disabled");
        $('input[name="ScenarioDetails"]').removeAttr("disabled", "disabled");
        $('#create_scenario').attr("disabled", "disabled");
        $('#Copy_scenario').attr("disabled", "disabled");
        $('#IndexrefreshCustomer_message').hide();
        $("#Span_RDR").hide();
        if ($("#HiddenIsPendingDeal").val() == 'True') {
            if ($("#HiddenIsErrorMessageExists").val() == 'True') {
                document.getElementById("error_message").style.display = "";
            }
            else {
                document.getElementById("error_message").style.display = "none";
            }
        }
        else {
            document.getElementById("error_message").style.display = "none";
        }
    }
    else {
        if ($('#Label_RefreshCustomer').val() != '') {
            $('#IndexrefreshCustomer_message').show();
        }
        else {
            $('#IndexrefreshCustomer_message').hide();
        }
    }
    if (deskid == "Delivered Deal" || deskid == "Closed Deal" || deskid == "Posted Deal" || deskid == "Contracting Deal") {
        $.ajax({
            type: 'Post',
            url: './../Scenario/GetRDRResponseMessage',
            success: function (result) {
                if (result.IsPending == true || result.WaitOnProcessComplete == true) {
                    $("#Span_RDR").hide();
                }
                else if (result.Response == "") {
                    $("#Span_RDR").hide();
                }
                else {
                    $("#Span_RDR").show();
                    if (result.Response == "Failed") {
                        $("#Label_Title_RDR").html("RDR Failed");
                        $('#Label_Title_RDR').css('color', 'red');
                    }
                    else if (result.Response == "Success") {
                        $('#Label_Title_RDR').css('color', 'white');
                        $("#Label_Title_RDR").html("RDR Successful");
                    }
                    else if (result.Response == "Complete") {
                        $('#Label_Title_RDR').css('color', 'white');
                        $("#Label_Title_RDR").html("RDR Complete");
                    }
                    else {
                        $("#Span_RDR").show();
                        $("#Label_Title_RDR").html("RDR In Progress");
                        $('#Label_Title_RDR').css('color', 'white');
                    }
                }
            },
            error: function (error) {
            }
        });
    }
}

function ChangeLender(control, ScenarioID) {
    var LenderVal = $('#' + control.id).val();
    AlertLenderContractCode("Do you want to replace rates with the new lender’s defaults?");
    $('#HiddenScenID').val(ScenarioID);
}

function ChangeLender2(control, ScenarioID) {
    var LenderVal = $('#' + control.id).val();
    $("#hidden_lender").val(LenderVal);
    centrpop('#ChangeLenderPopUp');
    popupload('#backgroundsearch', '#ChangeLenderPopUp');
    $('#HiddenScenID').val(ScenarioID);
}
//Added for #17511
function PrintForms() {
    centrpop('#printFormsDeal2');
    popupload('#backgroundDeal1', '#printFormsDeal2');
    $("#btnYes_Deal2").removeAttr("disabled", "disabled");
    $("#BtnCancel_Deal2").removeAttr("disabled", "disabled");

}
function ChangeLenderLease(control) {
    var LenderVal = $('#' + control.id).val();
    centrpop('#DivChangeLenderPopUpLease');
    popupload('#backgroundsearch', '#DivChangeLenderPopUpLease');
}

function ClickedCancelTheDeal(control) {
    ClosePopUP('#FirstPaymentConfirmationBackGround', '#FirstPaymentConfirmation');
    $('#tbxFirstPayment').focus();
}

function ClosePopUPLease(BackGroundPopUP, Div) {
    popupdisable(BackGroundPopUP, Div);
}

function ClosePopUP(BackGroundPopUP, Div) {
    if (Div == "#TradeInPopupEdit" || Div == "#TradeInPopup") {
        $("#HiddenAppButton").val("No");
    }
    popupdisable(BackGroundPopUP, Div);
}

function MakeScenarioActive(el, str, deskstatus) {
    if (deskstatus == "Cancelled Deal") {
    }
    else {
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "./../Scenario/MakeScenarioActive",
            data: "{'ScenarioID':'" + str + "'}",
            success: function (result) {
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "./../Scenario/CheckScenarioDealType",
                    data: "{'ScenarioID':'" + str + "'}",
                    success: function (result) {
                        if (result.message == "Retail") {
                            EnableDisableCobuyer('Yes');
                        }
                        else {
                            EnableDisableCobuyer('');
                        }
                    }
                });
                var URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + str;
                window.location.href = URL;
            }
        });
    }
}

function ChangeStockNum(DetailsYesNo, texboxid, ScenarioID, prevStockNUm) {
    var stock = $(texboxid).val();
    if (prevStockNUm == "") {
        $("#tbxActiveStockNum").css('color', '#fff');
        if (texboxid == "#tbxActiveStockNum")
            $(texboxid).css('background-color', '#999');
    }
    setTimeout(function () {
        var StockNum = $(texboxid).val();
        if (StockNum == "") {
            var URL = './../VehicleHistory/RemoveVehicleFromScenario?StockNum=' + prevStockNUm;
            $.ajax({
                type: 'Post',
                url: URL,
                success: function (result) {
                    $('#HiddenStockNum').val('');
                    if (prevStockNUm != "") {
                        $("#CalculationInProgress").show();
                        RedirectToScenario(ScenarioID, DetailsYesNo);
                    }
                },
                error: function (error) {
                    $("#CalculationInProgress").show();
                    RedirectToScenario(ScenarioID, DetailsYesNo);
                }
            });
        }
        else {
            //Bug-- 8428
            if (prevStockNUm.toUpperCase() == StockNum.toUpperCase()) {
                $(texboxid).val(prevStockNUm);
                return;
            }
            //End
            var IsSelected = $("#HiddenIsSelected").val();
            if (IsSelected == "") {
                $.ajax({
                    url: "./../Scenario/GetVehilceID", type: "POST",
                    data: { StockNum: StockNum },
                    success: function (Result) {
                        if (Result.VehicleID == "") {
                            $("#tbxActiveStockNum").css('color', '#000');
                            $(texboxid).removeClass('ui-autocomplete-loading');
                            $("#tbxStockNum1").removeClass('ui-autocomplete-loading');
                            $("#CalculationInProgress").hide();
                            ShowAlertMessageIndex('No vehicle found matching this stock number. Please try again.');
                            $('#HiddenStockEntered').val(StockNum);
                        }
                        if (Result.VehicleID != "")
                            AddVehilceToScenario(ScenarioID, Result.VehicleID, DetailsYesNo, StockNum, texboxid);
                    },
                    error: function (result) {
                        $("#tbxActiveStockNum").css('color', '#000');
                        ShowAlertMessageIndex('No vehicle found matching this stock number. Please try again.');
                        $("#CalculationInProgress").hide();
                        $(texboxid).removeClass('ui-autocomplete-loading');
                        $(texboxid).val(StockNum);
                        $(texboxid).focus();
                        $(texboxid).css('background-color', '#fff');
                        $("#CalculationInProgress").show();
                        RedirectToScenario(ScenarioID, DetailsYesNo);
                    }
                });
            }
            else {
                $("#HiddenIsSelected").val("");
            }
        }
    }, 500);
}

function ShowAlertMessageTerm(message) {
    $("#alert_term p").html(message);
    centrpop('#alert_term');
    popupload('#alertPOp_term', '#alert_term');
}

function AlertLenderContractCode(message) {
    $("#DivChangeLenderPopUp p").html(message);
    centrpop('#DivChangeLenderPopUp');
    popupload('#backgroundsearch', '#DivChangeLenderPopUp');
    $('#popup_Cancel').hide();
}

function RedirectToReapairOrdersfromfinDetails(control, vehIds) {
    centrpop('#DivOutstandingROProgress');
    popupload('#bg_OutstandingRO', '#DivOutstandingROProgress');
    $('body').css('cursor', 'wait');
    $("#Index_ROArea").html("");
    var vehId = vehIds.toString();
    var URL = './../SearchVehicle/GetRepairOrdersforVehicles';
    $.ajax({
        type: 'Post',
        url: URL,
        data: {
            DMXVehicleID: vehId
        },
        success: function (result) {
            centrpop('#Index_DivPagedRepairOrders');
            popupload('.Index_Backgroundsearch_PagedRepairOrders', '#Index_DivPagedRepairOrders');
            $("#Index_ROArea").html(result);
        }
    });
}

function UpdateScenarioPrice(control, ScenarioID, OldVal, ftype) {
    var URL = './../Scenario/UpdateScenarioPrice';
    var controlid = '#' + control.id;
    $(controlid).val(addDecimalPointIfNot($(controlid).val()));
    var Price = $(controlid).val();
    if (Price == '') {
        Price = 0;
        var financetype = 0;
        $.ajax({
            type: 'Post',
            url: './../Scenario/GetFinance',
            datatype: "JSON",
            data: { ScenarioID: ScenarioID },
            success: function (result) {
                financetype = result.result;
                switch (financetype) {
                    case 1:
                        break;
                    case 2:
                        $("#tbxAmountDue").val('');
                        break;
                    case 3:
                        break;
                    case 4:
                        break;
                }
            }
        });
    }
    $.ajax({
        type: 'Post',
        url: URL,
        data: { Price: Price, ScenarioID: ScenarioID },
        success: function (result) {
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 2: AjaxCalcCallForCash(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
        },
        error: function (result) {
        }
    });
}

function UpdateTerms(control, ScenarioID) {
    var Value = $('#' + control.id).val();
    if (Value == 0) { // Added for BUG #13192
        ShowAlertMessageTerm("Term cannot be zero.  Please enter a term greater than zero.");
        return;
    }
    var URL = './../Scenario/UpdateScenarioDetails';
    $.ajax({
        type: 'Post',
        url: URL,
        data: { ScenarioID: ScenarioID, Value: Value, ColumnName: "Terms" },
        success: function (result) {
            AjaxCallCalcEngine(ScenarioID);
        }
    });
}

function UpdateScenarioDetails(control, ScenarioID, ColumnName) {
    var Value = $('#' + control.id).val();
    if (Value == '' && ColumnName != 'Description') {
        Value = 0;
    }
    if (ColumnName == 'CustType') {
        Value = control;
        if (Value == '') {
            Value = 0;
        }
        $('#HiddenDealtypeValue').val(Value);
    }
    if (ColumnName == 'SecondPayment') {
        if (DateValidation(control) == false) {
            $('.ErrorDiv').html('');
            $(control).after("<div class='ErrorDiv' style='position:absolute; left:73.5%; border:1px solid red; background:#f2f2f2; padding:5px 20px; color:red;'>Invalid date.</div>");
            $(control).addClass('error');
            $('.ErrorDiv').animate({
                opacity: 1
            }, 2000, function () {
                $('.ErrorDiv').fadeOut(1000);
                $('#tbxSecondPayment').focus();
                $('input, select').removeClass('error');
            });
            return;
        }
    }
    if (ColumnName == 'SecurityDepositType') {
        if (Value == '106') {
            $('#tbxSecdepAmt').removeAttr("disabled", "disabled");
            $('#tbxSecdepAmt').val('0.00');
        }
        else
            $('#tbxSecdepAmt').attr("disabled", "disabled");
    }
    if (ColumnName == 'Terms' && Value == '0') {
        if ($('#tbxTerms').val() == 0) {
            ShowAlertMessageTerm("Term cannot be zero.  Please enter a term greater than zero.");

            return;
        }
    }
    if (ColumnName == 'LockContractDate') {
        var isChecked = $('#lockcontractdate').is(':checked');
        if (isChecked) {
            Value = true;
        }
        else {

            Value = false;
        }
    }
    if (ColumnName == 'ContractDate') {
        $('#lockcontractdate').attr("checked", true);
        $('#tbxContractDatefinance').attr('disabled', 'disabled');
    }
    var contractdate = $('#tbxContractDatefinance').val();
    var URL = './../Scenario/UpdateScenarioDetails';
    $.ajax({
        type: 'Post',
        url: URL,
        data: { ScenarioID: ScenarioID, Value: Value, ColumnName: ColumnName, secpaymtdays: $('#daysForSecondPayment').val() },
        success: function (result) {
            if (result.Msg == 'success') {
                var fintype = $("#OriginalFinType").val();
                if (fintype == 3) {
                    if (ColumnName == 'CapCost') {
                        var dealeradj = result.Dealeradj;
                        $("#tbxDealerAdj").val(addDecimalPointIfNot(dealeradj));
                    }
                }
                if (ColumnName == 'CustType') {
                    Value = control;
                    if (Value == '') {
                        Value = 0;
                    }

                    $('#HiddenDealtypeValue').val(Value);
                    if ($("#DDLCustomerType option:selected").text() == "Retail") {
                        EnableDisableCobuyer('Yes');
                    }
                    else {
                        EnableDisableCobuyer('');
                    }
                }
                if (ColumnName == 'DealerAdjustments') {
                    var Msrp = $('#tbxMSRP').val();
                    var capcost = parseFloat(Msrp) + parseFloat(Value);
                    $('#tbxCapitalCost').val(addDecimalPointIfNot(capcost));
                }
                if (ColumnName == 'ContractDate') {
                    $('#tbxFirstPayment').val(result.FirstPayment);
                    $('.VerifyPaymentMsg').html('');
                    $('.VerifyPaymentMsg').hide();
                    if (result.SecondPayment != null) {
                        $('#tbxSecondPayment').val(result.SecondPayment);
                    }
                    $('#lockcontractdate').attr("checked", true);
                }
                if (result.DaysForSecondPayment != null && result.DaysForSecondPayment != undefined) {
                    if (result.DaysForSecondPayment == "-1") {
                        $('#daysForSecondPayment').val("");
                        $('#tbxSecondPayment').val("");
                        $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
                    }
                    else if (getDateDifference($('#tbxFirstPayment').val(), $('#tbxSecondPayment').val()) == 0) {
                        $('#daysForSecondPayment').val("0");
                        $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
                    }
                    else {
                        // $('#daysForSecondPayment').val(parseInt(result.DaysForSecondPayment) + 1);
                        $('#daysForSecondPayment').val(parseInt(result.DaysForSecondPayment));
                        $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
                    }
                }
                else {
                    $('#daysForSecondPayment').val("0");
                    $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
                }
                if (result.DaysForFirstPayment != null && result.DaysForFirstPayment != undefined) {
                    $('#tbxContractDatefinance').val(contractdate);
                }
            }
            if (ColumnName != 'OutsideLien' && ColumnName != 'ContractDate' && ColumnName != 'LockContractDate') {
                AjaxCallCalcEngine(ScenarioID);
            }
            //Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
            if (ColumnName == 'TradeAllowance' || ColumnName == 'TradePayoff') {
                RedirectToScenario(ScenarioID, 'No');
            }
            if ($('#DetailsClicked').val() == 'yes') {
                if (ColumnName == 'LockContractDate') {
                    var isChecked = $('#lockcontractdate').is(':checked');
                    if (isChecked) {
                        RedirectToScenario(ScenarioID, 'No');
                    }
                    else {
                        $('#tbxContractDatefinance').removeAttr('disabled', 'disabled');
                    }
                }
                else if (ColumnName != 'ContractDate') {
                    RedirectToScenario(ScenarioID, 'Yes');
                }
            }
            else {
                RedirectToScenario(ScenarioID, 'No');
            }
        },
        error: function (result) {
            if ($('#DetailsClicked').val() == 'yes') {
                RedirectToScenario(ScenarioID, 'Yes');
            }
            else {
                RedirectToScenario(ScenarioID, 'No');
            }
        }
    });
}

function getDateDifference(date1, date2) {

    var second = 1000,
    minute = second * 60,
    hour = minute * 60,
    day = hour * 24,
    week = day * 7;
    date1 = new Date(date1).getTime();
    date2 = new Date(date2).getTime();
    var timediff = date2 - date1;
    if (isNaN(timediff)) return 0;
    if (Math.floor(timediff / day) < 0) {
        return Math.abs(timediff / day);
    }
    else {
        return (Math.floor(timediff / day));
    }
}

function Checkunwindbutton() {
    var deskstatus = $("#HiddenDeskStatus").val();
    var scenariostatus = $("#HiddenScenarioStatus").val();
    if (deskstatus == "Contracting Deal" || deskstatus == "Delivered Deal" || deskstatus == "Closed Deal" || deskstatus == "Cancelled Deal" || deskstatus == "Posted Deal"
            || deskstatus == "Rejected Deal" || deskstatus == "Rejected Closed Deal" || deskstatus == "Rejected Posted Deal") {
        if (scenariostatus == deskstatus) {
            $("#unwind_deal").removeAttr("disabled", "disabled");
            $("#unwind_deal").removeClass('disableLinkUnwind');
        }
        else {
            $("#unwind_deal").attr("disabled", "disabled");
            $("#unwind_deal").addClass('disableLinkUnwind');
        }


        if (deskstatus == "Posted Deal" || (deskstatus == "Closed Deal" && $("#HiddenIsPendingDeal").val() == 'False')) {
            $("#unwind_deal").attr("disabled", "disabled");
            $("#unwind_deal").addClass('disableLinkUnwind');
        }
        else {
            $("#unwind_deal").removeAttr("disabled", "disabled");
            $("#unwind_deal").removeClass('disableLinkUnwind');
        }
    }
}

function AjaxCalcCallForFinance(ScenarioID) {
    Checkunwindbutton();
    $("#CalculationInProgress").show();
    $('body').css('cursor', 'wait');
    $.ajax({
        url: "./../calcengine/CheckPreRequireValue",
        type: 'Post',
        cache: false,
        success: function (result) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
            if (result.result != "fail") {
                if ($('#DetailsClicked').val() == '') {
                    $("#tbxAmtFinanceActiv").val(addDecimalPointIfNot(result.calcFinance.AmountFinanced));
                    $("#tbxPaymentFinBal").val(addDecimalPointIfNot(result.calcFinance.Payment));
                    $("#item_FeesAndTaxes").val(addDecimalPointIfNot(result.calcFinance.FeeAndTaxTotal));
                }
                else {
                    $('#tbxTaxablePrice').val(addDecimalPointIfNot(result.calcFinance.TaxablepriceFinance));
                    $('#tbxFinanceCharges').val(addDecimalPointIfNot(result.calcFinance.TotalFinanceCharge));
                    $('#tbxPayment').val(addDecimalPointIfNot(result.calcFinance.Payment));
                    $('#tbxAmountFinanced').val(addDecimalPointIfNot(result.calcFinance.AmountFinanced));
                    $('#tbxTotalPayment').val(addDecimalPointIfNot(result.calcFinance.TotalPayment));
                    $('#tbxFeesAndTaxes').val(addDecimalPointIfNot(result.calcFinance.FeeAndTaxTotal));
                    if (result.calcFinance.PrecissionedAPR != null) {
                        $('#tbxAPR').val(result.calcFinance.PrecissionedAPR + "%");
                    }
                    else {
                        $('#tbxAPR').val('0.0%');
                    }
                }
            }
        },
        error: function (error) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
}

function AjaxCalcCallForLease(ScenarioID, Leaseflag) {
    $("#CalculationInProgress").show();
    $('body').css('cursor', 'wait');
    $.ajax({
        url: "./../calcengine/CheckPreRequireValue",
        type: 'Post',
        cache: false,
        success: function (result) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
            if (result.result != "fail") {
                if ($('#DetailsClicked').val() == '') {
                    if (result.calcLease.NetCapCost != "") {
                        $("#tbxNetCapCostActiv").val(parseFloat(result.calcLease.NetCapCost).toFixed(2));
                    }
                    else {
                        $("#tbxNetCapCostActiv").val("");
                    }
                    if (result.calcLease.Payment != "") {
                        $("#tbxPaymentFinBal").val(parseFloat(result.calcLease.Payment).toFixed(2));
                    }
                    else {
                        $("#tbxPaymentFinBal").val("");
                    }
                    if (result.calcLease.DeliveryCashDue != "") {
                        $("#tbxAmountDue").val(parseFloat(result.calcLease.DeliveryCashDue).toFixed(2));
                    }
                    else {
                        $("#tbxAmountDue").val("");
                    }
                }
                else {
                    if (result.calcLease.TotalCaptialCost != '') {
                        $('#tbxTotalCapCost').val(parseFloat(result.calcLease.TotalCaptialCost).toFixed(2));
                    }
                    else {
                        $('#tbxTotalCapCost').val('0.00');
                    }
                    if (result.calcLease.Depreciation != '') {
                        $('#tbxDepreciation').val(parseFloat(result.calcLease.Depreciation).toFixed(2));
                    }
                    else {
                        $('#tbxDepreciation').val('0.00');
                    }
                    if (result.calcLease.NetCapCost != '') {
                        $('#tbxNetCapCost').val(parseFloat(result.calcLease.NetCapCost).toFixed(2));
                    }
                    else {
                        $('#tbxNetCapCost').val('0.00');
                    }
                    if (result.calcLease.Payment != '') {
                        if ($('#tbxTerms').val() == 0) {
                            $('#paym').val('0.00');
                        }
                        else {
                            $('#paym').val(parseFloat(result.calcLease.Payment).toFixed(2));
                        }
                    }
                    else {
                        $('#paym').val('0.00');
                    }
                    if (result.calcLease.AdvancePaymentAmount != '') {
                        $('#tbxAdvancePay').val(parseFloat(result.calcLease.AdvancePaymentAmount).toFixed(2));
                    }
                    else {
                        $('#tbxAdvancePay').val('0.00');
                    }
                    if (result.calcLease.UseTax != '') {
                        $('#tbxUseTax').val(parseFloat(result.calcLease.UseTax).toFixed(2));
                    }
                    else {
                        $('#tbxUseTax').val('0.00');
                    }
                    if (result.calcLease.Rent != '') {
                        $('#tbxRent').val(parseFloat(result.calcLease.Rent).toFixed(2));
                    }
                    else {
                        $('#tbxRent').val('0.00');
                    }
                    if (Leaseflag == undefined) {
                        if (result.calcLease.DeliveryCashDue != '') {
                            $('#tbxDeliveryCashDue').val(parseFloat(result.calcLease.DeliveryCashDue).toFixed(2));
                        }
                        else {
                            $('#tbxDeliveryCashDue').val('0.00');
                        }
                    }
                    if (result.calcLease.TotalCustomerCash != '') {
                        $('#tbxCustomerCash').val(parseFloat(result.calcLease.TotalCustomerCash).toFixed(2));
                    }
                    else {
                        $('#tbxCustomerCash').val('0.00');
                    }
                    if (result.calcLease.FeeAndTaxTotal != '') {
                        $('#tbxFeesAndTaxes').val(parseFloat(result.calcLease.FeeAndTaxTotal).toFixed(2));
                    }
                    else {
                        $('#tbxFeesAndTaxes').val('0.00');
                    }
                    if (result.calcLease.TotalDepreciation != '') {
                        $('#tbxTotalDepreciation').val(parseFloat(result.calcLease.TotalDepreciation).toFixed(2));
                    }
                    else {
                        $('#tbxTotalDepreciation').val('0.00');
                    }
                    if (result.calcLease.TotalUseTax != '') {
                        $('#tbxTotalUseTax').val(parseFloat(result.calcLease.TotalUseTax).toFixed(2));
                    }
                    else {
                        $('#tbxTotalUseTax').val('0.00');
                    }
                    if (result.calcLease.CRTax != '') {
                        $('#tbxCapRedTax').val(parseFloat(result.calcLease.CRTax).toFixed(2));
                    }
                    else {
                        $('#tbxCapRedTax').val('0.00');
                    }
                    if (result.calcLease.TotalPayment != '') {
                        $('#tbxTotalPayment').val(parseFloat(result.calcLease.TotalPayment).toFixed(2));
                    }
                    else {
                        $('#tbxTotalPayment').val('0.00');
                    }
                    if (result.calcLease.PropertyTax != '') {
                        $('#tbxPropertyTax').val(parseFloat(result.calcLease.PropertyTax).toFixed(2));
                    }
                    else {
                        $('#tbxPropertyTax').val('0.00');
                    }
                    if (result.calcLease.GrossReceiptsTax != '') {
                        $('#tbxGrossReceiptsTax').val(parseFloat(result.calcLease.GrossReceiptsTax).toFixed(2));
                    }
                    else {
                        $('#tbxGrossReceiptsTax').val('0.00');
                    }
                    if (result.calcLease.Residual != '') {
                        $('#tbxResidualAmount').val(addDecimalPointIfNot(result.calcLease.Residual));
                    }
                    else {
                        $('#tbxResidualAmount').val('0.00');
                    }
                    if (result.calcLease.SecurityDepAmount != '') {
                        $('#tbxSecdepAmt').val(parseFloat(result.calcLease.SecurityDepAmount).toFixed(2));
                    }
                    else {
                        $('#tbxSecdepAmt').val('0.00');
                    }
                }
            }
        },
        error: function (error) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
    Checkunwindbutton();
}

function AjaxCalcCallForCash(ScenarioID) {
    Checkunwindbutton();
    $("#CalculationInProgress").show();
    $('body').css('cursor', 'wait');
    $.ajax({
        url: "./../calcengine/CheckPreRequireValue",
        type: 'Post',
        cache: false,
        success: function (result) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
            if (result.result != "fail") {
                if ($('#DetailsClicked').val() == '') {
                    if (result.calcCash.Payment != "") {
                        $("#tbxAmountDue").val(parseFloat(result.calcCash.Payment).toFixed(2));
                    }
                    else {
                        $("#tbxAmountDue").val("");
                    }
                    if (result.calcCash.FeeAndTaxTotal != "") {
                        $("#item_FeesAndTaxes").val(parseFloat(result.calcCash.FeeAndTaxTotal).toFixed(2));
                    }
                    else {
                        $("#item_FeesAndTaxes").val("");
                    }
                }
                else {
                    $('#tbxTaxablePrice').val(addDecimalPointIfNot(result.calcCash.TaxablepriceCash));
                    if (result.calcCash.Payment != '') {
                        $('#tbxStockCash').val(parseFloat(result.calcCash.Payment).toFixed(2));
                    }
                    else {
                        $('#tbxStockCash').val('0.00');
                    }
                    if (result.calcCash.FeeAndTaxTotal != '') {
                        $('#tbxFeesAndTaxes').val(parseFloat(result.calcCash.FeeAndTaxTotal).toFixed(2));
                    }
                    else {
                        $('#tbxFeesAndTaxes').val('0.00');
                    }
                }
            }
        },
        error: function (error) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
}

function AjaxCalcCallForBalloon(ScenarioID) {
    Checkunwindbutton();
    $("#CalculationInProgress").show();
    $('body').css('cursor', 'wait');
    $.ajax({
        url: "./../calcengine/CheckPreRequireValue",
        type: 'Post',
        cache: false,
        success: function (result) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
            if (result.result != "fail") {
                if ($('#DetailsClicked').val() == '') {
                    if (result.calcBalloon.AmountFinanced != "") {
                        $("#tbxAmtFinanceActiv").val(parseFloat(result.calcBalloon.AmountFinanced).toFixed(2));
                    }
                    else {
                        $("#tbxAmtFinanceActiv").val("");
                    }
                    if (result.calcBalloon.Payment != "") {
                        $("#tbxPaymentFinBal").val(parseFloat(result.calcBalloon.Payment).toFixed(2));
                    }
                    else {
                        $("#tbxPaymentFinBal").val("");
                    }
                    if (result.calcBalloon.FeeAndTaxTotal != "") {
                        $("#item_FeesAndTaxes").val(parseFloat(result.calcBalloon.FeeAndTaxTotal).toFixed(2));
                    }
                    else {
                        $("#item_FeesAndTaxes").val("");
                    }
                }
                else {
                    $('#tbxTaxablePrice').val(addDecimalPointIfNot(result.calcBalloon.TaxablepriceBalloon));
                    if (result.calcBalloon.FinanceCharge != '') {
                        $('#tbxFinanceCharges').val(parseFloat(result.calcBalloon.FinanceCharge).toFixed(2));
                    }
                    else {
                        $('#tbxFinanceCharges').val('0.00');
                    }
                    if (result.calcBalloon.Payment != '') {
                        $('#tbxPayment').val(parseFloat(result.calcBalloon.Payment).toFixed(2));
                    }
                    else {
                        $('#tbxPayment').val('0.00');
                    }
                    if (result.calcBalloon.AmountFinanced != '') {
                        $('#tbxAmountFinanced').val(parseFloat(result.calcBalloon.AmountFinanced).toFixed(2));
                    }
                    else {
                        $('#tbxAmountFinanced').val('0.00');
                    }
                    if (result.calcBalloon.TotalPayment != '') {
                        $('#tbxTotalPayment').val(parseFloat(result.calcBalloon.TotalPayment).toFixed(2));
                    }
                    else {
                        $('#tbxTotalPayment').val('0.00');
                    }
                    if (result.calcBalloon.FeeAndTaxTotal != '') {
                        $('#tbxFeesAndTaxes').val(parseFloat(result.calcBalloon.FeeAndTaxTotal).toFixed(2));
                    }
                    else {
                        $('#tbxFeesAndTaxes').val('0.00');
                    }
                    if (result.calcBalloon.PrecissionedAPR != '') {
                        $('#tbxAPR').val(result.calcBalloon.PrecissionedAPR + "%");
                    }
                    else {
                        $('#tbxAPR').val('0.0%');
                    }
                    if (result.calcBalloon.BalloonPayment != '') {
                        $('#tbxBalloonPayment').val(parseFloat(result.calcBalloon.BalloonPayment).toFixed(2));
                    }
                    else {
                        $('#tbxBalloonPayment').val('0.00');
                    }
                }
            }
        },
        error: function (error) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
}

function CheckForStockNum(ScenarioID, DetailsYesNo) {
    $('#HiddenPopUpName').val('Rebates');
    var URL = './../Scenario/CheckStockForActiveScenario';
    $.ajax({
        type: 'Post',
        url: URL,
        beforeSend: function () {
            $('#DesksInProgress').show();
        },
        success: function (result) {
            $('#DesksInProgress').hide();
            if (result.Msg != "success") {
                ShowAlertForRebate('Please add vehicle before adding Rebates.');
                return false;
            }
            var url = "./../Rebate/ViewEditRebates?scenarioID=" + ScenarioID + "&DetailsYesNo=" + DetailsYesNo;
            $.ajax({
                type: "POST",
                url: url,
                beforeSend: function () {
                    $('#DesksInProgress').show();
                },
                success: function (RM) {
                    $('#DesksInProgress').hide();
                    $("#viewEditContactArea").html(RM);
                    centrpop('#DivPopUp');
                    popupload('#backgroundsearch', '#DivPopUp');
                    $("#DivPopUp").removeClass("popTradeIn");
                    $("#DivPopUp").css("left", "1%");
                    $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
                }
            });
        },
        error: function (result) {
            ShowAlertMessageIndex('Failing.');
        }
    });
}

function AddAdvanceDatepicker(date, ID) {
    var monthNow = (new Date).getMonth();
    var yearNow = (new Date).getFullYear();
    switch (monthNow) {
        case 10:
            if ($(date).val() == '') {
                $(date).val('12/01/' + yearNow);
            }
            break;
        case 11:
            if ($(date).val() == '') {
                $(date).val('01/01/' + (yearNow + 1));
            }
            break;
        default:
            if ($(date).val() == '') {
                if (monthNow < 8) {
                    $(date).val('0' + (monthNow + 2) + '/01/' + yearNow);
                }
                else {
                    $(date).val((monthNow + 2) + '/01/' + yearNow);
                }
            }
    }
    var ScenarioID = "";
    if (ID == '') {
        ScenarioID = $('#hiddenstckScID').val();
    }
    else {
        ScenarioID = ID;
    }
}

function RedirectToScenario_old(ScenarioID, DetailsYesNo) {
    var URL = './../Scenario/_ScenarioDetails';
    if (DetailsYesNo != 'Yes') {
        URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + ScenarioID;
        window.location.href = URL;
    }
    else {
        $.ajax({
            type: "POST",
            url: URL,
            data: { id: ScenarioID },
            success: function (LoadScenarioDetails) {
                $("#DivScenarioDetails").html(LoadScenarioDetails);

            }
        });
    }
}

function RefreshContractdate() {
    var URL = './../Scenario/RefreshContractDate';
    $.ajax({
        type: "POST",
        url: URL,
        success: function (result) {
        }
    });
}

function RedirectToScenario(ScenarioID, DetailsYesNo) {
    $("#CalculationInProgress").show();
    //03.02.FRD004 Finance Terms - Browser refresh returns focus to Scenario Summary
    if ($('#HiddenScenDetailsLoad').val() == '1' || DetailsYesNo == 'Yes')
        var scenDetClicked = true;
    else
        var scenDetClicked = false;

    var URL = './../Scenario/_ScenarioDetails?Detailsclicked=' + scenDetClicked;
    if (DetailsYesNo != 'Yes') {
        $('input[name="ScenarioDetails"]').removeAttr("disabled", "disabled");
        GetActiveScenarioLabels();
        GetActiveScenarioModel();
    }
    else {
        $.ajax({
            type: "POST",
            url: URL,
            data: { id: ScenarioID },
            success: function (LoadScenarioDetails) {
                $("#DivScenarioDetails").html('');
                $("#DivScenarioDetails").html(LoadScenarioDetails);
                GetScenarioStatus(ScenarioID);
                //Modified by Shalu David on 9/23/13 for Task 11519
                $('#btnYes_Deal1').removeAttr("disabled", "disabled");
                $("#BtnCancel_Deal1").removeAttr("disabled", "disabled");
                $('#btnYes_Deal2').removeAttr("disabled", "disabled");
                $("#BtnCancel_Deal2").removeAttr("disabled", "disabled");
                $("#CalculationInProgress").hide();
            }
        });
    }
}

function GetActiveScenarioLabels() {
    var url = "./../Scenario/_ActiveScenarioLabels";
    $.ajax({
        type: "POST",
        url: url,
        success: function (LoadScenarioDetails) {
            $("#DivActiveScenarioLabels").html(LoadScenarioDetails);
        }
    });
}

function ShowAlertMessageIndex(message) {
    $("#alert_index p").html(message);
    centrpop('#alert_index');
    popupload('#alertPOp_index', '#alert_index');
}
function ShowTradeAlertMessagex(message) {
    $("#alert_index p").html(message);
    centrpop('#alert_index');
    popupload('#bg_apprisal', '#alert_index');
}

function LoadDetailsOrMain(ScenarioID) {
    var id = ScenarioID;
    AjaxCallToScenario(id);
}

function GetScenarioStatus(id) {
    var URL = './../Scenario/GetScenarioStatus?id=' + id;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            var scenariostatus = result.Status;
            var deskstatus = result.DeskStatus;
            $("#btnYesUnwind").removeAttr("disabled", "disabled");
            $("#BtnCancelUnwind").removeAttr("disabled", "disabled");
            if (deskstatus != "Scenario") {
                if (scenariostatus == deskstatus) {
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    $("#unwind_deal").removeClass('disableLinkUnwind');
                }
                else {
                    $("#unwind_deal").attr("disabled", "disabled");
                    $("#unwind_deal").addClass('disableLinkUnwind');
                }


                if (deskstatus == "Posted Deal" || (deskstatus == "Closed Deal" && $("#HiddenIsPendingDeal").val() == 'False')) {
                    $("#unwind_deal").attr("disabled", "disabled");
                    $("#unwind_deal").addClass('disableLinkUnwind');
                }
                else {
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    $("#unwind_deal").removeClass('disableLinkUnwind');
                }

            }
        }
    });
}

function AjaxCallToScenario(id) {
    var SnID = id.split("|");
    // if active scenario id == 0 then load main div else load info section
    $('#FinIDForLender').val(SnID[1]);
    $("#HiddenFinanceID").val(SnID[1]);
    if (SnID[0] == "0") {
        return false;
    }
    //if($('#HiddenScenDetailsLoad').val()=='1')
    var scenDetClicked = true;
    //    else
    //      var scenDetClicked=false;

    var URL = './../Scenario/_ScenarioDetails?id=' + SnID[0] + '&Detailsclicked=' + scenDetClicked;
    $.ajax({
        type: 'Post',
        url: URL,
        beforeSend: function () {
            $('#DesksInProgress').show();
        },
        success: function (result) {
            $('#HiddenScenDetailsLoad').val('');
            $("#MainDiv").hide();

            $("#DivArrow").show();
            $("#deskName").css('margin-left', '35px');
            $("#RightDropdown").show();
            if (SnID[1] == 2)
                $("#listDealRecap").hide();
            $("#DealRelatedDiv").show();
            $("#DivScenarioDetails").show("slide", { direction: "left" }, 100);
            $("#DivFinanceTypes").show();
            SelectFinanceType(SnID[1]);
            $("#OriginalFinType").val(SnID[1]);
            $("#create_scenario").hide();
            $("#Copy_scenario").hide();
            $("#HiddenScenarioID").val(SnID[0]),
            $("#DivScenarioDetails").html(result);
            GetScenarioStatus(SnID[0]);
            $('#DesksInProgress').hide();
        },
        error: function (error) {

        }
    });
    $('#DetailsClicked').val('yes');
}

function SelectFinanceType(str) {
    $(".radiolist[value='" + str + "']").attr("checked", true);
}

function ShowMainDiv() {
    $('#DesksInProgress').show();
    var ScenarioID = $('#HiddenScenarioID').val();
    var URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + ScenarioID;
    //03.02.FRD004 Finance Terms - Browser refresh returns focus to Scenario Summary
    $.ajax({
        url: './../Scenario/SetShowDetails?shouldShow=false',
        type: 'POST'
    });

    window.location.href = URL;
}

function NewInactiveScenarioDetailsClick(id) {
    $('#HiddenScenDetailsLoad').val('1');
    LoadScenarioDetailsClick(id);
}

function LoadScenarioDetailsClick(id) {
    var SnID = id.split("|");
    $('#DesksInProgress').show();
    $.ajax({
        type: "POST",
        contentType: "application/json; charset=utf-8",
        url: "./../Scenario/CheckScenarioDealType",
        data: "{'ScenarioID':'" + SnID[0] + "'}",

        success: function (result) {
            if (result.message == "Retail") {
                EnableDisableCobuyer('Yes');
            }
            else {
                EnableDisableCobuyer('');
            }

        }
    });
    var SnID = id.split("|");
    window.location.href = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + SnID[0] + '&NewActive=true';

}

$('#ActiveScenDetClick').click(function () {
    $('#HiddenScenDetailsLoad').val('1');
    var id = $('#HiddenScenId').val() + "|" + $('#HiddenActiveFinanceID').val();
    LoadScenarioDetails(id);
});
function LoadScenarioDetails(id) {
    $('#HiddenStockEntered').val('');
    $('#tbxStockNum1').val('');
    $('#DesksInProgress').show();
    $('#MainDiv').hide();
    $('#DetailsClicked').val('yes');
    if ($('#Label_RefreshCustomer').val() != '') {
        $('#IndexrefreshCustomer_message').show();
    }
    else {
        $('#IndexrefreshCustomer_message').hide();
    }
    var SnID = id.split("|");
    $("#HiddenScenarioID").val(SnID[0]);
    var FirstPaymentControl = document.getElementById("tbxFirstPaymentHidden");
    AddAdvanceDatepicker(FirstPaymentControl, SnID[0]);
    var URL = './../Scenario/GetDeskAndScenarioStatus?id=' + SnID[0];
    $.ajax({
        type: 'Post',
        url: URL,
        beforeSend: function () {
            $('#DesksInProgress').show();
        },
        success: function (result) {
            $('#DesksInProgress').hide();
            var deskStatus = result.DeskStatus;
            var scenarioStatus = result.ScenarioStatus;
            var IsPending = result.IsPendingDeal;
            var WaitOnProcessComplete = result.WaitOnProcessComplete;
            var ErrorMessage = result.ErrorMessage;
            if (deskStatus == "Scenario") {
                if (scenarioStatus == "Scenario") {
                    $('#create_deal').show();
                    $('#ETAP').show();
                }
            }
            else {
                if (deskStatus == "Open Deal" || deskStatus == "Contracting Deal" || deskStatus == "Delivered Deal" || deskStatus == "Closed Deal"
                        || deskStatus == "Rejected Deal" || deskStatus == "Rejected Closed Deal" || deskStatus == "Rejected Posted Deal") {
                    if (scenarioStatus == "Open Deal" || scenarioStatus == "Contracting Deal" || scenarioStatus == "Delivered Deal" || scenarioStatus == "Closed Deal"
                            || scenarioStatus == "Rejected Deal" || scenarioStatus == "Rejected Closed Deal" || scenarioStatus == "Rejected Posted Deal") {
                        $('#unwind_deal').show();
                        if ((scenarioStatus == "Closed Deal" && $("#HiddenIsPendingDeal").val() == 'False') || scenarioStatus == "Posted Deal") {
                            $("#unwind_deal").addClass('disableLinkUnwind');
                            $("#unwind_deal").attr("disabled", "disabled");
                        }
                        else {
                            $("#unwind_deal").removeAttr("disabled", "disabled");
                            $("#unwind_deal").removeClass('disableLinkUnwind');
                        }
                    }
                    else {
                        $('#unwind_deal').show();
                        $("#unwind_deal").addClass('disableLinkUnwind');
                        $("#unwind_deal").attr("disabled", "disabled");
                    }
                    if (IsPending == true || WaitOnProcessComplete == true) {
                        if (ErrorMessage != null && ErrorMessage != "") {
                            $('#unwind_deal').show();
                            $("#unwind_deal").removeAttr("disabled", "disabled");
                            document.getElementById("error_message").style.display = "";
                        }
                        else {
                            $('#unwind_deal').hide();
                            $("#unwind_deal").attr("disabled", "disabled");
                            document.getElementById("error_message").style.display = "none";
                        }
                    }
                }
                else {
                    $('#unwind_deal').show();
                    $("#unwind_deal").attr("disabled", "disabled");
                    $("#unwind_deal").addClass('disableLinkUnwind');
                }
            }
            if (deskStatus == "Open Deal") {
                if (scenarioStatus == "Open Deal") {
                    $('#econtract_deal').show();
                    $('#audittrail_deal').show();
                }
            }
            if (deskStatus == "Contracting Deal") {
                if (scenarioStatus == "Contracting Deal") {
                    //TFS ID 19044 -- 03.09.FRD046 Send to Contracting - Not receiving error message from AX
                    if (IsPending == true)
                        $('#delivered_deal').hide();
                    else
                        $('#delivered_deal').show();

                }
            }
            if (deskStatus != "Scenario") {
                if (scenarioStatus == "Scenario") {
                    $('#cancel_deal').show();
                    $("#cancel_deal").attr("disabled", "disabled");
                }
                else {
                    $('#cancel_deal').show();
                }
            }
        },
        error: function (error) {
        }
    });
    AjaxCallToScenario(id);
}

function chkNumeric(strString) {
    var strValidChars = "0123456789.";
    var strChar;
    var blnResult = true;
    if (strString.length == 0) return false;
    //  test strString consists of valid characters listed above
    for (i = 0; i < strString.length && blnResult == true; i++) {
        strChar = strString.charAt(i);
        if (strValidChars.indexOf(strChar) == -1) {
            blnResult = false;
        }
    }
    return blnResult;
}

function ShowAlertForRefreshLender(message) {
    $("#alertRefreshLender #msg").html(message);
    centrpop('#alertRefreshLender');
    popupload('#bgpopup', '#alertRefreshLender');
}

function ShowAlertForRefreshInanctiveLender() {
    centrpop('#RefreshInactiveLender');
    popupload('#bg_RefreshInactiveLender', '#RefreshInactiveLender');
}

function IndexShowAlertForRefreshRebates(message) {
    $("#IndexalertRefreshRebates #msg").html(message);
    centrpop('#IndexalertRefreshRebates');
    popupload('#IndexalertPOp_rebate', '#IndexalertRefreshRebates');
    $('#IndexalertRefreshRebates').css("top", "20%");
}

function IndexShowAlertForRefreshServiceContract(message) {
    $("#IndexalertRefreshServiceContract #msg").html(message);
    centrpop('#IndexalertRefreshServiceContract');
    var popuppos = parseInt($('#IndexalertRefreshServiceContract').css('top')) - 50;
    $('#IndexalertRefreshServiceContract').css('margin-top', '-' + popuppos + 'px');
    popupload('#IndexbgalertRefreshServiceContract', '#IndexalertRefreshServiceContract');
}

function IndexShowAlertForRefreshFees(message) {
    $("#IndexalertRefreshFees #msg").html(message);
    centrpop('#IndexalertRefreshFees');
    var popupposTop = parseInt($('#IndexalertRefreshFees').css('top')) - 150;
    var popupposLeft = parseInt($('#IndexalertRefreshFees').css('left')) - 400;
    $('#IndexalertRefreshFees').css({ 'margin-top': '-' + popupposTop + 'px', 'margin-left': '-' + popupposLeft + 'px' });
    popupload('#IndexbgalertRefreshFees', '#IndexalertRefreshFees');
}

function IndexShowAlertForRefreshAfterMarkets(message) {
    $("#IndexalertRefreshAfterMarket #msg").html(message);
    centrpop('#IndexalertRefreshAfterMarket');
    var popuppos = parseInt($('#IndexalertRefreshAfterMarket').css('top')) - 50;
    $('#IndexalertRefreshAfterMarket').css('margin-top', '-' + popuppos + 'px');
    popupload('#IndexbgalertRefreshAfterMarket', '#IndexalertRefreshAfterMarket');
}

function IndexShowAlertForRefreshInsurance(message) {
    $("#IndexalertRefreshInsurance #msg").html(message);
    centrpop('#IndexalertRefreshInsurance');
    var popupposTop = parseInt($('#IndexalertRefreshInsurance').css('top')) - 50;
    var popupposLeft = parseInt($('#IndexalertRefreshInsurance').css('left')) - 250;
    $('#IndexalertRefreshInsurance').css({ 'margin-top': '-' + popupposTop + 'px', 'margin-left': '-' + popupposLeft + 'px' });
    popupload('#IndexbgalertRefreshInsurance', '#IndexalertRefreshInsurance');
}

function loadPopupsearch() {
    if (popupStatus == 0) {
        $(" #backgroundsearch").css({
            "opacity": "0.7"
        });
        popupload("#backgroundsearch", "#popupContactsearch");
        $('#BasicSearchSV .focus').focus();
        popupStatus = 1;
    }
}

function centerPopupsearch() {
    var windowWidth = document.documentElement.clientWidth;
    var windowHeight = document.documentElement.clientHeight;
    var popupWidth = 260;
    var popupHeight = 276;
    var popupHeight = $("#popupContactsearch").height();
    var popupWidth = $("#popupContactsearch").width();
    if (popupWidth == 0) {
        $("#popupContactsearch").css({
            "position": "absolute",
            "top": windowHeight / 4,
            "left": windowWidth / 4
        });
    }
    else {
        $("#popupContactsearch").css({
            "position": "absolute",
            "top": windowHeight / 2 - popupHeight / 2,
            "left": windowWidth / 2 - popupWidth / 2
        });
    }//only need force for IE6
}

function RedirectToCustomerSearch(deskstatus, CustomerID, showDetail) {
    $('#HiddenPopUpName').val('Customer');
    if (deskstatus != "Scenario") {
        if (CustomerID != null && CustomerID != '' && CustomerID != 'undefined') {
            var URL = "./../CobuyerSearch/CustomerHistory?CustomerID=" + CustomerID;
            $.ajax({
                type: 'Post',
                url: URL,
                beforeSend: function () {
                    $('#DesksInProgress').show();
                },
                success: function (result) {
                    $('#DesksInProgress').hide();
                    $("#customr_info").html(result);
                    if (showDetail) {
                        ShowDetails($('#btnShowDetails')[0]);
                    }
                    centrpop('#Customerpopop');
                    popupload('#backgroundsearch', '#Customerpopop');

                },
                error: function (result) {
                }
            });
        }
    }
    else {
        var URL = "";
        if (CustomerID != null && CustomerID != '' && CustomerID != 'undefined') {
            URL = "./../CobuyerSearch/CustomerHistory?CustomerID=" + CustomerID;
        }
        else {
            URL = './../CoBuyerSearch/AddCustomerToDesk?CustomerIDForCoBuyer=';
        }
        $.ajax({
            type: 'Post',
            url: URL,
            beforeSend: function () {
                $('#DesksInProgress').show();
            },
            success: function (result) {
                $('#DesksInProgress').hide();
                $("#customr_info").html(result);
                centrpop('#Customerpopop');
                $("#searchtitle").html("Customer Information");
                if (showDetail) {
                    ShowDetails($('#btnShowDetails')[0]);
                }
                $("#BackButtonDiv").hide();
                $("#PrevNextButtons").hide();
                $("#AddCustToDesk").hide();
                popupload('#backgroundsearch', '#Customerpopop');
            },
            error: function (result) {
            }
        });
    }
}

function RedirectToVehicleSearch(Scenario, DetailsYesNo) {
    if ($("#HiddenPageID").val() != 'BD') {
        var URL = './../SearchVehicle/BasicSearch?ScenarioID=' + Scenario.id + '&DetailsYesNo=' + DetailsYesNo;
        $.ajax({
            type: 'Post',
            url: URL,
            beforeSend: function () {
                $('#DesksInProgress').show();
            },
            success: function (result) {
                $('#DesksInProgress').hide();
                $("#DivVehiclePopUp").html(result);
                centerPopupsearch();
                loadPopupsearch();
                $(".RightDropdown").val('SceDetails');
            },
            error: function (result) {
            }
        });
    }
    else {
        return false;
    }
}

function ShowAlertForError_RDR() {
    $.ajax({
        type: 'Post',
        url: './../Scenario/GetRDRResponseMessage',
        success: function (result) {
            if (result.IsPending == true || result.WaitOnProcessComplete == true) {
                $("#Span_RDR").hide();
            }
            else if (result.Response == "Failed") {
                $.ajax({
                    type: 'Post',
                    url: './../Scenario/GetRDRErrorMessage',
                    success: function (result) {
                        if (result.DeskStatus == "Delivered Deal" || result.DeskStatus == "Posted Deal") {
                            document.getElementById("ResendRDRBtn").style.display = "";
                        }
                        else {
                            document.getElementById("ResendRDRBtn").style.display = "none";
                        }
                        $("#alertError_RDR #msg").html(result.Response);
                        centrpop('#alertError_RDR');
                        popupload('#bgpopup', '#alertError_RDR');
                    }
                });
            }
        },
        error: function (error) {
        }
    });
}

function ShowAlertForPending() {
    $.ajax({
        type: 'Post',
        url: './../Scenario/GetPendingDealErrorMessage',
        success: function (result) {
            if (result.Response != "") {
                $("#alertError #msg").html(result.Response);
                centrpop('#alertError');
                popupload('#bgpopup', '#alertError');
            }
        }
    });
}

function ResendDataToRDR() {
    $.ajax({
        type: 'Post',
        url: './../Scenario/SendingDataToRDR',
        success: function (result) {
            popupdisable('#alertError_RDR', '#bgpopup');
            if (result.Response == "") {
                $("#Span_RDR").hide();
            }
            else {
                $("#Span_RDR").show();
                if (result.Response == "Failed") {
                    $("#Label_Title_RDR").html("RDR Failed");
                    $('#Label_Title_RDR').css('color', 'red');
                }
                else if (result.Response == "Success") {
                    $('#Label_Title_RDR').css('color', 'white');
                    $("#Label_Title_RDR").html("RDR Successful");
                }
                else {
                    $("#Span_RDR").show();
                    $('#Label_Title_RDR').css('color', 'white');
                    $("#Label_Title_RDR").html("RDR In Progress");
                }
            }
        },
        error: function (error) {
        }
    });
}

function modularAddCustomer() {
    $('#CustomertoDeskSearchInProgress').show();
    var URL = './../CoBuyerSearch/SetUpCustomer?UseLayout=' + false;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            $('#CustomertoDeskSearchInProgress').hide();
            $('body').css('cursor', 'auto');
            $("#HiddenFirstCust").val("Yes");
            $('.pagetitle').html("Add Customer");
            $("#Searchdata").html(result);
            $('#Searchdata>div>.pagrTitle').hide();
            $('#btnAdd').live('click', function () {
                $("#alertok, #alertCross").live('click', saveCustToDesk);
            });
            var btnCancel = $('#btnCancel');
            btnCancel.parent().removeClass('hide');
            btnCancel.live('click', function () {
                if ($('#BasicSearch').length) {
                    $('#BasicSearch').trigger('click');
                }
                else if ($('#SearchCustomer').length) {
                    $('#SearchCustomer').trigger('click');
                }
                else {
                    console.log('The cancel button was not wired with the right selector. Please look at ln 1790 IndexJS.js.');
                }
            });
        },
        error: function (error) {
            $('#CustomertoDeskSearchInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
}

function saveCustToDesk() {
    var id = $('#newCustomerId').val();
    if (id !== '0') {
        var URL = "./../CobuyerSearch/SaveNewCustomerToDesk?AttachCustID=" + id;
        $.ajax({
            type: 'Post',
            url: URL,
            success: function (data) {
                ShowAlertMessage('Customer added successfully.', function () { uncachePage('&showDetail=' + true); });
            },
            error: function (result) {
            }
        });
    }
    $("#alertok, #alertCross").die('click', saveCustToDesk);
}

function uncachePage(param) {
    window.location.href = window.location.href.replace('#', '') + '&reload=' + new Date().getTime() + param;
}

function CallEContract(IsRo, isSSNCust, isSSNCoCust) {
    $.ajax({
        type: "POST",
        url: "./../Scenario/EContractDeal",
        data: { IsROExist: IsRo, flagSSNCust: isSSNCust, flagSSNCoCust: isSSNCoCust },
        //Bug# 17519 -- Showing Processing message and disabling the econtract deal button when u click on EcontractDeal button
        beforeSend: function () {
            $('#DesksInProgress').show();
            $("#econtract_deal").attr("disabled", true);
            $("#econtract_deal").addClass('disableLinkUnwind');
        },
        success: function (result) {
            if (result.Success == false) {
                $('#DesksInProgress').hide();
                $("#econtract_deal").removeAttr("disabled", "disabled");
                $("#econtract_deal").removeClass('disableLinkUnwind');

                if (result.SectionName == "Customer") {
                    CustomerValidations(result.CustStatus);
                }
                else if (result.SectionName == "Vehicle") {
                    VehicleValidation(result.FieldName);
                }
                else if (result.SectionName == "Lender") {
                    LenderValidation(result.FieldName);
                }
                else if (result.SectionName == "DealType") {
                    ShowAlertMessageIndex("DealType field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "Insurance") {
                    ShowAlertMessageIndex("Insurance field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "TradeIn") {
                    TradeInValidations(result.FieldName);
                }
                else if (result.SectionName == "Rebate") {
                    ShowAlertMessageIndex("Rebate field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "ServiceContract") {
                    ServiceContractValidations(result.FieldName);
                }
                else if (result.SectionName == "Fees") {
                    ShowAlertMessageIndex("Fees field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "Tax") {
                    ShowAlertMessageIndex("Tax field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "Status") {
                    ShowAlertMessageIndex(result.FieldName + " section status is not complete. Please update the section.");
                }
                else if (result.SectionName == "AmountFinanced") {
                    ShowAlertMessageIndex("Amount Financed cannot be a negative amount.");
                }
                else if (result.SectionName == "NetCapCost") {
                    ShowAlertMessageIndex("Net Cap Cost cannot be a negative amount.");
                }
                else if (result.SectionName == "Special Lease Program") {
                    if (result.FieldName == "1st Pay - Lender") {
                        ShowAlertMessageIndex("Lender contribution must be greater than zero for " + result.FieldName);
                    }
                    else if (result.FieldName == "1st Pay - Dealer") {
                        ShowAlertMessageIndex("Dealer contribution must be greater than zero for " + result.FieldName);
                    }
                    else if (result.FieldName == "1st Pay - Manufacturer") {
                        ShowAlertMessageIndex("Manufacturer contribution must be greater than zero for " + result.FieldName);
                    }
                    else if (result.FieldName == "1st Pay - Custom") {
                        ShowAlertMessageIndex("At lease one contribution must be greater than zero for " + result.FieldName);
                    }
                }
                else if (result.SectionName == "Finance") {
                    if (result.FieldName == "Miscellaneous") {
                        ShowAlertMessageIndex("Miscellaneous section is in progress.  Please complete this section and try again.");
                    }
                    else if (result.FieldName == "MSRP") {
                        ShowAlertMessageIndex("MSRP section is in progress.  Please complete this section and try again.");
                    }
                    else {
                        ShowAlertMessageIndex("The following fields failed validation :</br> " + result.FieldName);
                    }
                }
                //$("#econtract_deal").removeAttr("disabled", "disabled");
            }
            else if (result.Success == true) {
                $('#DesksInProgress').hide();
                if (result.IsroExist == "Yes") {
                    var msg = "Open RO’s exist for the selling vehicle. Please communicate with service to close the" +
                     " RO if work is complete or, add an aftermarket We Owe item to the deal for each open RO." +
                      "</br></br> If no action is taken your Gross could be incorrect. </br></br>"
                    LoadROConfirm(msg);
                    return;
                }
                else if (result.viewdataInventory == "Yes") {
                    centrpop('#contactAreaDeal_ApprInventory');
                    popupload('#divInventory', '#contactAreaDeal_ApprInventory');
                    $("#btnYes_ApprInventory").removeAttr("disabled", "disabled");
                    $("#BtnCancel_ApprInventory").removeAttr("disabled", "disabled");
                    return;
                }
                else if (result.viewdata == "Yes") {
                    centrpop('#contactAreaDeal_Appr');
                    popupload('#backgroundDeal_Appr', '#contactAreaDeal_Appr');
                    $("#btnYes_Appr").removeAttr("disabled", "disabled");
                    $("#BtnCancel_Appr").removeAttr("disabled", "disabled");
                    return;
                }
                else if (result.paymentValidation != '') {
                    var msg = result.paymentValidation + "</br> Would you like to proceed to Contracting Deal?";
                    document.getElementById("lblmsg3").innerHTML = msg;
                }
                else {
                    var msg = " Would you like to proceed to Contracting Deal?";
                    document.getElementById("lblmsg3").innerHTML = msg;
                }

                centrpop('#contactAreaDeal');
                popupload('#backgroundDeal', '#contactAreaDeal');
                $("#btnYes_Deal").removeAttr("disabled", "disabled");
                $("#BtnCancel_Deal").removeAttr("disabled", "disabled");
            }
        }
    });
}

function VehicleValidation(result) {
    if (result == "Reserved") {
        ShowAlertMessageIndex("Vehicle status is not in Reserved Status for the current Open Deal.");
    }
    else if (result == "Ordered") {
        ShowAlertMessageIndex("Vehicle status is not in In-Stock Status for the current Open Deal.");
    }
    else if (result == "Customer Reserved") {
        ShowAlertMessageIndex("Vehicle DealerGroupStatus is in Customer Reserved status for the current Open Deal.");
    }
    else if (result == "Stocknumber") {
        ShowAlertMessageIndex("Stock number is associated to other Deal.");
    }
}

function LenderValidation(result) {
    if (result == "LenderInactive") {
        ShowAlertMessageIndex("Lender is inactive for the current Open Deal.");
    }
    else if (result == "ContractInactive") {
        //Modified by Shalu David as per Bug 11632 on 9/17/13
        ShowAlertMessageIndex("The Lender Contract Code is inactive. Please select a different Contract Code.");
    }
    else if (result == "NoContract") {
        ShowAlertMessageIndex("Contract Code for Lender section failed validation. Please update the section.");
    }
    else if (result == "NoLender") {
        ShowAlertMessageIndex("Lender Type for Lender section failed validation. Please update the section.");
    }
}

function ServiceContractValidations(result) {
    if (result == "InActive") {
        ShowAlertMessageIndex("Service Contract is inactive for the current Open Deal.");
    }
    else if (result == "ContractNum") {
        ShowAlertMessageIndex("Contract Number for Service Contract section failed validation. Please update the section.");
    }
    else if (result == "StartDate") {
        ShowAlertMessageIndex("Start Date for Service Contract section failed validation. Please update the section.");
    }
    else if (result == "StartingMiles") {
        ShowAlertMessageIndex("Starting Miles for Service Contract section failed validation. Please update the section.");
    }
    else if (result == "EndDate") {
        ShowAlertMessageIndex("End Date for Service Contract section failed validation. Please update the section.");
    }
    else if (result == "EndingMiles") {
        ShowAlertMessageIndex("Ending Miles for Service Contract section failed validation. Please update the section.");
    }
}

function TradeInValidations(result) {
    if (result == "NoStockNumber") {
        ShowAlertMessageIndex("The Trade-in included on the deal must have a stock number.");
    }
    else if (result == "StatusInComplete") {
        ShowAlertMessageIndex("Trade-in section status is not complete. Please update the section.");
    }
    else if (result == "NoPayoff" || result == "PayOffLessThanZero") {
        ShowAlertMessageIndex("Payoff for Trade-in section failed validation. Please update the section.");
    }
    else if (result == "NoLienHolder") {
        ShowAlertMessageIndex("LienHolder for Trade-in section failed validation. Please update the section.");
    }
    else if (result == "TradeInAlreadyInStock") {
        ShowAlertMessageIndex("The Trade-in vehicle is already in stock and cannot be included as a trade-in on this deal");
    }
        // Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
    else if (result == "TradeInCheck") {
        ShowAlertMessageIndex("Please add a trade-in vehicle or remove the Trade Allowance and Trade Payoff amounts before contracting the deal.");
    }
    else {
        ShowAlertMessageIndex("Selected Trade-in vehicle is already applied to the following desk: " + result);
    }
}

function CustomerValidations(result) {
    var financeType = $("#HiddenFinanceID").val();
    if (result == "MandatoryFields") {
        ShowAlertMessageIndex("Mandatory fields for Customer section failed validation. Please update the section.");
    }
    else if (result == "EmpPlan") {
        ShowAlertMessageIndex("PIN for Customer section failed validation. Please update the section.");
    }
    else if (result == "CustCobuyerSame") {
        ShowAlertMessageIndex("Buyer and co-buyer cannot be with same customer. Please change either the buyer or co-buyer to proceed.");
    }
    else if (result == "Cobuyer") {
        ShowAlertMessageIndex("Conjunction for Customer section failed validation. Please update the section.");
    }
    else if (result == "Pdi") {
        ShowAlertMessageIndex("PDI for Customer section failed validation. Please update the section.");
    }
    else if (result == "SSN") {
        if (financeType == 2) {
            $('#HiddenSSNflag').val('1');
            var msg = "The Customer's SSN has not been entered.  Would you like to continue without the SSN?</br>"
            LoadSSNConfirm(msg);
            return;
        }
        else {
            ShowAlertMessageIndex("SSN for Customer section failed validation. Please update the section.");
        }
    }
    else if (result == "SSN_Co_buyer") {
        if (financeType == 2) {
            $('#HiddenSSNflag1').val('1');
            var msg = "The Co-Buyer's SSN has not been entered.  Would you like to continue without the SSN?"
            LoadSSNConfirm(msg);
            return;
        }
        else {
            ShowAlertMessageIndex("SSN for Customer section failed validation. Please update the section.");
        }
    }
    else if (result == "DL") {
        ShowAlertMessageIndex("Driver’s License for Customer section failed validation. Please update the section.");
    }
    else if (result == "DLState") {
        ShowAlertMessageIndex("Driver’s License state for Customer section failed validation. Please update the section.");
    }
    else if (result == "DLExpiratinDate") {
        ShowAlertMessageIndex("Driver's License Expiration Date for Customer section failed validation. Please update the section.");
    }
    else if (result == "DOB") {
        ShowAlertMessageIndex("DOB for Customer section failed validation. Please update the section.");
    }
}

function ShowConfirmationPopupForFisrtPayDate(message) {
    $("#FirstPaymentConfirmation p").html(message);
    centrpop('#FirstPaymentConfirmation');
    popupload('#FirstPaymentConfirmationBackGround', '#FirstPaymentConfirmation');
}

function LoadROConfirm(message) {
    $("#DivRoCinfirmMessage p").html(message);
    centrpop('#DivRoCinfirmMessage');
    popupload('#ROConfirmationBackGround', '#DivRoCinfirmMessage');
}

function LoadSSNConfirm(message) {
    $("#divConfirmSSn p").html(message);
    centrpop('#divConfirmSSn');
    popupload('#bg_SSN', '#divConfirmSSn');
}

function ConfirmationROYes() {
    CallEContract("Yes");
    ClosePopUP('#ROConfirmationBackGround', '#DivRoCinfirmMessage');
}

function closeSSn() {
    ClosePopUP('#bg_SSN', '#divConfirmSSn');
    $('#HiddenSSNflag').val('');
    $('#HiddenSSNflag1').val('');
}

function ConfirmationSSN() {
    CallEContract('', $('#HiddenSSNflag').val(), $('#HiddenSSNflag1').val());
    ClosePopUP('#bg_SSN', '#divConfirmSSn');
}

//Added by Shalu David on 7.01.14 for UserStory 18473
function CalculateRebateAsCash() {
    $("#CalculationInProgress").show();
    var ScenarioID = $('#ActiveScenarioID').val();
    $.ajax({
        url: "./../TradeIn/CalculateRebateAsCash",
        type: 'Post',
        cache: false,
        data: { ScenarioID: ScenarioID },
        success: function (result) {
            $("#CalculationInProgress").hide();
        }
    });

}

function CalculateTradeAsCash() {
    $("#CalculationInProgress").show();
    var ScenarioID = $('#ActiveScenarioID').val();
    $.ajax({
        url: "./../TradeIn/CalculateTradeAsCash",
        type: 'Post',
        cache: false,
        data: { ScenarioID: ScenarioID },
        success: function (result) {
            $("#CalculationInProgress").hide();
        }
    });
}

function SaveValueToScenario() {
    var DetailsYesNo = "";
    var ScenarioID = "";
    if ($('#HiddenPopUpName').val() == 'TradeIn') {
        DetailsYesNo = $('#HiddenDetailsYesNo').val();
        $('#hiddenFieldForSelectedRow').val('');
    }
    if ($('#DetailsClicked').val() == 'yes') {
        ScenarioID = $("#HiddenScenarioID").val();
        DetailsYesNo = 'Yes';
    }
    else {

        ScenarioID = $('#ActiveScenarioID').val();
        DetailsYesNo = 'No';
    }
    AjaxCallCalcEngine(ScenarioID);

    if ($('#HiddenPopUpName').val() == 'Rebates') {
        RedirectToScenario(ScenarioID, DetailsYesNo);
        CalculateRebateAsCash();
    }
    else if ($('#HiddenPopUpName').val() == 'TradeIn') {
        popupdisable('#backgroundsearch', '#DivPopUp');
        RedirectToScenario(ScenarioID, DetailsYesNo);
        CalculateTradeAsCash();
    }
    else if ($('#HiddenPopUpName').val() == 'Fee') {
        ClosePopUP('#backgroundsearch', '#DivPopUp');
        RedirectToScenario(ScenarioID, DetailsYesNo);
    }
    else if ($('#HiddenPopUpName').val() == 'ServiceContract') {
        if ($("#HiddenPP").val() != '') {
            ClosePopUP('#backgroundsearch', '#DivPopUp');
        }
        else {
            ClosePopUP('#backgroundsearch', '#DivPopUp');
            RedirectToScenario(ScenarioID, DetailsYesNo);
        }
    }
    else if ($('#HiddenPopUpName').val() == 'Cobuyer') {
        if ($('#hiddenAttachCustID').val() == undefined) {
            RedirectToCustomerSearch($('#HiddenDeskStatus').val(), $('#ViewDataCustomerID').val());
        }
        else {
            RedirectToCustomerSearch($('#HiddenDeskStatus').val(), $('#hiddenAttachCustID').val());
        }
    }
    else if ($('#HiddenPopUpName').val() == 'Customer') {
        ClosePopUP('#backgroundsearch', '#Customerpopop');
        ChangeCustomerNameOnIndex();
        RedirectToScenario(ScenarioID, DetailsYesNo);
    }
    else if ($('#HiddenPopUpName').val() == 'Insurance') {
        if ($("#HiddenPP").val() != '') {
            ClosePopUP('#backgroundsearch', '#DivPopUp');
        }
        else {
            ClosePopUP('#backgroundsearch', '#DivPopUp');
            RedirectToScenario(ScenarioID, DetailsYesNo);
        }
    }
    else if ($('#HiddenPopUpName').val() == 'Miscellaneous') {
        RedirectToScenario(ScenarioID, "Yes");
    }
    else {

        SaveAfterMarketToScenario(ScenarioID, DetailsYesNo, $("#HiddenPP").val());
        ClosePopUP('#backgroundsearch', '#DivPopUp');
    }
    RedirectToScenario(ScenarioID, DetailsYesNo);
    $('#HiddenPopUpName').val("");
    ClosePopUP('#backgroundsearch', '#DivPopUp');
    ClosePopUP('#backgroundsearch', '#Customerpopop');
    ClosePopUP('#backgroundsearch', '#vieweditpopup_Deliverycash');
}

function ConfirmationFirstPaymentYes() {
    UpdateFirstPayment();
    CallEContract();
    ClosePopUP('#FirstPaymentConfirmationBackGround', '#FirstPaymentConfirmation');
}

function RedirectToVehicleSearch_ScenarioID(ScenarioID, DetailsYesNo) {
    var URL = './../SearchVehicle/BasicSearch?ScenarioID=' + ScenarioID + '&DetailsYesNo=' + DetailsYesNo;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            $("#DivVehiclePopUp").html(result);
            centerPopupsearch();
            loadPopupsearch();
        },
        error: function (result) {
        }
    });
}

function SaveAfterMarketToScenario(ScenarioID, DetailsYesNo, fromProductPackage) {
    //Updated by siva kumar on 4/01/13 for Task 16879
    $.ajax({
        url: "./../Scenario/UpdateMSRP",
        type: 'Post',
        cache: false,
        data: { Value: $('#text_MSRP').val(), ScenarioID: ScenarioID },
        success: function (result) {

            if (fromProductPackage != '') {
                ClosePopUP('#backgroundsearch', '#DivPopUp');
            }
            else {
                ClosePopUP('#backgroundsearch', '#DivPopUp');
                RedirectToScenario(ScenarioID, DetailsYesNo);
            }
        }
    });
    //16603 
    AjaxCallCalcEngine(ScenarioID);
}

//Added by Shalu David on 9/24/13 for Task 11519
function RedirectToFormsPrinting() {
    $('#CalculationInProgress').show();
    $('body').css('cursor', 'wait');
    $.ajax({
        type: "POST",
        url: "./../Scenario/InvokeFormsPrinting",
        success: function (result) {
            if (result.Msg != '') {
                window.location.href = result.Msg;
            }
        },
        error: function (result) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
    $('#CalculationInProgress').hide();
    $('body').css('cursor', 'auto');
}

function AjaxCallCalcEngine(ScenarioID) {
    $("#CalculationInProgress").show();
    $('body').css('cursor', 'wait');
    var financetype = 0;
    $.ajax({
        type: 'Post',
        url: './../Scenario/GetFinance',
        datatype: "JSON",
        data: { ScenarioID: ScenarioID },
        success: function (result) {
            financetype = result.result;
            switch (financetype) {
                case 1: AjaxCalcCallForFinance(ScenarioID);
                    break;
                case 2: AjaxCalcCallForCash(ScenarioID);
                    break;
                case 3: AjaxCalcCallForLease(ScenarioID);
                    break;
                case 4: AjaxCalcCallForBalloon(ScenarioID);
                    break;
            }
        },
        error: function () {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
}

function RedirectBasicSearch(Scenario) {
    var URL = './../HomeBasicSearch/Index';
    window.location.href = URL;
}

function ChangeCustomerNameOnIndex() {
    var URL = "./../CobuyerSearch/_CustomerName";
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (Result) {
            $('#CustomerNameOnIndex').html(Result);
            if ($('#Label_RefreshCustomer').val() != '') {
                $('#IndexrefreshCustomer_message').show();
            }
            else {
                $('#IndexrefreshCustomer_message').hide();
            }
            var URL = "./../CobuyerSearch/GetPartyName";
            $.ajax({
                type: 'Post',
                url: URL,
                success: function (Result) {
                    if (Result.Party == "Person") {
                        var msg = 'Retail';
                        $("#DDLCustomerType option:contains(" + msg + ")").attr('selected', 'selected');
                        $("#DDLCustomerType").attr("disabled", "disabled");
                    }
                    else {
                        $("#DDLCustomerType").removeAttr("disabled", "disabled");
                    }
                },
                error: function (result) {
                }
            });

        },
        error: function (result) {
        }
    });
}

function RedirectToBasePage() {
    if ($("#HiddenPageID").val() == 'EC')
        $(".RightDropdown").val("EmployeeCommissionLink");
    else if ($("#HiddenPageID").val() == 'BD')
        $(".RightDropdown").val("BookOutDealLink");
    else if ($("#HiddenPageID").val() == 'DR')
        $(".RightDropdown").val("listDealRecap");
    else if ($("#HiddenPageID").val() == 'SD')
        $(".RightDropdown").val("SceDetails");
}

function DealTypeChange(control, ScenarioId) {
    var Value = $('#' + control.id).val();
    $('#HiddenControlvalue').val(Value);
    var fin_type = $('#HiddenFinanceID').val();
    if ($('#DealtypeName').val() == "Retail") {
        var URL = './../Scenario/CheckCobuyerExistsornotforcurrentScenario';
        $.ajax({
            type: 'Post',
            url: URL,
            success: function (result) {
                if (result.status == "Exists") {
                    $('#HiddenCobuyerId').val(result.CobuyerIds);
                    $('#HiddenScenarioIdfordealtypechange').val(ScenarioId);
                    centrpop('#DealTypeChangeDiv');
                    popupload('#backgroundDealTypeChangeDiv', '#DealTypeChangeDiv');
                    return false;
                }
                else {
                    if ($("#DDLCustomerType option:selected").text() != "Retail") {
                        EnableDisableCobuyer('');
                    }
                    if (fin_type == 2 && ($("option:selected", $('#DDLCustomerType')).text() == 'Dealer Trade' || $("option:selected", $('#DDLCustomerType')).text() == 'Wholesale')) {
                        var checkURL = './../Scenario/CheckServicecontractAftermarketOrInsuranceExists';
                        $.ajax({
                            type: 'Post',
                            url: checkURL,
                            success: function (result) {
                                var IsExists1 = result.status.split('/')[0];
                                var IsExists2 = result.status.split('/')[1];
                                var IsExists3 = result.status.split('/')[2];
                                var IsExists = IsExists1;
                                if (IsExists3 != "" && IsExists3 != undefined) {
                                    IsExists = IsExists1 + ", " + IsExists2 + ", " + IsExists3;
                                }
                                else if (IsExists2 != "" && IsExists2 != undefined) {
                                    IsExists = IsExists1 + ", " + IsExists2;
                                }
                                if (IsExists != "") {
                                    $('#linkServicecontracts').removeAttr("disabled", "disabled");
                                    $('#linkAftermarkets').removeAttr("disabled", "disabled");
                                    $('#linkInsurances').removeAttr("disabled", "disabled");
                                    $('#linkServicecontracts').removeClass('disableSearch');
                                    $('#linkAftermarkets').removeClass('disableSearch');
                                    $('#linkInsurances').removeClass('disableSearch');
                                    $('#DDLCustomerType').val(result.PreviousValue);
                                    $('#alertHidden').val("#DDLCustomerType");
                                    ShowAlertMessageIndex("You have some records in " + IsExists + ". So cannot change deal type to Dealer Trade or Wholesale. Delete the records to do so.");
                                }
                                else {
                                    $('#linkServicecontracts').attr("disabled", "disabled");
                                    $('#linkAftermarkets').attr("disabled", "disabled");
                                    $('#linkInsurances').attr("disabled", "disabled");

                                    var URL = './../Scenario/CheckCobuyerExistsornotforcurrentScenario';
                                    $.ajax({
                                        type: 'Post',
                                        url: URL,
                                        success: function (result) {
                                            if (result.status != "Exists") {
                                                UpdateScenarioDetails($('#HiddenControlvalue').val(), ScenarioId, "CustType");
                                            }
                                        },
                                        error: function (error) {

                                        }
                                    });
                                    if ($("#DDLCustomerType option:selected").text() == "Retail") {
                                        EnableDisableCobuyer('Yes');
                                    }
                                }
                            },
                            error: function (error) {

                            }
                        });
                    } else {
                        if ($("#DDLCustomerType option:selected").text() != "Retail") {
                            EnableDisableCobuyer('');
                        }
                        UpdateScenarioDetails($('#HiddenControlvalue').val(), ScenarioId, "CustType");
                        if ($("#DDLCustomerType option:selected").text() == "Retail") {
                            EnableDisableCobuyer('Yes');
                        }
                    }
                }
            },
            error: function (error) {

            }
        });
    }
    else if (fin_type == 2 && ($("option:selected", $('#DDLCustomerType')).text() == 'Dealer Trade' || $("option:selected", $('#DDLCustomerType')).text() == 'Wholesale')) {
        var checkURL = './../Scenario/CheckServicecontractAftermarketOrInsuranceExists';
        $.ajax({
            type: 'Post',
            url: checkURL,
            success: function (result) {
                var IsExists1 = result.status.split('/')[0];
                var IsExists2 = result.status.split('/')[1];
                var IsExists3 = result.status.split('/')[2];
                var IsExists = IsExists1;
                if (IsExists3 != "" && IsExists3 != undefined) {
                    IsExists = IsExists1 + ", " + IsExists2 + ", " + IsExists3;
                }
                else if (IsExists2 != "" && IsExists2 != undefined) {
                    IsExists = IsExists1 + ", " + IsExists2;
                }
                if (IsExists != "") {
                    $('#linkServicecontracts').removeAttr("disabled", "disabled");
                    $('#linkAftermarkets').removeAttr("disabled", "disabled");
                    $('#linkInsurances').removeAttr("disabled", "disabled");
                    $('#linkServicecontracts').removeClass('disableSearch');
                    $('#linkAftermarkets').removeClass('disableSearch');
                    $('#linkInsurances').removeClass('disableSearch');
                    $('#DDLCustomerType').val(result.PreviousValue);
                    $('#alertHidden').val("#DDLCustomerType");
                    ShowAlertMessageIndex("You have some records in " + IsExists + ". So cannot change deal type to Dealer Trade or Wholesale. Delete the records to do so.");
                }
                else {
                    $('#linkServicecontracts').attr("disabled", "disabled");
                    $('#linkAftermarkets').attr("disabled", "disabled");
                    $('#linkInsurances').attr("disabled", "disabled");

                    UpdateScenarioDetails($('#HiddenControlvalue').val(), ScenarioId, "CustType");

                    if ($("#DDLCustomerType option:selected").text() == "Retail") {
                        EnableDisableCobuyer('Yes');
                    }
                }
            },
            error: function (error) {

            }
        });
    }
    else {
        if ($("#DDLCustomerType option:selected").text() == "Retail") {
            $('#DealtypeName').val('Retail');
        }
        UpdateScenarioDetails($('#HiddenControlvalue').val(), ScenarioId, "CustType");
        if ($("#DDLCustomerType option:selected").text() == "Retail") {
            EnableDisableCobuyer('Yes');
        }
    }
}

function okclicked() {
    popupdisable('#backgroundPopupDelete', '#popupContactDelete');
    $("#" + $("#hiddenpercentinvalid").val()).focus();
}

function ChangeScenFinType(FinanceType, IsCancel) {
    $('#btnFinance').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    $('#btnCash').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    $('#btnLease').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    $('#btnBalloon').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    switch (FinanceType) {
        case '1': $('#btnFinance').attr("disabled", "disabled"); break;
        case '2': $('#btnCash').attr("disabled", "disabled"); break;
        case '3': $('#btnLease').attr("disabled", "disabled"); break;
        case '4': $('#btnBalloon').attr("disabled", "disabled"); break;
    }
    $.ajax({
        type: "POST",
        url: "./../Scenario/GetDeskStatus",
        success: function (result) {

            if (result.Msg == "Open Deal") {
                $("input:button[name=EditFinance]").attr("disabled", "disabled");
                $("input:button[name=EditFinance]").addClass("disabledbtn");

            }
            if (result.Msg == "Scenario") {
                $("input:button[name=EditFinance]").removeAttr("disabled", "disabled");
                $("input:button[name=EditFinance]").removeClass("disabledbtn");

            }
        }
    });
    if (IsCancel != 1) {
        centrpop('#propmtchangefina');
        popupload('#backgroundPopupChangeFinance', '#propmtchangefina');
        $('#HiddenFinanceID').val(this.id);
        $('#contactAreaChangeFinance').hide();
        $("#HiddenFinanceID").val(FinanceType);
    }
}

function buttonFinanceAdd() {
    document.getElementById('radFinanceType').value = "1";
    document.getElementById('Redirect').value = "Redirect";
    document.getElementById('myform').submit();
}

function buttonCashAdd() {
    document.getElementById('radFinanceType').value = "2";
    document.getElementById('Redirect').value = "Redirect";
    document.getElementById('myform').submit();
}

function buttonLeaseAdd() {
    document.getElementById('radFinanceType').value = "3";
    document.getElementById('Redirect').value = "Redirect";
    document.getElementById('myform').submit();
}

function buttonBalloonAdd() {
    document.getElementById('radFinanceType').value = "4";
    document.getElementById('Redirect').value = "Redirect";
    document.getElementById('myform').submit();
}

function LoadChangeFinancePopUp(CurrentFinanceType) {
    $("#HiddenFinanceTypeId").val(CurrentFinanceType);
    $("#DivFinanceTypes").show();
    popupload('#bgPopupfinace', '#popupfinance');
    centrpop('#popupfinance');
    $('#btnFinance').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    $('#btnCash').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    $('#btnLease').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    $('#btnBalloon').removeAttr("disabled", "disabled").removeClass("disabledbtn").addClass('login_bottm_rigt');
    switch (CurrentFinanceType) {
        case '1': $('#btnFinance').attr("disabled", "disabled"); $('#btnFinance').addClass("disabledbtn").removeClass('login_bottm_rigt'); break;
        case '2': $('#btnCash').attr("disabled", "disabled"); $('#btnCash').addClass("disabledbtn").removeClass('login_bottm_rigt'); break;
        case '3': $('#btnLease').attr("disabled", "disabled"); $('#btnLease').addClass("disabledbtn").removeClass('login_bottm_rigt'); break;
        case '4': $('#btnBalloon').attr("disabled", "disabled"); $('#btnBalloon').addClass("disabledbtn").removeClass('login_bottm_rigt'); break;
    }
}

function loadPopuplender() {
    if ($("#bgPopup").data("state") == 0) {
        $("#bgPopup").css({
            "opacity": "0.7"
        });
        popupload("#bgPopup", "#Popup");
        $("#bgPopup").data("state", 1);
    }
}

function disablePopuplender() {
    if ($("#bgPopup").data("state") == 1) {
        $("#bgPopup").fadeOut("medium");
        $("#Popup").fadeOut("medium");
        $("#bgPopup").data("state", 0);
    }
}

function centerPopuplender() {
    var winw = $(window).width();
    var winh = $(window).height();
    var popw = $('#Popup').width();
    var poph = $('#Popup').height();
    $("#Popup").css({
        "position": "absolute",
        "top": winh / 2 - poph / 2,
        "left": winw / 2 - popw / 2
    });
    $("#bgPopup").css({
        "height": winh
    });
}

function LenderYes(Type) {
    $('#HiddenDefaultContractID').val('');
    BindContract($("#hidden_lender").val(), Type);
    ClosePopUP('#backgroundsearch', '#ChangeLenderPopUp');
    $("#HiddenYesOrNo").val(Type);
}

function loadPopupLease() {
    //loads popup only if it is disabled
    if ($("#bgPopup").data("state") == 0) {
        $("#bgPopup").css({
            "opacity": "0.7"
        });
        popupload("#bgPopup", "#PopupLease");
        $("#bgPopup").data("state", 1);
    }
}

function disablePopupLease() {
    if ($("#bgPopup").data("state") == 1) {
        $("#bgPopup").fadeOut("medium");
        $("#PopupLease").fadeOut("medium");
        $("#bgPopup").data("state", 0);
    }
}

function centerPopupLease() {
    var winw = $(window).width();
    var winh = $(window).height();
    var popw = $('#PopupLease').width();
    var poph = $('#PopupLease').height();
    $("#PopupLease").css({
        "position": "absolute",
        "top": winh / 2 - poph / 2,
        "left": winw / 2 - popw / 2
    });
    $("#bgPopup").css({
        "height": winh
    });
}

function CheckUserDefaultFinanceType() {
    $.ajax({
        type: "POST",
        url: "./../Scenario/CheckUserDefaultFinanceType",
        success: function (result) {
            if (result.Msg == 'NoDefault') {
                centerPopupcreatefscenario();
                loadPopupcreatefscenario();
            }
            else {
                document.getElementById('radFinanceType').value = result.Msg;
                document.getElementById('Redirect').value = "Redirect";
                document.getElementById('myform').submit();
            }
        },
        error: function (result) {
        }
    });
}

function LoadLender(ContractId, type, flag) {
    $('#DesksInProgress').show();
    var stack_no = $("#tbxStockNum1").val();
    var fin_type = $('#HiddenFinanceID').val();
    var sel_lender = $("#DDLLender").val();
    if (ContractId > 0) {
        var Contract = ContractId;
    }
    else {
        var Contract = $("#DDLLenderContract").val();
    }
    var URL = './../Scenario/LoadLenderSetupDetails';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            FinanceType: fin_type,
            LenderTypeId: sel_lender,
            ContractId: Contract,
            Type: type,
            Flag: flag
        },
        success: function (lenderDet) {
            ClosePopUP('#backgroundsearch', '#ChangeLenderPopUp');
            ClosePopUP('#backgroundsearch', '#DivChangeLenderPopUp');
            if (Contract == '') {
                $("#tbxMoneyRate").val("0.0");
                $("#tbxAPR").val("0.0%");
                $("#tbxRates").val("0.0%");
                $("#tbxResidualPercentage").val("0.0%");
                $("#tbxResidualAmount").val("0.00");
                var URL = './../Scenario/UpdateRatesOnSelect';
                var LenderType = $("#DDLLender").val();
                $.ajax({
                    type: 'Post',
                    url: URL,
                    data: {
                        Lender: LenderType
                    },
                    success: function (result) {
                    },
                    error: function (error) {
                    }
                });
            }
            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
            if ($('#IsDealRecap').val() == 'Yes') {

                $(".DealRecapLink").click();
            }
            else {
                RedirectToScenario(ScenarioID, 'Yes');
            }
            $('#DesksInProgress').hide();
        },
        error: function (error) {
        }
    });
}

function LoadLenderwhenLenderisZero() {
    var fin_type = $('#HiddenFinanceID').val();
    var URL = './../Scenario/LoadLenderSetupDetails';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            FinanceType: fin_type,
            LenderTypeId: 0,
            ContractId: 0,
        },
        success: function (lenderDet) {
            ClosePopUP('#backgroundsearch', '#ChangeLenderPopUp');
            ClosePopUP('#backgroundsearch', '#DivChangeLenderPopUp');

            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
            RedirectToScenario(ScenarioID, 'Yes');
        },
        error: function (error) {
        }
    });
}

function CancelLender() {
    ClosePopUP('#backgroundsearch', '#ChangeLenderPopUp');
    ClosePopUP('#backgroundsearch', '#DivChangeLenderPopUp');
    var ScenarioID = $('#HiddenScenarioID').val();
    if ($("#hiddenpercentinvalid").val() == 'tbxRates' || $("#hiddenpercentinvalid").val() == 'tbxMoneyRate') {
    }
    else {
        RedirectToScenario(ScenarioID, 'Yes');
    }
}

function CheckContractCodeExistence(control) {
    var controlId = '#' + control.id;
    var LenderType = $("#DDLLender").val();
    var LenderContract = $("#DDLLenderContract").val();
    FinanceType = $('#FinIDForLender').val();
    var URL = './../Scenario/CheckContractCodeExistence';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            FinanceType: FinanceType,
            LenderTypeId: LenderType,
            ContractId: LenderContract
        },
        success: function (result) {
            AlertLenderContractCode("Do you want to replace rates with the new lender’s defaults?");
        },
        error: function (error) {
        }
    });
}

function CancelPopup() {
    var lenderContract = $("#LenderContractValue").val();
    $("#DDLLenderContract").val(lenderContract);
    ClosePopUP('#backgroundsearch', '#DivChangeLenderPopUp');
}

function SetValueChangedStatus() {
    $('#hiddenPopUpValChangedYesNo').val('Yes');
}

function RedirectToDisplayCustomerData(ID) {
    var CustIDForCoBuyer = $('#HiddenCustIDForCoBuyer').val();
    var URL = './../CoBuyerSearch/DisplayCustomerData?id=' + ID + "&CustIDForCoBuyer=" + CustIDForCoBuyer;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            $("#BuyerData").hide();
            $("#Results").html(result);
        },
        error: function (error) {
        }
    });
}

function GetAutoCompleteList(control, DBTablename, DBColumnname) {
    var deskstatus = $("#HiddenDeskStatus").val();
    var controlid = '#' + control.id;
    var RedirectToDisplayData = 'No';
    if (DBColumnname == 'CustomerNumber_Display') {
        DBColumnname = 'CustomerNumber';
        RedirectToDisplayData = 'Yes';
    }
    $(controlid).autocomplete({
        source: function (request, response) {
            $.ajax({
                url: "./../CobuyerSearch/AutoComplete",
                type: "POST",
                dataType: "json",
                data: { searchText: request.term, maxResults: 10, DBTablename: DBTablename, DBColumnname: DBColumnname },
                success: function (data) {
                    if (data.msg == 'error') {
                        ShowAlertMessageIndex('No ' + DBColumnname + 's found.');
                        return false;
                    }
                    response($.map(data, function (StringList) {
                        if (DBColumnname == 'CustomerNumber') {
                            var StrLst = StringList.split('_');
                            return { label: StrLst[0], value: StrLst[0], id: StrLst[1] }
                        }
                        return { label: StringList, value: StringList, id: StringList }
                    }))
                }
            });
        },
        select: function (event, ui) {
            var SelectedLabel = ui.item.id;
            if (DBColumnname == 'CustomerNumber') {
                if (RedirectToDisplayData == 'Yes')
                    RedirectToDisplayCustomerData(SelectedLabel);
                else {
                    RedirectToCustomerSearch(deskstatus, SelectedLabel);
                }
            }
        }
    });
}

function ShowQuotes() {
    $.ajax({
        type: "POST",
        url: "./../CobuyerSearch/ViewCustomerQuotes",
        success: function (result) {
            $("#ViewCustomerQuotes").html(result);
            centrpop('#PopUpViewCustomerQuotes');
            popupload('#backgroundsearch', '#PopUpViewCustomerQuotes');
        },
        error: function (errorr) {
            ShowAlertMessageIndex('Error occurred while creating Quote.');
        }
    });
}

function ShowCreateQuotePopUp() {
    $.ajax({
        type: "POST",
        url: "./../CobuyerSearch/CustomerQuotes",
        success: function (result) {
            $("#CreateCustomerQuotes").html(result);
            centrpop('#PopUpCreateQuote');
            popupload('#backgroundsearch', '#PopUpCreateQuote');
        },
        error: function (errorr) {
            ShowAlertMessageIndex('Error occurred while creating Quote.');
        }
    });
}

function SaveDownloadQuote() {
    $.ajax({
        type: "POST",
        url: "./../CobuyerSearch/DeleteCustomerQuote",
        success: function (result) {
            ClosePopUP('#backgroundDownloadQuote', '#PopUpDownloadQuote');
        },
        error: function (errorr) {
            ShowAlertMessageIndex('Error while creating quote.');
        }
    });
}

function CreateQuote() {
    if (!($('input:checkbox[name=CreateQuote]').is(':checked'))) {
        $('.quoteError').html('');
        $('#CreateQuoteMsg').after("<div class='quoteError' style='color:red; position: absolute;'>Please select at least one option.</div>");
        return false;
    }
    if ($('#tbxValidUpto').val() == '') {
        $('.quoteError').html('');
        $('#tbxValidUpto').after("<div class='quoteError' style='color:red; position: absolute; left:40%'>'Days quote is valid' cannot be empty.</div>");
        $('#tbxValidUpto').addClass('error');
        return false;
    }
    var DealerExpiryDays = $('#DealerExpiryDays').val();
    var ExpiryDays = $('#tbxValidUpto').val();
    if (parseInt(ExpiryDays) > parseInt(DealerExpiryDays)) {
        $('.quoteError').html('');
        $('#tbxValidUpto').after("<div class='quoteError' style='color:red; position: absolute; left:40%'>Days can't be more than dealer expiry days.</div>");
        $('#tbxValidUpto').addClass('error');
        return false;
    }
    else {
        $('.quoteError').html('');
        $('#tbxValidUpto').removeClass('error');
    }
    var ScenarioIDS = "";
    $('input[name=Quote]').click(function () {
        var inactive = $(this).is(':checked');
        if (inactive) {
            $('.quoteError').html('');
        }
    });
    $('input[name=Quote]:checked').each(function () {
        $('.quoteError').html('');
        var values = $(this).val();
        ScenarioIDS += values + ",";
    });
    if (ScenarioIDS == "") {
        $('.quoteError').html('');
        $('#quoteTable').after("<div class='quoteError' style='color:red; position: absolute;'>Please select at least one Scenario for creating quote.</div>");
        return false;
    }
    var quoteVal;
    $('input[name=CreateQuote]:checked').each(function () {
        quoteVal = $(this).val();
    });
    if (quoteVal == 'B') {
        var msg = "Create Buyer's Order in progress... Please wait...";
        document.getElementById("lblQuote").innerHTML = msg;
    }
    if (quoteVal == 'Q') {
        var msg = "Create Quote in progress... Please wait...";
        document.getElementById("lblQuote").innerHTML = msg;
    }
    centrpop('#CreateQuoteInProgress');
    popupload('#alertPOp_index', '#CreateQuoteInProgress');
    $('#alertPOp_index').css("z-index", "20005");
    $('#CreateQuoteInProgress').css("z-index", "20010");
    $('body').css('cursor', 'wait');
    $.ajax({
        type: "POST",
        url: "./../CobuyerSearch/CreateCustomerQuotes?ScenarioIDS=" + ScenarioIDS + "&ExpiryDays=" + $('#tbxValidUpto').val() + "&Quote=" + quoteVal,
        success: function (result) {
            ClosePopUP('#alertPOp_index', '#CreateQuoteInProgress');
            $('body').css('cursor', 'auto');
            setTimeout(function () {
                //Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
                //if (result.Message == 'NoCustomer') {
                //    $('.quoteError').html('');
                //    $('#quoteTable').after("<div class='quoteError' style='color:red; position: absolute;'>Please attach Customer before creating quote.</div>");
                //    $('.quoteError').animate({
                //        opacity: 1
                //    }, 4000, function () {
                //        $('.quoteError').fadeOut(1000);
                //    });
                //}
                //else
                if (result.Message == 'NoVehicle') {
                    $('.quoteError').html('');
                    $('#quoteTable').after("<div class='quoteError' style='color:red; position: absolute;'>Please attach Vehicle before creating quote.</div>");
                    $('.quoteError').animate({
                        opacity: 1
                    }, 4000, function () {
                        $('.quoteError').fadeOut(1000);
                    });
                }
                    //Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
                    //else if (result.Message == 'Customer-InComplete') {
                    //    $('.quoteError').html('');
                    //    $('#quoteTable').after("<div class='quoteError' style='color:red; position: absolute;'>Customer data is incomplete. Complete it and try again.</div>");
                    //    $('.quoteError').animate({
                    //        opacity: 1
                    //    }, 4000, function () {
                    //        $('.quoteError').fadeOut(1000);
                    //    });
                    //}
                    //else if (result.Message == 'Customer-InComplete-Fields') {
                    //    $('.quoteError').html('');
                    //    $('#quoteTable').after("<div class='quoteError' style='color:red; position: absolute;'>All required Customer information must be included before a quote can be generated.  Please add the following information to the Customer and try again: <br/>" + result.Fields + "</div>");
                    //    $('.quoteError').animate({
                    //        opacity: 1
                    //    }, 6000, function () {
                    //        $('.quoteError').fadeOut(2000);
                    //    });
                    //}
                else if (result.Message == 'Limit') {
                    $('.quoteError').html('');
                    $('#quoteTable').after("<div class='quoteError' style='color:red; position: absolute;'>Please select a maximum of 5 Scenarios to create a quote.</div>");
                    $('.quoteError').animate({
                        opacity: 1
                    }, 4000, function () {
                        $('.quoteError').fadeOut(1000);
                    });
                }
                else if (result.Message == 'LimitBuyersOrder') {
                    $('.quoteError').html('');
                    $('#quoteTable').after("<div class='quoteError' style='color:red; position: absolute;'>Please select only one Scenario to create a Buyers Order.</div>");
                    $('.quoteError').animate({
                        opacity: 1
                    }, 4000, function () {
                        $('.quoteError').fadeOut(1000);
                    });
                }
                else if (result.Message == 'Success') {
                    $.ajax({
                        type: "POST",
                        url: "./../CobuyerSearch/CustomerQuoteDownload",
                        success: function (result) {
                            if (quoteVal == 'B') {
                                var msg1 = "Buyer's Order Created";
                                document.getElementById("lblDownloadQuote").innerHTML = msg1;
                            }
                            if (quoteVal == 'Q') {
                                var msg1 = "Quote Created";
                                document.getElementById("lblDownloadQuote").innerHTML = msg1;
                            }
                            $("#DownloadCustQuotes").html(result);
                            centrpop('#PopUpDownloadQuote');
                            popupload('#backgroundDownloadQuote', '#PopUpDownloadQuote');
                            $('#backgroundDownloadQuote').css('z-index', '20000');
                            $('#PopUpDownloadQuote').css('z-index', '20001');
                        },
                        error: function (errorr) {
                            ShowAlertMessageIndex('Error while creating quote.');
                        }
                    });
                }
                else
                    ShowAlertMessageIndex('Error while creating quote.');
            }, 500);
        },
        error: function (errorr) {
            ClosePopUP('#alertPOp_index', '#CreateQuoteInProgress');
            $('body').css('cursor', 'auto');
            ShowAlertMessageIndex('Error while creating quote.');
        }
    });
}

function ShowMSRP(ScenarioID, DetailsYesNo) {
    $.ajax({
        type: "POST",
        url: "./../MSRPViewEdit/CheckFinanceType",
        beforeSend: function () {
            $('#DesksInProgress').show();
        },
        dataType: 'json',
        success: function (result) {
            $('#DesksInProgress').hide();
            if (result.Msg == 'fail') {
            }
            else if (result.Msg == 'success') {
                $.ajax({
                    type: "POST",
                    url: "./../MSRPViewEdit/MSRP?ScenarioID=" + ScenarioID + "&DetailsYesNo=" + DetailsYesNo,
                    beforeSend: function () {
                        $('#DesksInProgress').show();
                    },
                    success: function (ViewModel) {
                        $('#DesksInProgress').hide();
                        $("#contactArea1").html(ViewModel);
                        centrpop('#popmsrp');
                        popupload('#backgroundsearch', '#popmsrp');
                        if (result.FinanceType == 4) {
                            $('#popmsrp').css("width", "41%");
                        }
                    }
                });
            }
        }
    });
}

function EnableDisableCobuyer(isdisabledval) {
    var URL = './../Scenario/RemoveCoBuyerfromdesk';
    $.ajax({
        type: 'Post',
        url: URL,
        data: { CobuyerId: $('#HiddenCobuyerId').val(), Isdisabled: isdisabledval },
        success: function (result) {
        },
        error: function (error) {
        }
    });
}

function ShowAlertVehicle(message, stocknum, VehID, ScenarioID, DetailsYesNo, control) {
    $("#stocknumlabel").val(stocknum);
    $("#vehicleid").val(VehID);
    $("#scenarioid").val(ScenarioID);
    $("#details").val(DetailsYesNo);
    var IsSelected = $("#HiddenIsSelected").val();
    if (IsSelected == "") {
        $("#ctrl").val(control);
    }
    else {
        $("#ctrl").val("#" + control.id);
    }
    $('#HiddenShowVehStockNum').val(stocknum);
    $("#alertvehiclechange p").html(message);
    centrpop('#alertvehiclechange');
    popupload('#bgpopup', '#alertvehiclechange');
}

function btnOKVehicleChange() {
    if ($("#stocknumlabel").val() == "") {
        ShowAlertMessageIndex("Stock number cannot be empty.");
        return false;
    }
    $('#HiddenStockNum').val($('#HiddenShowVehStockNum').val());
    var DetailsYesNo = $("#details").val();
    var ScenarioID = $("#scenarioid").val();
    var VehID = $("#vehicleid").val();
    var URL = './../VehicleHistory/GetVehicleFromStockNum?VehicleID=' + VehID + '&ScenarioID=' + ScenarioID;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            if (result.Msg == "success") {
                popupdisable('#alertvehiclechange', '#bgpopup');
                AjaxCallCalcEngine(ScenarioID);
                RedirectToScenario(ScenarioID, DetailsYesNo);

            }
        },
        error: function (error) {
            popupdisable('#alertvehiclechange', '#bgpopup');
            ShowAlertMessageIndex('No vehicle found matching this stock number. Please try again.');
            $('input').removeClass('ui-autocomplete-loading');
            RedirectToScenario(ScenarioID, DetailsYesNo, 'alert');
        }
    });
}

function btnCancelVehicleChange() {
    $('body').css('cursor', 'wait');
    var DetailsYesNo = $("#details").val();
    var ScenarioID = $("#scenarioid").val();
    RedirectToScenario(ScenarioID, DetailsYesNo);
    var activestknum = $("#ctrl").val();
    $(activestknum).val($("#prevvalstck").val());
    popupdisable('#alertvehiclechange', '#bgpopup');
    $('body').css('cursor', 'auto');
}

function AddVehilceToScenario(ScenarioID, VehID, DetailsYesNo, StockNum, texboxid) {
    var prevStockNUm = $('#HiddenStockNum').val();
    var ConfirmMsg = "";
    $("#prevvalstck").val(prevStockNUm);
    if (prevStockNUm == "")
        ShowAlertVehicle('Are you sure you want to add vehicle to this scenario?', StockNum, VehID, ScenarioID, DetailsYesNo, texboxid);
    else
        ShowAlertVehicle('Would you like to replace the existing vehicle for this scenario?', StockNum, VehID, ScenarioID, DetailsYesNo, texboxid);
}

function ShowAlertForRebate(message) {
    $("#alertRebate p").html(message);
    centrpop('#alertRebate');
    popupload('#bgpopup', '#alertRebate');
}

function IndexShowAlertForRefreshLein(message) {
    $("#IndexalertRefreshLein #msg").html(message);
    centrpop('#IndexalertRefreshLein');
    var popuppos = parseInt($('#IndexalertRefreshLein').css('top')) - 50;
    $('#IndexalertRefreshLein').css('margin-top', '-' + popuppos + 'px');
    popupload('#IndexbgalertRefreshLein', '#IndexalertRefreshLein');
}

function IndexShowAlertForRefreshCustomer(message) {
    $("#IndexalertRefreshCustomer #msg").html(message);
    centrpop('#IndexalertRefreshCustomer');
    var popuppos = parseInt($('#IndexalertRefreshCustomer').css('top')) - 50;
    $('#IndexalertRefreshCustomer').css('margin-top', '-' + popuppos + 'px');
    popupload('#IndexbgalertRefreshCustomer', '#IndexalertRefreshCustomer');
}

function RedirectToVehiclePopUpSearch(id, DetailsYesNo) {
    var URL = './../SearchVehicle/BasicSearch?ScenarioID=' + id + '&DetailsYesNo=' + DetailsYesNo;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            $("#DivVehiclePopUp").html(result);
            centerPopupsearch();
            loadPopupsearch();
        },
        error: function (result) {

        }
    });
}

function ShowTradeIn(ScenarioID, DetailsYesNo) {
    $('#HiddenDetailsYesNo').val(DetailsYesNo);
    $('#HiddenScenID').val(ScenarioID);
    var res = "";
    //Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
    if ($('#item_TradeAllowance').val() != 0 || $('#item_TradePayoff').val() != 0) {
        $.ajax({
            type: "POST",
            url: "./../TradeIn/CheckAppraisal",
            beforeSend: function () {
                $('#DesksInProgress').show();
            },
            success: function (result) {
                $('#DesksInProgress').hide();
                res = result.result;
            }
        });
    }
    if (res == "fail") {
        return false;
    }
    $('#HiddenPopUpName').val('TradeIn');
    $.ajax({
        type: "POST",
        url: "./../TradeIn/Display?ScenarioID=" + ScenarioID + "&DetailsYesNo=" + DetailsYesNo,
        beforeSend: function () {
            $('#DesksInProgress').show();
        },
        success: function (ViewModel) {
            $('#DesksInProgress').hide();
            $("#viewEditContactArea").html(ViewModel);
            var tradinVal = $('#tradeAllowance').val();
            $("#HiddenTradeInValue").val(tradinVal);
            $("input[readonly = 'readonly']").each(function () { $(this).attr('tabindex', '-1'); });
            centrpop('#DivPopUp');
            popupload('#backgroundsearch', '#DivPopUp');
        }
    });
}

function ShowFeesAndTaxes(ScenarioID, DetailsYesNo) {
    $('#HiddenPopUpName').val('Fee');
    $('#HiddenDetailsYesNo').val(DetailsYesNo);
    $('#HiddenScenID').val(ScenarioID);
    var deskstatus = $("#HiddenDeskStatus").val();
    $.ajax({
        type: "POST",
        url: "./../FeesAndTax/FeeAndTax?ScenarioID=" + ScenarioID + "&DetailsYesNo=" + DetailsYesNo,
        beforeSend: function () {
            $('#DesksInProgress').show();
        },
        success: function (viewModel) {
            $('#DesksInProgress').hide();
            $("#DivPopUp").removeClass("popTradeIn");
            $("#DivPopUp").removeClass("DivPopUp");
            $("#DivPopUp").addClass("DivPopUpFeesAndTaxes");
            $("#viewEditContactArea").html(viewModel);
            centrpop('#DivPopUp');
            popupload('#backgroundsearch', '#DivPopUp');
            $("#DivPopUp").removeClass("popTradeIn");
            $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
            $("#DivPopUp").css("left", "5px");
        }
    });
}

function ShowInsurance(ScenarioID, DetailsYesNo) {
    if (DetailsYesNo == 'Yes') {
        if (!($('#linkInsurances').attr('disabled') == 'disabled' || $('#linkInsurances').attr('disabled') == true)) {
            $('#HiddenPopUpName').val('Insurance');
            $('#HiddenScenID').val(ScenarioID);
            $('#HiddenDetailsYesNo').val(DetailsYesNo);
            $.ajax({
                type: "POST",
                url: "./../ViewEditInsurance/ViewEditInsurance?ScenarioID=" + ScenarioID + "&DetailsYesNo=" + DetailsYesNo,
                beforeSend: function () {
                    $('#DesksInProgress').show();
                },
                success: function (model) {
                    $('#DesksInProgress').hide();
                    $("#DivPopUp").removeClass("popTradeIn");
                    $("#DivPopUp").removeClass("DivPopUp");
                    $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
                    $("#viewEditContactArea").html(model);
                    centrpop('#DivPopUp');
                    popupload('#backgroundsearch', '#DivPopUp');
                }
            });
        }
    }
    else {
        if (!($('#linkindexInsurance').attr('disabled') == 'disabled' || $('#linkindexInsurance').attr('disabled') == true)) {
            if (!($('#linkactiveindexInsurance').attr('disabled') == 'disabled' || $('#linkactiveindexInsurance').attr('disabled') == true)) {
                $('#HiddenPopUpName').val('Insurance');
                $('#HiddenScenID').val(ScenarioID);
                $('#HiddenDetailsYesNo').val(DetailsYesNo);
                $.ajax({
                    type: "POST",
                    url: "./../ViewEditInsurance/ViewEditInsurance?ScenarioID=" + ScenarioID + "&DetailsYesNo=" + DetailsYesNo,
                    beforeSend: function () {
                        $('#DesksInProgress').show();
                    },
                    success: function (model) {
                        $('#DesksInProgress').hide();
                        $("#DivPopUp").removeClass("popTradeIn");
                        $("#DivPopUp").removeClass("DivPopUp");
                        $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
                        $("#viewEditContactArea").html(model);
                        centrpop('#DivPopUp');
                        popupload('#backgroundsearch', '#DivPopUp');
                    }
                });
            }
        }
    }
}

function ShowAfterMarket(scenarioID, DetailsYesNo) {
    if (DetailsYesNo == 'Yes') {
        if (!($('#linkAftermarkets').attr('disabled') == 'disabled' || $('#linkAftermarkets').attr('disabled') == true)) {
            $('#HiddenPopUpName').val('AfterMarket');
            $.ajax({
                type: "POST",
                url: "./../AfterMarket/Display?scenarioID=" + scenarioID + "&DetailsYesNo=" + DetailsYesNo,
                beforeSend: function () {
                    $('#DesksInProgress').show();
                },
                success: function (aftermarketviewedit) {
                    $('#DesksInProgress').hide();
                    $("#viewEditContactArea").html(aftermarketviewedit);
                    centrpop('#DivPopUp');
                    popupload('#backgroundsearch', '#DivPopUp');
                    $("#DivPopUp").removeClass("popTradeIn");
                    $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
                    $("#DivPopUp").css("left", "1%");
                }
            });
        }
    }
    else {
        if (!($('#linkindexAftermarket').attr('disabled') == 'disabled' || $('#linkindexAftermarket').attr('disabled') == true)) {
            if (!($('#linkactiveindexAftermarket').attr('disabled') == 'disabled' || $('#linkactiveindexAftermarket').attr('disabled') == true)) {
                $('#HiddenPopUpName').val('AfterMarket');
                $.ajax({
                    type: "POST",
                    url: "./../AfterMarket/Display?scenarioID=" + scenarioID + "&DetailsYesNo=" + DetailsYesNo,
                    beforeSend: function () {
                        $('#DesksInProgress').show();
                    },
                    success: function (aftermarketviewedit) {
                        $('#DesksInProgress').hide();
                        $("#viewEditContactArea").html(aftermarketviewedit);
                        centrpop('#DivPopUp');
                        popupload('#backgroundsearch', '#DivPopUp');
                        $("#DivPopUp").removeClass("popTradeIn");
                        $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
                        $("#DivPopUp").css("left", "1%");
                    }
                });
            }
        }
    }
}

function ShowServiceContract(scenarioID, DetailsYesNo) {
    if (DetailsYesNo == 'Yes') {
        if (!($('#linkServicecontracts').attr('disabled') == 'disabled' || $('#linkServicecontracts').attr('disabled') == true)) {
            $('#HiddenPopUpName').val('ServiceContract');
            $.ajax({
                type: "POST",
                url: "./../ServiceContract/ServiceContractdetails?DetailsYesNo=" + DetailsYesNo + "&scenarioID=" + scenarioID,
                beforeSend: function () {
                    $('#DesksInProgress').show();
                },
                success: function (viewcontract) {
                    $('#DesksInProgress').hide();
                    $("#viewEditContactArea").html(viewcontract);
                    $("input[readonly = 'readonly']").each(function () { $(this).attr('tabindex', '-1'); });
                    centrpop('#DivPopUp');
                    popupload('#backgroundsearch', '#DivPopUp');
                    $("#DivPopUp").removeClass("popTradeIn");
                    $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
                    $("#DivPopUp").css("left", "1%");
                }
            });
        }
    }
    else {
        if (!($('#linkindexServiceContract').attr('disabled') == 'disabled' || $('#linkindexServiceContract').attr('disabled') == true)) {
            if (!($('#linkactiveindexServiceContract').attr('disabled') == 'disabled' || $('#linkactiveindexServiceContract').attr('disabled') == true)) {
                $('#HiddenPopUpName').val('ServiceContract');
                $.ajax({
                    type: "POST",
                    url: "./../ServiceContract/ServiceContractdetails?DetailsYesNo=" + DetailsYesNo + "&scenarioID=" + scenarioID,
                    beforeSend: function () {
                        $('#DesksInProgress').show();
                    },
                    success: function (viewcontract) {
                        $('#DesksInProgress').hide();
                        $("#viewEditContactArea").html(viewcontract);
                        $("input[readonly = 'readonly']").each(function () { $(this).attr('tabindex', '-1'); });
                        centrpop('#DivPopUp');
                        popupload('#backgroundsearch', '#DivPopUp');
                        $("#DivPopUp").removeClass("popTradeIn");
                        $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
                        $("#DivPopUp").css("left", "1%");
                    }
                });
            }
        }
    }
}

function LoadMenusellingDetails(id) {
    var SnID = id.split("|");
    // if active scenario id == 0 then load main div else load info section
    $('#FinIDForLender').val(SnID[1]);
    var DetailsYesNo = "";
    var ScenarioID = "";
    if (SnID[0] == "0") {
        return false;
    }
    var URL = './../Scenario/CheckStockForActiveScenario';
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            if (result.Msg != "success") {
                ShowAlertMessageIndex('Please attach Vehicle for Product Packages.');
                return false;
            }
            var URL = './../menuselling/vieweditmenuselling';
            $.ajax({
                type: 'Post',
                url: URL,
                success: function (result) {
                    if (result.Message == "No Record") {
                        ShowAlertMessageIndex('There are no Packages for selected Vehicle.');
                    }
                    else {
                        document.getElementById("MainDiv").style.display = "none";
                        $("#Internaldropdownpage").show();
                        $("#Internaldropdownpage").html(result);
                        $("#RightDropdown").show();
                        if (SnID[1] == 2)
                            $("#listDealRecap").hide();
                        $("#DealRelatedDiv").show();
                        $("#DivFinanceTypes").show();
                        SelectFinanceType(SnID[1]);
                        $("#create_scenario").hide();
                        $("#Copy_scenario").hide();
                        $("#HiddenScenarioID").val(SnID[0]);
                        GetScenarioStatus(SnID[0]);
                    }
                },
                error: function (error) {
                }
            });
        },
        error: function (result) {
        }
    });
}

function loadPopupcreatefscenario() {
    if (popupStatus == 0) {
        $("#backgroundPopupFtype").css({
            "opacity": "0.7"
        });
        $("#backgroundPopupFtype").fadeIn("slow");
        $(".Ftype").fadeIn("slow");
        popupStatus = 1;
    }
}

function disablePopupcreatefscenario() {
    $("#backgroundPopupFtype").fadeOut("slow");
    $(".Ftype").fadeOut("slow");
    popupStatus = 0;
}

function loadPopup() {
    if ($("#bgPopup").data("state") == 0) {
        $("#bgPopup").css({
            "opacity": "0.7"
        });
        $("#bgPopup").fadeIn("medium");
        $("#Popup").fadeIn("medium");
        $("#bgPopup").data("state", 1);
    }
}

function disablePopup() {
    if ($("#bgPopup").data("state") == 1) {
        $("#bgPopup").fadeOut("medium");
        $("#Popup").fadeOut("medium");
        $("#bgPopup").data("state", 0);
    }
}

function centerPopup() {
    var winw = $(window).width();
    var winh = $(window).height();
    var popw = $('#Popup').width();
    var poph = $('#Popup').height();
    $("#Popup").css({
        "position": "absolute",
        "top": winh / 2 - poph / 2,
        "left": winw / 2 - popw / 2
    });
    $("#bgPopup").css({
        "height": winh
    });
}

function centerPopupcreatefscenario() {
    var windowWidth = document.documentElement.clientWidth;
    var windowHeight = document.documentElement.clientHeight;
    var popupHeight = $(".Ftype").height();
    var popupWidth = $(".Ftype").width();
    if (popupWidth == 0) {
        $(".Ftype").css({
            "position": "absolute",
            "top": windowHeight / 4,
            "left": windowWidth / 4
        });
    }
    else {
        $(".Ftype").css({
            "position": "absolute",
            "top": windowHeight / 2 - popupHeight / 2,
            "left": windowWidth / 2 - popupWidth / 2
        });
    }
}

function ShowErrorMessage(msg) {
    ShowAlertForError(msg);
}

function ShowAlertForError(message) {
    $("#alertError #msg").html(message);
    centrpop('#alertError');
    popupload('#bgpopup', '#alertError');
}

function ShowAlertMessageForDelivered(message) {
    $("#alertDelivered p").html(message);
    centrpop('#alertDelivered');
    popupload('#alertPOpDelivered', '#alertDelivered');
}

function loadEmployeeCommission() {
    $('#DesksInProgress').show();
    var deskid = $("#HiddenDeskID").val();
    var URL = "./../CommissionableEmployee/SetupCommissionableEmployee";
    $.ajax({
        type: 'Post',
        url: URL,
        data: {
            id: deskid
        },
        success: function (result) {
            $('#DesksInProgress').hide();
            $(".finance_contr").hide();
            $("#Internaldropdownpage").show();
            $("#Internaldropdownpage").html('');
            $("#Internaldropdownpage").html(result);
            $("#HiddenPageID").val('EC') //details right dropdown value sets to respective page on ETAPS closes 
            $("input#tbxVehicleDesc").attr('disabled', false);
            $("#tbxStockNum1").attr('disabled', false);
            $(".vehicledesclabel, .stocknumlabel").attr('disabled', false);
            $(".vehicledesclabel, .stocknumlabel").removeClass('disableSearch').addClass('login_bottm_rigt');
            $(".searchsize_25").css({ 'opacity': '1', 'cursor': 'pointer' });
        }
    });
}

function loadDealRecap() {
    $('#DesksInProgress').show();
    var deskid = $("#HiddenDeskID").val();
    var financeid = $("#hidden_finance").val();
    var ScenarioID = $('#HiddenScenarioID').val();
    $.ajax({
        type: "POST",
        url: "./../FinanceCostPercentage/FinanceCostPercentage",
        data: {
            type: financeid
        },
        success: function (ViewModel) {
            var financetype = 0;
            if ($('#OPenRoMessageflag').val() != '' && $('#DealRecapISROExist').val() == 'True') {
                $('#divROMessageFin').show();
                $('#divROMessageCash').show();
                $('#divROMessageLease').show();
                $('#divROMessageBall').show();
            }

            $("#delivered_deal").attr('disabled', 'disabled');
            $('#DesksInProgress').hide();
            $(".finance_contr").hide();
            $("#Internaldropdownpage").show();
            $("#Internaldropdownpage").html('');
            $("#Internaldropdownpage").html(ViewModel);
            $("#HiddenPageID").val('DR'); //details right dropdown value sets to respective page on ETAPS closes
            $("input#tbxVehicleDesc").attr('disabled', false);
            $("#tbxStockNum1").attr('disabled', false);
            $(".vehicledesclabel, .stocknumlabel").attr('disabled', false);
            $(".vehicledesclabel, .stocknumlabel").removeClass('disableSearch').addClass('login_bottm_rigt');
            $(".searchsize_25").css({ 'opacity': '1', 'cursor': 'pointer' });
            //Bug 17914:03.05.FRD060 Open RO - should not trigger during Pending Close
            if ($("#HiddenDeskStatus").val() != "Posted Deal" && $('#hiddenDeskStatus').val() != 'Closed Deal') {
                $.ajax({
                    type: 'Post',
                    url: './../Scenario/GetFinance',
                    datatype: "JSON",
                    data: { ScenarioID: ScenarioID },
                    success: function (result) {
                        financetype = result.result;
                        switch (financetype) {
                            case 1: OpenROonLoadFinance();
                                break;
                            case 2: OpenRoOnLoadCash();
                                break;
                            case 3: openRoOnLoadLease();
                                break;
                            case 4: OpenRoOnLoadBalloon();
                                break;
                        }
                    }
                });
            }
        }

    });

}

function loadBookoutDeal() {
    $('#DesksInProgress').show();
    $('#divROMessage').show();
    $('#divROStatusMsgLease').hide();
    $('#divROStatusMsgFinance').hide();
    $('#divROStatusMsgCash').hide();
    $('#divROStatusMsgBalloon').hide();
    $('#divROMessageFin').hide();
    $('#divROMessageCash').hide();
    $('#divROMessageLease').hide();
    $('#divROMessageBall').hide();
    $('#viewROFin').hide();
    $('#viewROBall').hide();
    $('#viewROLease').hide();
    $('#viewROCash').hide();
    var deskid = $("#HiddenDeskID").val();
    var URL = "./../BookOutDeal/BookOutDeal";
    $.ajax({
        type: 'Post',
        url: URL,
        data: {
            CheckRO: true
        },
        success: function (result) {
            $("#delivered_deal").attr('disabled', 'disabled');
            $('#divROMessage').hide();
            $('#divROStatusMsgLease').hide();
            $('#divROStatusMsgFinance').hide();
            $('#divROStatusMsgCash').hide();
            $('#divROStatusMsgBalloon').hide();
            $('#DesksInProgress').hide();
            $(".finance_contr").hide();
            $("#Internaldropdownpage").show();
            $("#Internaldropdownpage").html('');
            $("#Internaldropdownpage").html(result);
            $("#HiddenPageID").val('BD'); //details right dropdown value sets to respective page on ETAPS closes
            $("input#tbxVehicleDesc").attr('disabled', true);
            $("#tbxStockNum1").attr('disabled', true);
            $(".vehicledesclabel, .stocknumlabel").attr('disabled', true);
            $(".vehicledesclabel, .stocknumlabel").removeClass('login_bottm_rigt').addClass('disableSearch');
            $(".searchsize_25").css({ 'opacity': '0.5', 'cursor': 'not-allowed' });

        }
    });

}

function loadETAPS() {
    $('#DesksInProgress').show();
    $.ajax({
        type: "POST",
        url: "./../Scenario/GetScenarioStatusForEtaps",
        success: function (result) {
            if (result.result == "success") {
                $.ajax({
                    type: "POST",
                    url: "./../Scenario/ETAPViewEdit",
                    success: function (etapObj) {
                        $('#DesksInProgress').hide();
                        $("#ETAPViewEdit").html(etapObj);
                        centrpop('#EtapPoup');
                        popupload('#bgPopupETAP', '#EtapPoup');
                    }
                });
            }
        }
    });
}

function loadScenarioDets() {
    var ScenarioID = $('#HiddenScenarioID').val();
    $('.titleNone').show();
    $(".finance_contr").show();
    $("#Internaldropdownpage").hide();
    $("#HiddenPageID").val('SD'); //details right dropdown value sets to respective page on ETAPS closes
    $("input#tbxVehicleDesc").attr('disabled', false);
    $("#tbxStockNum1").attr('disabled', false);
    $(".vehicledesclabel, .stocknumlabel").attr('disabled', false);
    $(".vehicledesclabel, .stocknumlabel").removeClass('disableSearch').addClass('login_bottm_rigt');
    $(".searchsize_25").css({ 'opacity': '1', 'cursor': 'pointer' });
    $('#HiddenScenDetailsLoad').val('1');
    RedirectToScenario(ScenarioID, 'Yes');
}

function CloseMenusellingPopup() {
    var DetailsYesNo = "";
    var ScenarioID = "";
    var DetalsValue = $('#DetailsClicked').val();
    ClosePopUP('#backgroundsearchprdcpac', '#DivPopUpProductPackages');
    AjaxCallCalcEngine(ScenarioID);
    if (DetalsValue == 'yes') {
        ScenarioID = $("#HiddenScenarioID").val();
        DetailsYesNo = 'Yes';
        RedirectToScenario(ScenarioID, DetailsYesNo);
    }
    else {
        ScenarioID = $("#ActiveScenarioID").val();
        DetailsYesNo = 'No';
        var URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + ScenarioID;
        window.location.href = URL;
    }
}

function SaveMSRPToScenario(PopUpDiv, Background) {
    updateMSRP();
    var Details = '';
    var financetype = 0;
    var ScenarioIDForCalc;
    if ($('#DetailsClicked').val() == 'yes') {
        ScenarioIDForCalc = $("#HiddenScenarioID").val();
        Details = "Yes";
    }
    else {
        ScenarioIDForCalc = $("#ActiveScenarioID").val();
        Details = 'No';
    }
    $.ajax({
        type: 'Post',
        url: './../Scenario/GetFinance',
        datatype: "JSON",
        data: { ScenarioID: ScenarioIDForCalc },
        success: function (result) {
            financetype = result.result;
            switch (financetype) {
                case 1: AjaxCalcCallForFinance(ScenarioIDForCalc);
                    break;
                case 2: AjaxCalcCallForCash(ScenarioIDForCalc);
                    break;
                case 3: AjaxCalcCallForLease(ScenarioIDForCalc);

                    break;
                case 4: AjaxCalcCallForBalloon(ScenarioIDForCalc);
                    break;
            }
        }
    });
    var TotalMSRP = $('#TotalMSRP').val();
    if (TotalMSRP != 0) {
        $('#item_MSRP').val(parseFloat(TotalMSRP).toFixed(2));
        $('#tbxMSRP').val(parseFloat(TotalMSRP).toFixed(2));
    }
    else {
        $('#item_MSRP').val('');
        $('#tbxMSRP').val('');
    }
    if ($('#DetailsClicked').val() == 'yes') {
        var resper = $('#tbxResidualPercentage').val();
        var percentindex = resper.indexOf('%');
        if (percentindex != -1) {
            resper = resper.substr(0, percentindex);
        }
        var capitalCost = 0;
        var fintype = $("#HiddenFinanceID").val();
        if (fintype != 3) {
            capitalCost = (TotalMSRP + parseFloat($('#tbxDealerAdj').val()));
            if (capitalCost != '') {
                $('#tbxCapitalCost').val(parseFloat(capitalCost).toFixed(2));
            }
            else {
                $('#tbxCapitalCost').val('0.00');
            }
        }
        $.ajax({
            type: 'Post',
            url: './../Scenario/GetResidualAmount',
            success: function (result) {
                if (result.result != '') {
                    $('#tbxResidualAmount').val(addDecimalPointIfNot(result.result));
                }
                else {
                    $('#tbxResidualAmount').val('');
                }
            }
        });
    }
    else {
        $.ajax({
            type: 'Post',
            url: './../Scenario/GetCapCost',
            success: function (result) {
                if (result.result != '') {
                    $('#tbxpCapCost').val(parseFloat(result.result).toFixed(2));
                }
                else {
                    $('#tbxpCapCost').val('');
                }
            }
        });
    }
    ClosePopUP(Background, PopUpDiv);
    RedirectToScenario(ScenarioIDForCalc, Details);
}

function SaveServiceContract() {
    var DetailsYesNo = "";
    var ScenarioID = "";
    if ($('#DetailsClicked').val() == 'yes') {
        ScenarioID = $("#HiddenScenarioID").val();
        DetailsYesNo = 'Yes';
    }
    else {
        ScenarioID = $("#ActiveScenarioID").val();
        DetailsYesNo = 'No';
    }
    var financetype = 0;
    $.ajax({
        type: 'Post',
        url: './../Scenario/GetFinance',
        datatype: "JSON",
        data: { ScenarioID: ScenarioID },
        success: function (result) {
            financetype = result.result;
            switch (financetype) {
                case 1: AjaxCalcCallForFinance(ScenarioID);
                    break;
                case 2: AjaxCalcCallForCash(ScenarioID);
                    break;
                case 3: AjaxCalcCallForLease(ScenarioID);
                    break;
                case 4: AjaxCalcCallForBalloon(ScenarioID);
                    break;
            }
        }
    });
    GetScenarioStatus(ScenarioID);
    if ($("#HiddenPP").val() != '') {
        ClosePopUP('#backgroundsearch', '#DivPopUp');
    }
    else {
        ClosePopUP('#backgroundsearch', '#DivPopUp');
        RedirectToScenario(ScenarioID, DetailsYesNo);
    }
}

function SaveTradeInOnClose() {
    var ScenarioID = $('#HiddenScenID').val();
    var DetailsYesNo = $('#HiddenDetailsYesNo').val();
    $('#hiddenFieldForSelectedRow').val('');

    var ScenarioIDForCalc;
    if ($('#DetailsClicked').val() == 'yes') {
        ScenarioIDForCalc = $("#HiddenScenarioID").val();
    }
    else {
        ScenarioIDForCalc = $("#ActiveScenarioID").val();
    }
    RedirectToScenario(ScenarioID, DetailsYesNo);
    var financetype = 0;
    $.ajax({
        type: 'Post',
        url: './../Scenario/GetFinance',
        datatype: "JSON",
        data: { ScenarioID: ScenarioIDForCalc },
        success: function (result) {
            financetype = result.result;
            switch (financetype) {
                case 1: AjaxCalcCallForFinance(ScenarioIDForCalc);
                    break;
                case 2: AjaxCalcCallForCash(ScenarioIDForCalc);
                    break;
                case 3: AjaxCalcCallForLease(ScenarioIDForCalc);
                    break;
                case 4: AjaxCalcCallForBalloon(ScenarioIDForCalc);
                    break;
            }
            popupdisable('#backgroundsearch', '#popTradeIn');
        }
    });
}

function UpdateFirstPayment() {
    var URL = './../Scenario/UpdateScenarioDetails';
    $.ajax({
        type: 'Post',
        url: URL,
        data: { ScenarioID: $("#ActiveScenarioID").val(), Value: $('#tbxFirstPayment').val(), ColumnName: 'FirstPayment' },
        success: function (result) {
            if (result.DaysForFirstPayment != null && result.DaysForFirstPayment != undefined) {
                if (getDateDifference($('#tbxContractDatefinance').val(), $('#tbxFirstPayment').val()) == 0) {
                    $('#daysForFirstPayment').val("0");
                    $("#hiddenDaysForFirstPayment").val($("#daysForFirstPayment").val());
                }
                else {
                    $("#hiddenDaysForFirstPayment").val($("#daysForFirstPayment").val());
                }
            }
            else {
                $('#daysForFirstPayment').val("0");
                $("#hiddenDaysForFirstPayment").val($("#daysForFirstPayment").val());
            }
            AjaxCallCalcEngine($("#ActiveScenarioID").val());
        },
        error: function (result) {
        }
    });
}

function RebatesOnChange() {
    var URL = './../Scenario/RebatesOnChange';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            Rebates: $("#item_Rebates").val()
        },
        success: function (result) {
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: $("#ActiveScenarioID").val() },
                success: function (result) {
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance($("#ActiveScenarioID").val());
                            break;
                        case 2: AjaxCalcCallForCash($("#ActiveScenarioID").val());
                            break;
                        case 3: AjaxCalcCallForLease($("#ActiveScenarioID").val());
                            break;
                        case 4: AjaxCalcCallForBalloon($("#ActiveScenarioID").val());
                            break;
                    }
                }
            });
        },
        error: function (error) {
        }
    });
}

function LenderContractYes(Type) {
    var LenderType = $("#DDLLender").val();
    if (Type == "No") {
        var Flag = "ContractCodeChange";
        $('#hiddenLenderContractField').val($('#DDLLenderContract').val());
    }
    else {
        var Flag = "";
        $('#hiddenLenderContractField').val($('#DDLLenderContract').val());
    }
    if ($('#HiddenDefaultContractID').val() != '') {

        LoadLender($('#HiddenDefaultContractID').val(), Type, Flag);
        $('#HiddenDefaultContractID').val('');
    }
    else {
        LoadLender(0, Type, Flag);
    }
    ClosePopUP('#backgroundsearch', '#DivChangeLenderPopUp');
    $("#HiddenYesOrNo").val(Type);
    var ScenarioIDForCalc;
    if ($('#DetailsClicked').val() == 'yes') {
        ScenarioIDForCalc = $("#HiddenScenarioID").val();
        $('#HiddenDetailsYesNo').val('Yes');
    }
    else {
        ScenarioIDForCalc = $("#ActiveScenarioID").val();
        $('#HiddenDetailsYesNo').val('No');
    }
    var financetype = 0;
    $.ajax({
        type: 'Post',
        url: './../Scenario/GetFinance',
        datatype: "JSON",
        data: { ScenarioID: ScenarioIDForCalc },
        success: function (result) {
            financetype = result.result;
            switch (financetype) {
                case 1: AjaxCalcCallForFinance(ScenarioIDForCalc);
                    break;
                case 2: AjaxCalcCallForCash(ScenarioIDForCalc);
                    break;
                case 3: AjaxCalcCallForLease(ScenarioIDForCalc);
                    break;
                case 4: AjaxCalcCallForBalloon(ScenarioIDForCalc);
                    break;
            }
        }
    });
}

function ShowProductPackages(scenarioID, DetailsYesNo) {
    $("#HiddenPP").val('Yes');
    var ScenarioID = $("#ActiveScenarioID").val();
    LoadMenusellingDetails(ScenarioID);
}

function GetActiveScenarioModel() {
    var url = "./../Scenario/_ActiveScenario";
    $.ajax({
        type: "POST",
        url: url,
        success: function (LoadScenarioDetails) {
            $("#DivActiveScenario").html(LoadScenarioDetails);
            DisableDesk($("#HiddenDeskStatus").val());
            $('#DivActiveScenario li input:not([readonly="readonly"])').each(function () {
                $(this).parent().css('background-color', '#999');

                $(this).focus(function () {
                    $(this).parent().css('background-color', '#fff');
                });
                $(this).blur(function () {
                    $(this).parent().css('background-color', '#999');
                });
            });
            $("#CalculationInProgress").hide();
        }
    });
}

function SaveValueAndCloseCustomerPopup() {
    var DetailsYesNo = "";
    var ScenarioID = "";
    var Email = $('#tbxEmail').val();
    if (Email != "" && Email != undefined && Email != null) {
        var charat = String.fromCharCode(64);
        var chardot = String.fromCharCode(46);
        var atindex = Email.indexOf(charat, 1);
        var atlastindex = Email.lastIndexOf(charat);
        var dotindex = Email.lastIndexOf(chardot);
        if ((atindex != atlastindex) || (atindex > dotindex) || (dotindex > Email.length - 3) || (atindex == -1)) {
            $('.ErrorDivUpdate').html('');
            $('input').removeClass('error');
            $("#tbxEmail").after("<div class='ErrorDivUpdate' style='position:absolute; color:red; left: 30%; font-size:15px;'>Email is in invalid format.</div>");
            setTimeout(function () {
                $("#tbxEmail").focus();
            }, 200);
            return false;
        }
        else {
            $('.ErrorDivUpdate').html('');
            $('.ErrorDivUpdate').hide();
        }
    }
    else {
        $('.ErrorDivUpdate').html('');
        $('.ErrorDivUpdate').hide();
    }
    Email = "";
    var Email1 = $('#tbxEmail1').val();
    if (Email1 != "" && Email1 != undefined && Email1 != null) {
        var charat = String.fromCharCode(64);
        var chardot = String.fromCharCode(46);
        var atindex = Email1.indexOf(charat, 1);
        var atlastindex = Email1.lastIndexOf(charat);
        var dotindex = Email1.lastIndexOf(chardot);
        if ((atindex != atlastindex) || (atindex > dotindex) || (dotindex > Email1.length - 3) || (atindex == -1)) {
            $('.ErrorDivUpdate').html('');
            $('input').removeClass('error');
            $("#tbxEmail1").after("<div class='ErrorDivUpdate' style='position:absolute; color:red; left: 30%; font-size:15px;'>Email is in invalid format.</div>");
            setTimeout(function () {
                $("#tbxEmail1").focus();
            }, 200);
            return false;
        }
        else {
            $('.ErrorDivUpdate').html('');
            $('.ErrorDivUpdate').hide();
        }
    }
    else {
        $('.ErrorDivUpdate').html('');
        $('.ErrorDivUpdate').hide();
    }
    if ($('#DetailsClicked').val() == 'yes') {
        ScenarioID = $("#HiddenScenarioID").val();
        DetailsYesNo = 'Yes';
    }
    else {
        ScenarioID = $("#ActiveScenarioID").val();
        DetailsYesNo = 'No';
    }
    if ($('#HiddenPopUpName').val() == 'Cobuyer') {
        var URL = './../CoBuyerSearch/GetCustomerId';
        $.ajax({
            type: 'Post',
            url: URL,
            success: function (result) {
                if (result.CustomerID != "" && result.CustomerID != null) {
                    var zipcode1 = $("#tbxZip1").val();
                    $.ajax({
                        url: "./../CobuyerSearch/GetZipCodeData?ZipCode=" + zipcode1,
                        type: "POST",
                        dataType: "json",
                        success: function (data) {

                            //if (data.ZipExist == "false") {
                            //    if ($('#DDLPartyType1 option:selected').val() == "Person") {
                            //        $("#tbxEmail1").after("<div class='ErrorDivUpdate' style='position:absolute; color:red; left: 30%; font-size:15px;'>ZIP Code is invalid.</div>");
                            //    }
                            //    else {
                            //        $("#editcustomerphone1").after("<div class='ErrorDivUpdate' style='position:absolute; color:red; left: 30%; font-size:15px;'>ZIP Code is invalid.</div>");
                            //    }
                            //    $("#tbxZip1").focus();
                            //    return false;
                            //}
                            //else {
                            $('#HiddenPopUpName').val('Customer');
                            RedirectToCustomerSearch($("#HiddenDeskStatus").val(), result.CustomerID);

                            //}
                        }
                    });
                }
                else {
                    $('#HiddenPopUpName').val('Customer');
                    if ($('#hiddenAttachCustID').val() == undefined) {
                        RedirectToCustomerSearch($("#HiddenDeskStatus").val(), result.CustomerID);
                    }
                    else {
                        RedirectToCustomerSearch($("#HiddenDeskStatus").val(), result.CustomerID);
                    }
                }
            }
        });
    }
    else {
        if ($('#hiddenAttachCustID').val() != "" && $('#hiddenAttachCustID').val() != null && $('#hiddenAttachCustID').val() != undefined) {
            var zipcode = $("#tbxZip").val();
            $.ajax({
                url: "./../CobuyerSearch/GetZipCodeData?ZipCode=" + zipcode,
                type: "POST",
                dataType: "json",
                success: function (data) {

                    //if (data.ZipExist == "false") {
                    //    if ($('#DDLPartyType option:selected').val() == "Person") {
                    //        $("#tbxEmail").after("<div class='ErrorDivUpdate' style='position:absolute; color:red; left: 30%; font-size:15px;'>ZIP Code is invalid.</div>");
                    //    }
                    //    else {
                    //        $("#editcustomerphone").after("<div class='ErrorDivUpdate' style='position:absolute; color:red; left: 30%; font-size:15px;'>ZIP Code is invalid.</div>");
                    //    }
                    //    $("#tbxZip").focus();
                    //    return false;
                    //}
                    //else {
                    ClosePopUP('#backgroundsearch', '#Customerpopop');
                    ChangeCustomerNameOnIndex();
                    if (DetailsYesNo == 'No') {
                        URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + ScenarioID;
                        window.location.href = URL;
                    }
                    else {
                        RedirectToScenario(ScenarioID, DetailsYesNo);
                    }
                    AjaxCallCalcEngine(ScenarioID);
                }
                //}
            });
        }
        else {
            ClosePopUP('#backgroundsearch', '#Customerpopop');
            ChangeCustomerNameOnIndex();
            if (DetailsYesNo == 'No') {
                URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + ScenarioID;
                window.location.href = URL;
            }
            else {
                RedirectToScenario(ScenarioID, DetailsYesNo);
            }
            AjaxCallCalcEngine(ScenarioID);
        }
    }
}

$('#btnSearchApprisal').live("click", function (e) {
    if ($("#HiddenAppButton").val() == "Yes") {
    }
    else {
        var scenarioid = $("#ActiveScenarioID").val();
        $.ajax({
            type: "POST",
            url: './../SearchAppraisal/BasicSearch?ScenarioID=' + scenarioid,
            success: function (viewModel) {
                $('#btnSearchApprisal').focusout();
                e.preventDefault();
                $("#popApprisalArea").html(viewModel);
                centrpop('#popApprisal');
                $("#bg_apprisal , #popApprisal").show();
                $("#popApprisal").css("z-index", "30001");
                var lastInput = $('#popApprisal').find('input:not([disabled="disabled"]),select:not([disabled="disabled"]),button,textarea').filter(':not([readonly="readonly"]):visible:last');
                var firstInput = $('#popApprisal').find('input:not([disabled="disabled"]),select:not([disabled="disabled"]),button,textarea').filter(':not([readonly="readonly"]):visible:first');
                firstInput.focus();
                firstInput.select();
                lastInput.keydown(function (e) {
                    var code = (e.keyCode ? e.keyCode : e.which);
                    if (lastInput.attr('type') != "button" && lastInput.attr('type') != "submit") {
                        if (code == 9 || code == 13) {
                            e.preventDefault();
                            firstInput.focus();
                        }
                    }
                    else {
                        if (code == 9) {
                            if ($('#SearchApprisal').css('display') == "none") {
                                e.preventDefault();
                                firstInput.focus();
                                firstInput.select();
                            }
                            else if ($('#SearchApprisal').css('display') == "block") {
                                e.preventDefault();
                                $('#VinValue').focus();
                                $('#VinValue').select();
                            }
                        }
                    }
                });
                popupStatus = 1;
            }
        });
    }
});

$(".ProductPackages").click(function () {
    $("#DivArrow").show();
    $("#deskName").css('margin-left', '40px');
    $('#HiddenPPClick').val('Index');
    var URL = './../Scenario/CheckStockForActiveScenario';
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            if (result.Msg != "success") {
                ShowAlertMessageIndex('Please attach Vehicle for Product Packages.');
                return false;
            }
            var URL = './../menuselling/vieweditmenuselling';
            $.ajax({
                type: 'Post',
                url: URL,
                data: {
                    Type: "Index"
                },
                success: function (result) {
                    if (result.Message == "No Record") {
                        ShowAlertMessageIndex('There are no Packages for selected Vehicle.');
                    }
                    else {
                        var ScenarioID = $("#ActiveScenarioID").val();
                        $("#HiddenScenarioID").val(ScenarioID);
                        $("#MainDiv").html(result);
                        $("#DivVehiclDescandFinanceDetails").show();
                    }
                },
                error: function (error) {
                }
            });
        },
        error: function (result) {
            ShowAlertMessageIndex('Failing.');
        }

    });
});

//Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
$('#item_TradeAllowance').live("change", function (e) {
    var scid = $("#ActiveScenarioID").val();
    var URL = './../Scenario/TradeAllowanceOnChange';
    $(this).val(addDecimalPointIfNot($(this).val()));
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            TradeAllowance: $("#item_TradeAllowance").val(),
            ScenarioID: scid
        },
        success: function (result) {
        },
        error: function (error) {
        }
    });
});

//Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
$('#item_TradePayoff').live("change", function (e) {
    var scid = $("#ActiveScenarioID").val();
    var URL = './../Scenario/TradePayoffOnChange';
    $(this).val(addDecimalPointIfNot($(this).val()));
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            TradePayoff: $("#item_TradePayoff").val(),
            ScenarioID: scid
        },
        success: function (result) {
        },
        error: function (error) {
        }
    });
});

$('.RightDropdown').change(function () {
    var selected = $(this).val();
    if (selected === 'EmployeeCommissionLink') {
        loadEmployeeCommission();
    }
    else if (selected === 'BookOutDealLink') {
        loadBookoutDeal();
    }
    else if (selected === 'listDealRecap') {
        loadDealRecap();
    }
    else if (selected == 'EtapsViewEdit') {
        loadETAPS();
    }
    else if (selected == 'SceDetails') {
        loadScenarioDets();
    }
    else if (selected == 'SceSummary') {
        ShowMainDiv();
    }
});

$("#BtnCancel_Deal1, #BtnCross_Deal1").click(function () {
    disablePopupConfirmation("#backgroundDeal1", "#printFormsDeal");
    $('#tbxFirstPayment').focus();
    $("#econtract_deal").removeAttr("disabled", "disabled");
    $("#econtract_deal").removeClass('disableLinkUnwind');
    $('#HiddenSSNflag').val('');
    $('#HiddenSSNflag1').val('');
});

$('#PopOkLease').click(function (event) {
    var stack_no = $("#tbxStockNum1").val();
    var fin_type = $(':radio[name=selectvalue]:checked').val();
    var sel_lender = $("#DDLLender").val();
    var URL = './../Scenario/LoadLenderSetupDetails';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            StockNumber: stack_no,
            FinanceType: fin_type,
            LenderTypeId: sel_lender
        },
        success: function (result) {
        },
        error: function (error) {
        }
    });
});

$('#PopOkLease').click(function (event) {
    var stack_no = $("#tbxStockNum1").val();
    var fin_type = $(':radio[name=selectvalue]:checked').val();
    var sel_lender = $("#DDLLender").val();
    var URL = './../Scenario/LoadLenderSetupDetails';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            StockNumber: stack_no,
            FinanceType: fin_type,
            LenderTypeId: sel_lender
        },
        success: function (lenderSetupDetails) {
            ClosePopUPLease('#backgroundsearch', '#DivChangeLenderPopUpLease');
            $('#tbxMoneyRate').val(lenderSetupDetails.MoneyRate);
            $('#tbxFirstPayment').val(lenderSetupDetails.FirstPayment);
            $('.VerifyPaymentMsg').html('');
            $('.VerifyPaymentMsg').hide();
            if (lenderSetupDetails.AdvancePayment != '') {
                $('#tbxAdvancePay').val(parseFloat(lenderSetupDetails.AdvancePayment).toFixed(2));
            } else {
                $('#tbxAdvancePay').val('0.00');
            }
            $('#tbxSecdeptype').val(lenderSetupDetails.LeaseSecurityDepositType);
            if (lenderSetupDetails.PayLeaseRent != '') {
                $('#tbxRent').val(parseFloat(lenderSetupDetails.PayLeaseRent).toFixed(2));
            } else {
                $('#tbxRent').val('0.00');
            }
            if (lenderSetupDetails.LeaseDepreciation != '') {
                $('#tbxDepreciation').val(parseFloat(lenderSetupDetails.LeaseDepreciation).toFixed(2));
            } else {
                $('#tbxDepreciation').val('0.00');
            }
            if (lenderSetupDetails.SecondPaymentDate != null && lenderSetupDetails.SecondPaymentDate != '') {
                $('#tbxSecondPayment').val(lenderSetupDetails.SecondPaymentDate);
            }
            if (lenderSetupDetails.DaysForSecondPayment != null && lenderSetupDetails.DaysForSecondPayment != undefined) {
                if (lenderSetupDetails.DaysForSecondPayment == "-1") {
                    $('#daysForSecondPayment').val("");
                    $('#tbxSecondPayment').val("");
                    $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
                }
                else if (getDateDifference($('#tbxFirstPayment').val(), $('#tbxSecondPayment').val()) == 0) {
                    $('#daysForSecondPayment').val("0");
                    $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
                }
                else {
                    $('#daysForSecondPayment').val(parseInt(lenderSetupDetails.DaysForSecondPayment) + 1);
                    $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
                }
            }
            else {
                $('#daysForSecondPayment').val("0");
                $("#hiddenDaysForSecondPayment").val($("#daysForSecondPayment").val());
            }
        },
        error: function (error) {
        }
    });
});

$("#BtnCancel_Deal, #BtnCross_Deal").click(function () {
    disablePopupConfirmation("#backgroundDeal", "#contactAreaDeal");
    $('#tbxFirstPayment').focus();
    $("#econtract_deal").removeAttr("disabled", "disabled");
    $("#econtract_deal").removeClass('disableLinkUnwind');
    $('#HiddenSSNflag').val('');
    $('#HiddenSSNflag1').val('');
});

$("#BtnCross_Appr, #BtnCancel_Appr").click(function () {
    disablePopupConfirmation("#backgroundDeal_Appr", "#contactAreaDeal_Appr");
    $("#econtract_deal").removeAttr("disabled", "disabled");
    $("#econtract_deal").removeClass('disableLinkUnwind');
});

$("#BtnCross_ApprInventory, #BtnCancel_ApprInventory").click(function () {
    disablePopupConfirmation("#divInventory", "#contactAreaDeal_ApprInventory");
    $("#econtract_deal").removeAttr("disabled", "disabled");
    $("#econtract_deal").removeClass('disableLinkUnwind');
});

$("#btnYes_Appr").click(function () {
    disablePopupConfirmation("#backgroundDeal_Appr", "#contactAreaDeal_Appr");
    $.ajax({
        type: "POST",
        url: "./../Scenario/EContractDealFirstPaymentDate",
        success: function (result) {
            if (result.paymentValidation != '') {
                var msg = result.paymentValidation + "</br> Would you like to proceed to Contracting Deal?";
                document.getElementById("lblmsg3").innerHTML = msg;
            }
            else {
                var msg = " Would you like to proceed to Contracting Deal?";
                document.getElementById("lblmsg3").innerHTML = msg;
            }
            centrpop('#contactAreaDeal');
            popupload('#backgroundDeal', '#contactAreaDeal');
            $("#btnYes_Deal").removeAttr("disabled", "disabled");
            $("#BtnCancel_Deal").removeAttr("disabled", "disabled");
        }
    });
});

$("#DealRecapBackButton").live("click", function () {
    var ScenarioID = $('#HiddenScenarioID').val();
    $("#delivered_deal").removeAttr('disabled', 'disabled');
    $('.titleNone').show();
    $(".finance_contr").show();
    $("#Internaldropdownpage").hide();
    $(".finance_contr").show();
    $(".RightDropdown").val('SceDetails');
    $("#HiddenPageID").val('SD'); //details right dropdown value sets to respective page on ETAPS closes
    $('#HiddenScenDetailsLoad').val('1');
    RedirectToScenario(ScenarioID, 'Yes');
});

$("#BookoutBack").live("click", function () {
    var ScenarioID = $('#HiddenScenarioID').val();
    $("#delivered_deal").removeAttr('disabled', 'disabled');
    $('#divROMessage').show();
    $('#divROStatusMsgLease').show();
    $('#divROStatusMsgFinance').show();
    $('#divROStatusMsgCash').show();
    $('#divROStatusMsgBalloon').show();
    $('.titleNone').show();
    $(".finance_contr").show();
    $("#Internaldropdownpage").hide();
    $(".RightDropdown").val('SceDetails');
    $("#HiddenPageID").val('SD'); //details right dropdown value sets to respective page on ETAPS closes
    $("input#tbxVehicleDesc").attr('disabled', false);
    $("#tbxStockNum1").attr('disabled', false);
    $(".vehicledesclabel, .stocknumlabel").attr('disabled', false);
    $(".vehicledesclabel, .stocknumlabel").removeClass('disableSearch').addClass('login_bottm_rigt');
    $(".searchsize_25").css({ 'opacity': '1', 'cursor': 'pointer' });
    $('#HiddenScenDetailsLoad').val('1');
    RedirectToScenario(ScenarioID, 'Yes');
});

$("#CommissionsBack").live("click", function () {
    var ScenarioID = $('#HiddenScenarioID').val();
    $('.titleNone').show();
    $(".finance_contr").show();
    $("#Internaldropdownpage").hide();
    $(".RightDropdown").val('SceDetails');
    $("#HiddenPageID").val('SD'); //details right dropdown value sets to respective page on ETAPS closes
    $('#HiddenScenDetailsLoad').val('1');
    RedirectToScenario(ScenarioID, 'Yes');
});
$("#IndexcloseRO").live("click", function () {
    popupdisable('.Index_Backgroundsearch_PagedRepairOrders', '#Index_DivPagedRepairOrders');
    var ScenarioID = $('#HiddenScenarioID').val();
    $('#HiddenScenDetailsLoad').val('1');
    //RedirectToScenario(ScenarioID, 'Yes');
});
$("#btnYes_ApprInventory").click(function () {
    disablePopupConfirmation("#divInventory", "#contactAreaDeal_ApprInventory");
    $.ajax({
        type: "POST",
        url: "./../Scenario/EContractDealFirstPaymentDate",
        success: function (result) {
            if (result.paymentValidation != '') {
                var msg = result.paymentValidation + "</br> Would you like to proceed to Contracting Deal?";
                document.getElementById("lblmsg3").innerHTML = msg;
            }
            else {
                var msg = " Would you like to proceed to Contracting Deal?";
                document.getElementById("lblmsg3").innerHTML = msg;
            }
            centrpop('#contactAreaDeal');
            popupload('#backgroundDeal', '#contactAreaDeal');
            $("#btnYes_Deal").removeAttr("disabled", "disabled");
            $("#BtnCancel_Deal").removeAttr("disabled", "disabled");
        }
    });
});

$("#btnYes_Deal").click(function () {
    var URL = './../Scenario/SendEContractDeal';
    disablePopupConfirmation("#backgroundDeal", "#contactAreaDeal");
    $('#CalculationInProgress').show();
    $('body').css('cursor', 'wait');
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        success: function (result) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
            if (result.Status == "Communication") {
                ShowAlertMessageIndex("Communication Error in Biztalk.");
                $("#econtract_deal").removeAttr("disabled", "disabled");
                $("#econtract_deal").removeClass('disableLinkUnwind');
            }
            else if (result.Status = "Success") {
                var ScenarioID = $("#HiddenScenarioID").val();
                $('#HiddenScenDetailsLoad').val('1');
                RedirectToScenario(ScenarioID, "Yes");
                //$("#delivered_deal").show();
                //$("#unwind_deal").show();
                $("#econtract_deal").hide();
                $("#audittrail_deal").hide();
                $("#cancel_deal").hide();
                $("#contract_console").attr("disabled", "disabled");
                $("#contract_console").addClass('disabledbtn');
                $("#forms").attr("disabled", "disabled");
                $("#forms").addClass('disabledbtn');
                $(".RightDropdown option").eq(3).before($("<option></option>").val("EtapsViewEdit").text("ETAPS"));

                if (result.DealNumber != 0 && result.DealNumber != null) {
                    //TFS ID 19044 -- 03.09.FRD046 Send to Contracting - Not receiving error message from AX
                    DeskStatus = "Pending Contracting Deal";
                    var LableName = DeskStatus + " " + result.DealNumber + " " + result.DealFinanceType;
                    $("#Label_Title").text(LableName);
                    $("#unwind_deal").attr("disabled", "disabled");
                    $("#unwind_deal").hide();
                }
                //TFS ID 19044 --Commented as we are showing this popup once recieved response from biztalk for contract deal.
                //                //Modified by Shalu David on 9/23/13 for Task 11519
                //                centrpop('#printFormsDeal');
                //                popupload('#backgroundDeal1', '#printFormsDeal');
                //                $("#btnYes_Deal1").removeAttr("disabled", "disabled");
                //                $("#BtnCancel_Deal1").removeAttr("disabled", "disabled");
                //                  $("#btnYes_Deal2").removeAttr("disabled", "disabled");
                //                $("#BtnCancel_Deal2").removeAttr("disabled", "disabled");
            }
        },
        error: function (result) {
            $('#CalculationInProgress').hide();
            $('body').css('cursor', 'auto');
        }
    });
});
//added for Bug # 17511
$('#forms').live("click", function () {
    PrintForms();
});

$("#btnYes_Deal2").click(function () {
    disablePopupConfirmation("#backgroundDeal1", "#printFormsDeal2");
    var url = $('#HiddenFormsURL').val() + '?Deal=' + $('#HiddenDealNumber').val();
    window.location.href = url;
});
$("#BtnCancel_Deal2, #BtnCross_Deal2").click(function () {
    disablePopupConfirmation("#backgroundDeal1", "#printFormsDeal2");
    $('#tbxFirstPayment').focus();
    $("#econtract_deal").removeAttr("disabled", "disabled");
    $('#HiddenSSNflag').val('');
    $('#HiddenSSNflag1').val('');
});

$("#items tr").click(function () {
    var id = $(this).find(".hiddenid").text();
    var URL = './../VehicleHistory/GetVehicleHistory?id=' + id;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            VehiclecenterPopup();
            VehicleloadPopup();
            $("#ajaxResponse").html(result);
        },
        error: function (error) {
        }
    });
});

$("input:disabled, textarea:disabled, select:disabled").each(function (index) {
    $(this).removeAttr('disabled', 'disabled');
    $(this).attr('readOnly', 'readonly');
    $(this).addClass("is-disabled");
});

$(".acceptNumericsOnly").live("keypress", function (event) {
    if (event.keyCode == '46' || event.charCode == '46' || event.keyCode == '39' || event.charCode == '39') {
        return false;
    }
    else {
        return ValidateNumeric(event, this);
    }
});

$('#item_StockNumber').change(function (e) {
    var URL = './../Scenario/StockOnChange';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            StockNumber: $("#item_StockNumber").val()
        },
        success: function (result) {
        },
        error: function (error) {
        }
    });
});

$('#item_Rates,#rate').live("change", function (e) {
    if ($(this).val() != '') {
        var value = $(this).val();
        var dotindex = value.indexOf('.');
        if (dotindex == 0) {
            dotindex = 1;
            value = "0" + value;
        }
        if (dotindex == -1) {
            value += ".0";
        }
        else if (value.length < dotindex + 3) {
            value = value + "0";
            if (value.length < dotindex + 3)
                value = value + "0";
        }
        $(this).val(value);
    }
    else {
        $(this).val('0.0%');
    }
    if ($(this).val() <= 100) {
        var URL = './../Scenario/RatesOnChange';
        $.ajax({
            type: 'Post',
            url: URL,
            dataType: 'json',
            data: {
                Rates: $(this).val()
            },
            success: function (result) {
                $('#tbxAPR').val(result.RoundApr);
                $('#tbxAPR').val($('#tbxAPR').val() + '%');
                var financetype = 0;
                $.ajax({
                    type: 'Post',
                    url: './../Scenario/GetFinance',
                    datatype: "JSON",
                    data: { ScenarioID: 0 },
                    success: function (result) {
                        financetype = result.result;
                        switch (financetype) {
                            case 1: AjaxCalcCallForFinance(0);
                                break;
                            case 2: AjaxCalcCallForCash(0);
                                break;
                            case 3:

                                AjaxCalcCallForLease(0);
                                break;
                            case 4: AjaxCalcCallForBalloon(0);
                                break;
                        }
                    }
                });
            },
            error: function (error) {
            }
        });
    }
});

$('#item_DownPayment').change(function (e) {
    var URL = './../Scenario/DownPaymentOnChange';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            DownPayment: $("#item_DownPayment").val()
        },
        success: function (result) {
        },
        error: function (error) {
        }
    });
});

$('#tbxDownPaymentActive, #tbxpCapCost,#item_MSRP').live("change", function (e) {
    $(this).val(addDecimalPointIfNot($(this).val()));
});

$('#item_Rebates').live("change", function (e) {
    var ScenarioIDForCalc = 0;
    var URL = './../Scenario/RebatesOnChange';
    $(this).val(addDecimalPointIfNot($(this).val()));
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            Rebates: $("#item_Rebates").val()
        },
        success: function (result) {
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioIDForCalc },
                success: function (result) {
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioIDForCalc);
                            break;
                        case 2: AjaxCalcCallForCash(ScenarioIDForCalc);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioIDForCalc);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioIDForCalc);
                            break;
                    }
                }
            });
        },
        error: function (error) {
        }
    });
});

$('#Lender').change(function (e) {
    var HiddenLender = $("#HiddenLenderType").val();
    var id = $('#Lender').val();
    var URL = './../Scenario/LenderOnChange';
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            Lender: $("#Lender").val(),
            OldLender: HiddenLender
        },
        success: function (result) {
            $("#HiddenLenderType").val(id);
            var ScenarioID = $('#HiddenScenarioID').val();
            URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + ScenarioID;
            window.location.href = URL;
        },
        error: function (error) {
        }
    });
});

$('#tbxDeskName').change(function () {
    var dskname = this.value;
    var PreviousDeskName = $('#hiddenDeskName').val();
    if (dskname == "") {
        ShowAlertMessageIndex('Desk Name cannot be empty.');
        $('#tbxDeskName').val(PreviousDeskName);
        return false;
    }

    //
    if (dskname != PreviousDeskName) {
        var URL = './../Desks/SaveDesk?DeskID=' + document.getElementById('hiddenDeskID').value + '&DeskName=' + document.getElementById('tbxDeskName').value;
        $.ajax({
            type: 'Post',
            url: URL,
            success: function (result) {
                $('#hiddenDeskName').val(dskname);
            },
            error: function (error) {
                ShowAlertMessageIndex('This Desk Name is already in use for this user, choose another name.');
                $('#tbxDeskName').val(PreviousDeskName);
            }
        });
    }

});

$("#popupContactClosesrch").click(function () {
    $("#backgroundsearch").fadeOut("slow");
    $("#popupContactsearch").hide();
    popupStatus = 0;
    var ScenarioID = $("#HiddenScenarioID").val();
    var DetailsYesNo = $('#HiddenDetailsYesNo').val();

    RedirectToScenario(ScenarioID, DetailsYesNo);
});

$('#tbxActiveStockNum').live('focusout', function () {
    $("#tbxActiveStockNum").css('color', '#fff');
    $('#tbxActiveStockNum').css('background-color', '#999');
});

$('#tbxActiveStockNum, #tbxStockNum1').live("keydown", function (event) {
    if (event.keyCode == '9') {
        $('body').click();
    }
});

$('body').live('click', function (event) {
    var targetId = event.target.id;
    var targetClass = event.target.className;
    var StockNum = $("#tbxActiveStockNum").val();
    var StockNum2 = $("#tbxStockNum1").val();
    var deskstatus = $("#HiddenDeskStatus").val();
    var scenariostatus = $("#HiddenScenarioStatus").val();
    if (deskstatus == "Scenario" || deskstatus == "Open Deal" || scenariostatus == "Scenario" || scenariostatus == "Open Deal") {
        if (targetId != "alertIndexok" && targetId != "tbxActiveStockNum" && targetId != "alertCrossIndex" && targetId != 'replacePopupYes'
        && targetId != 'replacePopupNo' && targetId != 'replacePopup' && targetClass != "ui-corner-all") {
            if (StockNum != "") {
                $.ajax({
                    url: "./../Scenario/GetVehilceID", type: "POST",
                    data: { StockNum: StockNum },
                    success: function (Result) {
                        if (Result.VehicleID == "") {
                            if ($('#HiddenStockNum').val() != null) {
                                var prevStockNUm = $('#HiddenStockNum').val();
                                var stockValue = prevStockNUm.replace('*', '');
                                $("#tbxActiveStockNum").val(stockValue);
                                $("#tbxStockNum1").val(stockValue);
                            }
                        }
                    },
                    error: function (result) {
                    }
                });
            }
        }
        else {
            setTimeout(function () {
                $("#tbxActiveStockNum").val(StockNum);
                $("#tbxStockNum1").val(StockNum2);
            }, 500);
        }
    }
});

$('#rate,#item_Rates').live('keypress', function (event) {
    var status = (validatedecimaluserdefined(event, this, 3, 4));
    return status;
});

$("#rate,#item_Rates,").live("focusin", function (event) {
    var val = $(this).val();
    var percentindex = val.indexOf('%');
    if (percentindex != -1) {
        val = val.substr(0, percentindex);
    }
    $(this).val(val);
    $('#hiddenRateValue').val(val);
});

$("#rate,#item_Rates").live("focusout", function (event) {
    var val = $(this).val();
    if (val >= 0 && val <= 100) {
        val = val + "%";
        if (val.indexOf('%') == 0) {
            val = "0.0" + "%";
        }
        $(this).val(val);
    }
    else {
        $("#hiddenpercentinvalid").val(event.target.id);
        centrpop('#popupContactDelete');
        popupload('#backgroundPopupDelete', '#popupContactDelete');
        return;
    }
});

$('#item_DownPayment').bind('keypress', function (event) {
    return (validatedecimaluserdefined(event, this, 10, 2));
});

$('#item_Rebates').bind('keypress', function (event) {
    if (event.keyCode == 13) {
        RebatesOnChange();
    }
});

$("input:button[name=EditFinance]").click(function () {
    var URL = "";
    var DetailsYesNo = 'Yes';
    var id = this.id;
    //Change Order 15535:  03.02.FRD005 Create Scenario - Remove option to change finance type

    //if (id == "btnYesCopyNewScenario") {
    //    URL = './../Scenario/SaveScenario';
    //}
    //else
    if (id == "btnNewScenario") {
        URL = './../Scenario/CopytoNewScenario';
        DetailsYesNo = 'No';
    }
    else {
        ClosePopUP('#backgroundPopupChangeFinance', '#propmtchangefina');
        SelectFinanceType($("#OriginalFinType").val());
        popupdisable('#bgPopupfinace', '#popupfinance');
        return false;
    }
    var ScenarioID = $("#HiddenScenarioID").val();
    $.ajax({
        type: 'Post',
        url: URL,
        dataType: 'json',
        data: {
            ScenarioID: ScenarioID,
            FinanceType: $("#HiddenFinanceID").val()
        },
        success: function (result) {
            ClosePopUP('#backgroundPopupChangeFinance', '#propmtchangefina');
            popupdisable('#bgPopupfinace', '#popupfinance');
            if (id == "btnNewScenario")
                window.location.href = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + result.scenarioID;
            else
                RedirectToScenario(ScenarioID, DetailsYesNo)
        },
        error: function (error) {
        }
    });
});

$('input[name=selectvalue]').change(function () {
    centrpop('#propmtchangefina');
    popupload('#backgroundPopupChangeFinance', '#propmtchangefina');
    $('#HiddenFinanceID').val(this.id);
    $('#contactAreaChangeFinance').hide();
});

$('#drop_LenderType').change(function () {
    var selectedValue = $(this).val();
    var currentFinance = $('#hidden_finance').val();
    if (currentFinance != "3") {
        centerPopuplender();
        loadPopuplender();
    } else {
        centerPopupLease();
        loadPopupLease();
    }
});

$("#dealtypechangebtnYes").click(function () {
    var ScenarioId = $('#HiddenScenarioIdfordealtypechange').val();
    EnableDisableCobuyer('');
    UpdateScenarioDetails($('#HiddenControlvalue').val(), ScenarioId, "CustType");
    ClosePopUP('#backgroundDealTypeChangeDiv', '#DealTypeChangeDiv');
});

$("#dealtypechangebtnCancel,#DealTypeChangeDivContclose").click(function () {
    ClosePopUP('#backgroundDealTypeChangeDiv', '#DealTypeChangeDiv');
    $('#DDLCustomerType').val($('#HiddenDealtypeValue').val());

});
//Bug 18842: CO.025.03.02. Customer Quote - Preliminary amounts for Trade Allowance and Payoff
$("#item_MSRP,#tbxpriceActiveScen,#tbxAPR,#tbxDownPaymentActive,#tbxDownPaymentCash,#tbxDownPaymentFinance,#tbxDownPaymentBalloon,#item_TradeAllowance,#item_TradePayoff,#item_Rebates,#tbxpCapCost").live("keypress", function (event) {
    return (validatedecimaluserdefined(event, this, 10, 2));
});

$("#item_Terms").live('keypress', function (event) {
    if (event.keyCode == '46' || event.keyCode == '39') {
        return false;
    }
    else {
        return (ValidateNumericLength(event, this, 10));
    }
});

$(".popupContactClose").click(function () {
    popupdisable('#backgroundsearch', '#DivPopUp');
    var DetailsYesNo = $('#HiddenDetailsYesNo').val();
    var ScenarioID = $('#HiddenScenID').val();
    RedirectToScenario(ScenarioID, DetailsYesNo);
});

$(".popupContractCode").click(function () {
    var DetailsYesNo = $('#HiddenDetailsYesNo').val();
    var ScenarioID = $('#HiddenScenID').val();
    RedirectToScenario(ScenarioID, 'Yes');
    popupdisable('#backgroundsearch', '#DivChangeLenderPopUp');
});

$(".popupContactClose").click(function () {
    var DetailsYesNo = $('#HiddenDetailsYesNo').val();
    var ScenarioID = $('#HiddenScenID').val();
    RedirectToScenario(ScenarioID, DetailsYesNo);
    popupdisable('#backgroundsearch', '#DivPopUp');
});

$(".popCloseApprisal").click(function () {
    popupdisable('#bg_apprisal', '#popApprisal');
});

$('#YesLender').click(function () {
    popupdisable('#bg_divInactiveLender', '#divInactiveLender');
    $('#hiddeninactivelenderCheck').val('1');
    $("#delivered_deal").click();
});

$('#btn_RefreshfeesYes').click(function () {
    $.ajax({
        url: "./../FeesAndTax/ApplyChangesToFeesAndTaxes",
        type: 'Post',
        cache: false,
        success: function (result) {
            popupdisable('#IndexalertRefreshFees', '#IndexbgalertRefreshFees');
            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
            RedirectToScenario(ScenarioID, 'Yes');
        },
        error: function (error) {

        }
    });
});

$('.RefreshCustomerYesbtn').click(function (e) {
    var deskstatus = $('#HiddenDeskStatus').val();
    var CustID = $('#CustomerIDIndex').val();
    var URL = './../CoBuyerSearch/ApplyChangesToCustomer?CustomerID=' + CustID;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {

            popupdisable('#IndexalertRefreshCustomer', '#IndexbgalertRefreshCustomer');
            $('#Label_RefreshCustomer').val('');
            $('#IndexrefreshCustomer_message').hide();
        }
    });
});

$('.RefreshAfterMarket').click(function (e) {
    $.ajax({
        url: "./../AfterMarket/ApplyChangesToAfterMarket",
        type: 'Post',
        cache: false,
        success: function (result) {
            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    popupdisable('#IndexalertRefreshAfterMarket', '#IndexbgalertRefreshAfterMarket');
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
            RedirectToScenario(ScenarioID, 'Yes');
        },
        error: function (error) {

        }
    });
});

$('.RefreshServiceContract').click(function (e) {
    $.ajax({
        url: "./../ServiceContract/ApplyChangesToServiceContract",
        type: 'Post',
        cache: false,
        success: function (result) {
            popupdisable('#IndexalertRefreshServiceContract', '#IndexbgalertRefreshServiceContract');
            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    popupdisable('#alertRefreshAfterMarket', '#bgalertRefreshAfterMarket');
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
            RedirectToScenario(ScenarioID, 'Yes');
        },

        error: function (error) {

        }
    });
});

$('#btn_RefreshINSYes').click(function () {
    $.ajax({
        url: "./../ViewEditInsurance/RefreshInsuranceCompany",
        type: 'Post',
        cache: false,
        success: function (result) {
            popupdisable('#IndexalertRefreshInsurance', '#IndexbgalertRefreshInsurance');
            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {

                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
            RedirectToScenario(ScenarioID, 'Yes');
        },
        error: function (error) {

        }
    });
});

$('#btn_RefreshYesRebates').click(function (e) {
    $('#RebatesChangesInProgress').show();
    $.ajax({
        url: "./../Rebate/ApplyChangesToRebates",
        type: 'Post',
        cache: false,
        data: {
            IsGrossRebate: "No"
        },
        success: function (result) {
            popupdisable('#alertRefreshRebates', '#alertPOp_rebate');
            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    popupdisable('#IndexalertRefreshRebates', '#IndexalertPOp_rebate');
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;

                    }
                    RedirectToScenario(ScenarioID, 'Yes');
                }
            });

        },
        error: function (error) {

        }
    });
});

$('.RefreshLein').click(function (e) {
    $.ajax({
        url: "./../Lienholder/ApplyChangesToLien",
        type: 'Post',
        cache: false,
        success: function (result) {
            popupdisable('#IndexalertRefreshLein', '#IndexbgalertRefreshLein');

            var ScenarioID = $('#HiddenScenarioID').val();
            var financetype = 0;
            $.ajax({
                type: 'Post',
                url: './../Scenario/GetFinance',
                datatype: "JSON",
                data: { ScenarioID: ScenarioID },
                success: function (result) {
                    popupdisable('#IndexalertRefreshLein', '#IndexbgalertRefreshLein');
                    financetype = result.result;
                    switch (financetype) {
                        case 1: AjaxCalcCallForFinance(ScenarioID);
                            break;
                        case 3: AjaxCalcCallForLease(ScenarioID);
                            break;
                        case 4: AjaxCalcCallForBalloon(ScenarioID);
                            break;
                    }
                }
            });
            RedirectToScenario(ScenarioID, 'Yes');
        },
        error: function (error) {

        }
    });
});

$("#popupContactClose").click(function () {
    disablePopupcreatefscenario();
    var DetailsYesNo = $('#HiddenDetailsYesNo').val();
    var ScenarioID = $('#HiddenScenID').val();
    RedirectToScenario(ScenarioID, DetailsYesNo);
});

$('#DivActiveScenario li input:not([readonly="readonly"])').each(function () {
    $(this).parent().css('background-color', '#999');
    $(this).focus(function () {
        $(this).parent().css('background-color', '#fff');
    });
    $(this).blur(function () {
        $(this).parent().css('background-color', '#999');
    });
});

$('#DivActiveScenario li input[readonly="readonly"]').each(function () {
    $(this).parent().css('background-color', '#444');
});

$("#BasicSearchData tr").click(function () {
    var id = $(this).find(".hiddenid").text();
    var URL = './../CoBuyerSearch/GetCustomerResults?id=' + id;
    $.ajax({
        type: 'Post',
        url: URL,
        success: function (result) {
            centerPopup();
            loadPopup();
            $("#contactArea").html(result);
        },
        error: function (error) {
        }
    });
});

$('#AddApprisal1').live("click", function (e) {
    var final = '';
    var scenarioid = $('#ScenarioID').val();
    $('input[name=chkbox]:checked').each(function () {
        var values = $(this).val();
        final += values + " , ";
    });
    var URL = './../SearchAppraisal/FiSenarioApprisal';
    $.ajax({
        type: 'Post',
        url: URL,
        data: {
            AppriID: final
        },
        success: function (ViewModel) {
            $('#bg_apprisal , #popApprisal').hide();
            $.ajax({
                type: "POST",
                url: "./../TradeIn/Display",
                success: function (ViewModel) {
                    $("#viewEditContactArea").html(ViewModel);
                    centrpop('#DivPopUp');
                    popupload('#backgroundsearch', '#DivPopUp');
                    popupStatus = 1;
                }
            });
        },
        error: function (error) {
        }
    });
});

$('#AddApprisal').live("click", function (e) {
    var final = "";
    var ScenarioID = document.getElementById('HiddenScenarioID').value;
    $('input[name=chkbox]:checked').each(function () {
        var values = $(this).val();
        final += values + " , ";
    });
    if (final != "") {
        var ScenarioID = document.getElementById('HiddenScenarioID').value;
        var URL = './../SearchAppraisal/FiSenarioApprisal';
        $.ajax({
            type: 'Post',
            url: URL,
            data: {
                AppriID: final
            },
            success: function (result) {
                if (result.Msg == "duplicate") {
                    ShowTradeAlertMessagex("Same vehicle is already attached.");
                }
                var ScenarioID = $('#HiddenScenarioID').val();
                var DetailsYesNo = $('#HiddenDetailsYesNo').val();
                $.ajax({
                    type: "POST",
                    url: "./../TradeIn/Display?ScenarioID=" + ScenarioID + "&DetailsYesNo=" + DetailsYesNo,
                    success: function (ViewModel) {
                        if (result.Msg != "duplicate") {
                            $('#bg_apprisal').hide();
                        }
                        $('#popApprisal').hide();

                        $("#viewEditContactArea").html(ViewModel);
                        var r = $("#viewEditContactArea").find('input:not([disabled="disabled"]),select:not([disabled="disabled"]),button').filter(':not([readonly="readonly"]):visible:first');
                        r.focus();
                        $("#Complete").keydown(function (e) {
                            var t = e.keyCode ? e.keyCode : e.which;
                            if (t == 9) {
                                e.preventDefault();
                                r.focus();
                            }
                        });
                    }
                });
            },
            error: function (error) {
            }

        });
    }
    else {
        $('#AddApprisal').after("<div class='msgDiv' style='color: red; position: absolute; bottom: 15px; left: 135px;'>Please select at least one Vehicle from the table.</div>");
        $('.msgDiv').animate({
            opacity: 1
        }, 3000, function () {
            $('.msgDiv').fadeOut(1000);
        });
    }
});

$(".TradeinLink").click(function () {
    $.ajax({
        type: "POST",
        url: "./../TradeIn/Display",
        success: function (ViewModel) {
            $("#viewEditContactArea").html(ViewModel);
            centrpop('#DivPopUp');
            popupload('#backgroundsearch', '#DivPopUp');
        }
    });
});

$(".FeesAndTaxes").click(function () {
    $.ajax({
        type: "POST",
        url: "./../FeesAndTax/FeeAndTax",
        success: function (viewModel) {
            $("#viewEditContactArea").html(viewModel);
            centrpop('#DivPopUp');
            popupload('#backgroundsearch', '#DivPopUp');
            $("#DivPopUp").removeClass("popTradeIn");
            $("#DivPopUp").removeClass("DivPopUpFeesAndTaxes");
            $("#DivPopUp").css("left", "5px");
        }
    });
});

$(".ServiceContract").click(function () {
    $.ajax({
        type: "POST",
        url: "./../ServiceContract/ServiceContractdetails",
        success: function (viewcontract) {
            $("#viewEditContactArea").html(viewcontract);
            centrpop('#DivPopUp');
            popupload('#backgroundsearch', '#DivPopUp');
        }
    });
});

$("#DealJacket").click(function () {
    $.ajax({
        type: "POST",
        url: "./../Scenario/GenerateXMLDocument",
        success: function (viewcontract) {
        }
    });
});

$("#alertTermok, #alertCrossTerm").click(function () {
    popupdisable('#alert_term', '#alertPOp_term');
    $('#tbxTerms').val($("#hiddenterms").val());
    $('#tbxTerms').focus();
});

$("#alertIndexok, #alertCrossIndex").click(function () {
    popupdisable('#alert_index', '#alertPOp_index');
    popupdisable('#alert_index', '#bg_apprisal');
    if ($('#HiddenStockEntered').val() != '' && $('#HiddenStockEntered').val() != undefined) {
        $("#tbxActiveStockNum,#tbxStockNum1").focus();
        $("#tbxActiveStockNum,#tbxStockNum1").val($('#HiddenStockEntered').val());
        $("#tbxActiveStockNum").css('background-color', '#fff');
        $("#tbxActiveStockNum").removeClass('ui-autocomplete-loading');
    }

});

$("#alertokDelivered, #alertDeliveredCross").click(function () {
    popupdisable('#alertDelivered', '#alertPOpDelivered');
    var ScenarioID = $('#HiddenScenarioID').val();
    var URL = './../Scenario/Index?DID=' + document.getElementById('hiddenDeskID').value + '&SID=' + ScenarioID;
    window.location.href = URL;
});

$("#create_deal").click(function () {
    $.ajax({
        type: "POST",
        url: "./../Scenario/CheckCustomerandVehicleForDeal",
        success: function (result) {
            if (result.success == "Exist") {

            }
            else if (result.success == "CustNonExist") {
                ShowAlertMessageIndex("A Deal cannot be created without a valid Customer number.  Please add or select an existing customer and try again.");
            }
            else if (result.success == "StockNonExist") {
                ShowAlertMessageIndex("A Deal cannot be created without an In-stock Vehicle that is available for sale.  Please select a vehicle and try again.");
            }
            else if (result.success == "DealerGroupStatus") {
                ShowAlertMessageIndex("A Deal cannot be created without DealerGroup Status for Vehicle.  Please select a vehicle and try again.");
            }
            else if (result.success == "VehicleReserved") {
                ShowAlertMessageIndex("Stock number " + result.Stock + " has already been attached to deal number " + result.DealNumber + " by " + result.UserID + ". Please select another vehicle.");
            }
            else if (result.success == "fail") {
                ShowAlertMessageIndex("Can't select a vehicle with Dealer Group Status as Customer Reserved.");
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "./../Scenario/CreateDeal",
                    success: function (result) {
                        var ScenarioID = $("#HiddenScenarioID").val();
                        RedirectToScenario(ScenarioID, "Yes");
                        $("#create_deal").hide();
                        $("#unwind_deal").show();
                        $("#econtract_deal").show();
                        $("#audittrail_deal").show();
                        $("#cancel_deal").show();
                        if (result.DealNumber != 0 && result.DealNumber != null) {
                            var LableName = result.DeskStatus + " " + result.DealNumber + " " + result.DealFinanceType;
                            $("#Label_Title").text(LableName);
                        }
                    }
                });
            }
        }
    });
});

$("#bookout_deal").click(function () {
    var url = "./../BookOutDeal/BookOutDeal";
    window.location.href = url;
});

$("#cancel_deal").live("click", function () {
    centrpop('#alertCancelDeal');
    popupload('#backgroundDeal', '#alertCancelDeal');
});

$("#cancel_deal_Yes").live("click", function () {
    $("#cancel_deal").attr("disabled", "disabled");
    var deskstatus = $("#HiddenDeskStatus").val();
    var scenariostatus = $("#HiddenScenarioStatus").val();
    $.ajax({
        type: "POST",
        url: "./../Scenario/CancelDeal",
        data: {
            DeskStatus: deskstatus,
            ScenarioStatus: scenariostatus
        },
        success: function (result) {
            var ScenarioID = $("#HiddenScenarioID").val();
            RedirectToScenario(ScenarioID, "Yes");
            $('#MainDiv1').attr('disabled', 'disabled');
            $('#MainDiv2').attr('disabled', 'disabled');

            if (result.DealNumber != 0 && result.DealNumber != null) {
                var LableName = result.DeskStatus + " " + result.DealNumber + " " + result.DealFinanceType;
                $("#Label_Title").text(LableName);
            }
        },
        error: function (result) {
            $("#cancel_deal").removeAttr("disabled", "disabled");
        }
    });
    disablePopupConfirmation('#backgroundDeal', '#alertCancelDeal');
});

$("#delivered_deal").click(function () {
    $.ajax({
        type: "POST",
        url: "./../Scenario/CheckProcessCompleteForCancelDealInAX",
        success: function (result) {
            if (result.success) {
                $("#delivered_deal").attr("disabled", "disabled");
                var deskstatus = $("#HiddenDeskStatus").val();
                var scenariostatus = $("#HiddenScenarioStatus").val();
                $('#CalculationInProgress').show();
                $.ajax({
                    type: "POST",
                    url: "./../Scenario/UpdateDealStatusToDeliverDeal",
                    data: {
                        LenderCheck: $('#hiddeninactivelenderCheck').val()
                    },
                    success: function (result) {
                        $('#CalculationInProgress').hide();
                        if (result.Success == true) {
                            if (result.MSG != '') {
                                $('#alertok, #alertIndexok').removeAttr("disabled", "disabled");
                                ShowAlertMessageIndex("Deal Successful, AX Deal Number : " + result.MSG);
                            }
                            var ScenarioID = $("#HiddenScenarioID").val();
                            $('#HiddenScenDetailsLoad').val('1');
                            RedirectToScenario(ScenarioID, "Yes");
                            $("#delivered_deal").hide();
                            if (result.IsPending == true || result.WaitOnProcessComplete == true) {
                                $("#unwind_deal").attr("disabled", "disabled");
                                $("#unwind_deal").hide();
                            }
                            else {
                                $("#unwind_deal").show();
                            }
                            if (result.DealNumber != 0 && result.DealNumber != null) {
                                var DeskStatus = result.DeskStatus;
                                if (result.IsPending == true || result.WaitOnProcessComplete == true) {
                                    DeskStatus = "Pending Deliver Deal";
                                }
                                var LableName = DeskStatus + " " + result.DealNumber + " " + result.DealFinanceType;
                                $("#Label_Title").text(LableName);
                            }
                            //Sending RDR data to OEM
                            $.ajax({
                                type: 'Post',
                                url: './../Scenario/SendingDataToRDR',
                                success: function (result) {
                                    if (result.IsPending == false && result.WaitOnProcessComplete == false) {
                                        if (result.Response == "") {
                                            $("#Span_RDR").hide();
                                        }
                                        else {
                                            $("#Span_RDR").show();
                                            if (result.Response == "Failed") {
                                                $("#Label_Title_RDR").html("RDR Failed");
                                                $('#Label_Title_RDR').css('color', 'red');
                                            }
                                            else if (result.Response == "Success") {
                                                $("#Label_Title_RDR").html("RDR Successful");
                                                $('#Label_Title_RDR').css('color', 'white');
                                            }
                                            else {
                                                $("#Span_RDR").show();
                                                $("#Label_Title_RDR").html("RDR In Progress");
                                                $('#Label_Title_RDR').css('color', 'white');
                                            }
                                        }
                                    }
                                },
                                error: function (error) {
                                }
                            });
                        }
                        else {
                            if (result.MSG == 'GLBALANCE') {
                                result.MSG = "The selling vehicle has a zero GL Balance and cannot be Delivered.  Please resolve this issue in the DMS and try again.";
                            }
                            else if (result.MSG == 'VehicleStatus') {
                                result.MSG = "The selling vehicle must be in Posted/Stock status to deliver the deal. Please stock the vehicle in the DMS and try again.";
                            }
                            else if (result.MSG == 'DealerGroupStatus') {
                                result.MSG = "The selling vehicle must be in Posted/Stock status to deliver the deal. Please stock the vehicle in the DMS and try again.";
                            }
                            else if (result.MSG == 'DealerGroupStatus_Demo') {
                                result.MSG = "The selling vehicle is in Demo status. Please move the vehicle from Demo to Stock in the DMS and try again.";
                            }
                            else if (result.MSG == 'DMSCustomerNumber') {
                                result.MSG = "The customer assigned to the deal does not have a valid DMS id. Please contact your system administrator.";
                            }
                            else if (result.MSG == 'CobuyerDMSCustomerNumber') {
                                result.MSG = "The Cobuyer assigned to the deal does not have a valid DMS id. Please contact your system administrator.";
                            }
                            else if (result.MSG == 'TradeinInInventory') {
                                result.MSG = "Trade-in vehicle VIN is already in inventory. The duplicate VIN issue must be resolved before this deal can be Delivered .";
                            }
                            else if (result.MSG == 'LenderInactive') {
                                result.MSG = "The Lender is inactive. Would you like to continue?";
                                $("#lblLender").text(result.MSG);
                                centrpop('#divInactiveLender');
                                popupload('#bg_divInactiveLender', '#divInactiveLender');
                                $('#YesLender , #CancelLender').removeAttr("disabled", "disabled");
                                $("#delivered_deal").removeAttr("disabled", "disabled");
                                return;
                            }
                            else if (result.MSG == "dealershipfeeANDcost") {
                                result.MSG = result.FieldName + " zero cost. Please enter a cost or modify the Fee's Vendor ID and try again.";
                                result.MSG1 = result.FieldName1 + " cost cannot be greater than zero.Please  modify the Fee's Vendor ID or cost."
                                result.MSG = result.MSG + "<br/>" + result.MSG1;

                            }
                            else if (result.MSG == "DealershipImposedfees") {
                                result.MSG = result.FieldName + " zero cost. Please enter a cost or modify the Fee's Vendor ID and try again.";

                            }
                            else if (result.MSG == "delaershipfeecost") {
                                result.MSG = result.FieldName + " cost cannot be greater than zero.Please  modify the Fee's Vendor ID or cost."

                            }
                            ShowAlertMessageIndex(" " + result.MSG);
                            $('#alertok, #alertIndexok').removeAttr("disabled", "disabled");
                            $("#delivered_deal").removeAttr("disabled", "disabled");
                        }
                    },
                    error: function (result) {
                        $('#CalculationInProgress').hide();
                        $("#delivered_deal").removeAttr("disabled", "disabled");
                    }
                });
            }
            else {
                ShowAlertMessageIndex("This unwind process for this deal is still in progress in the DMS. Please wait and try again later.");
            }
        }
    });

});

$("#unwind_deal").click(function () {
    var ScenarioID = $("#HiddenScenarioID").val();
    var CurrentStatus = "";
    var UnwindStatus = "";
    $.ajax({
        type: "POST",
        url: "./../Scenario/GetScenarioStatus?id=" + ScenarioID,
        success: function (result) {
            CurrentStatus = result.Status;
            if (CurrentStatus == "Open Deal") {
                UnwindStatus = "Scenario";
                $('#HiddenScenarioStatus').val('Scenario')
            }
            else if (CurrentStatus == "Contracting Deal")
                UnwindStatus = "Open Deal";
            else if (CurrentStatus == "Delivered Deal")
                UnwindStatus = "Contracting Deal";
            else if (CurrentStatus == "Rejected Deal")
                UnwindStatus = "Contracting Deal";
            else if (CurrentStatus == "Rejected Posted Deal")
                UnwindStatus = "Contracting Deal";
            else if (CurrentStatus == "Rejected Closed Deal")
                UnwindStatus = "Delivered Deal";
            else if (CurrentStatus == "Closed Deal")
                UnwindStatus = "Delivered Deal";

            if (CurrentStatus == "Delivered Deal") {
                $.ajax({
                    type: 'Post',
                    url: "./../Scenario/CheckTradeinInAnotherDeal",
                    success: function (result) {
                        if (result.success) {
                            var message = "This deal will be unwound from " + CurrentStatus + " to " + UnwindStatus + " status. Would you like to continue?";
                            $("#lblUnwind").text(message);

                            $("#btnYesUnwind").removeAttr("disabled", "disabled");
                            $("#BtnCancelUnwind").removeAttr("disabled", "disabled");
                            centrpop('#popupContact_unwind');
                            popupload('#backgroundPopupUnwind', '#popupContact_unwind');
                        }
                        else {
                            var Dealnumber = result.DealNumber;
                            var message = "The trade-in vehicle has already been contracted.  The deal number " + Dealnumber + " must be unwound before you can proceed."
                            ShowAlertMessageIndex(message);
                            return false;
                        }
                    },
                    error: function (result) {
                    }
                });
            }
            else {
                var message = "This deal will be unwound from " + CurrentStatus + " to " + UnwindStatus + " status. Would you like to continue?";
                $("#lblUnwind").text(message);
                $("#btnYesUnwind").removeAttr("disabled", "disabled");
                $("#BtnCancelUnwind").removeAttr("disabled", "disabled");
                centrpop('#popupContact_unwind');
                popupload('#backgroundPopupUnwind', '#popupContact_unwind');
            }

        }
    });
});

$("#BtnCancelUnwind").click(function () {
    var financetype = $("#HiddenFinanceTypeStr").val();
    if (financetype == "Lease") {
        $("#tbxCapitalCost").focus();
    }
    else {
        $("#tbxSalesPrice").focus();
    }
    popupdisable('#backgroundPopupUnwind', '#popupContact_unwind');
});

$("#btnYesUnwind").click(function () {
    popupdisable('#backgroundPopupUnwind', '#popupContact_unwind');
    $('#hiddeninactivelenderCheck').val('');
    $('#hiddeninactivelenderCheckBC').val('');
    $.ajax({
        type: "POST",
        url: "./../Scenario/UnWindDeal",
        success: function (result) {
            if (result.success) {

                var ScenarioID = $("#HiddenScenarioID").val();
                $('#HiddenScenDetailsLoad').val('1');
                RedirectToScenario(ScenarioID, "Yes");
                var deskstatus = result.DeskStatus;
                var scenariostatus = result.ScenarioStatus;
                if (result.NewDeskStatus == "Open Deal" || result.NewDeskStatus == "Scenario") {
                    $('.RightDropdown option').eq(3).remove();
                    $("#InactiveLenderOK").removeAttr("disabled");
                    $("#btn_RefreshLenderYes").removeAttr("disabled");
                    $("#btn_RefreshLenderNo").removeAttr("disabled");
                    $("#tbxDeskName").removeAttr("disabled");
                    var URL = "./../CobuyerSearch/GetPartyName";
                    $.ajax({
                        type: 'Post',
                        url: URL,
                        success: function (Result) {
                            if (Result.Party == "Person") {
                                var msg = 'Retail';
                                $("#DDLCustomerType option:contains(" + msg + ")").attr('selected', 'selected');
                                $("#DDLCustomerType").attr("disabled", "disabled");
                            }
                            else {
                                $("#DDLCustomerType").removeAttr("disabled", "disabled");
                                $("#dealtypechangebtnYes").removeAttr("disabled", "disabled");
                                $("#dealtypechangebtnCancel").removeAttr("disabled", "disabled");
                            }
                        },
                        error: function (result) {
                        }
                    });
                }
                if (deskstatus == "Open Deal" && scenariostatus == "Open Deal") {
                    $("#create_deal").show();
                    $("#create_deal").removeAttr("disabled", "disabled");
                    $("#btn_RefreshLenderYes").removeAttr("disabled");
                    $("#btn_RefreshfeesYes").removeAttr("disabled");
                    $('.RefreshAfterMarket').removeAttr("disabled");
                    $("#btn_RefreshYes").removeAttr("disabled");
                    $('.RefreshServiceContract').removeAttr("disabled");
                    $("#btn_RefreshINSYes").removeAttr("disabled");
                    $("#btn_RefreshYesRebates").removeAttr("disabled");
                    $('.RefreshLein').removeAttr("disabled");
                    $('.RefreshCustomerYesbtn').removeAttr("disabled");
                    $("#unwind_deal").hide();
                    $("#econtract_deal").hide();
                    $("#audittrail_deal").hide();
                    $("#cancel_deal").hide();
                }
                else if (deskstatus == "Contracting Deal" && scenariostatus == "Contracting Deal") {
                    $("#create_deal").hide();
                    $("#delivered_deal").hide();
                    $("#unwind_deal").show();
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    $("#btn_RefreshLenderYes").removeAttr("disabled");
                    $("#btn_RefreshfeesYes").removeAttr("disabled");
                    $('.RefreshAfterMarket').removeAttr("disabled");
                    $("#btn_RefreshYes").removeAttr("disabled");
                    $('.RefreshServiceContract').removeAttr("disabled");
                    $("#btn_RefreshINSYes").removeAttr("disabled");
                    $("#btn_RefreshYesRebates").removeAttr("disabled");
                    $('.RefreshLein').removeAttr("disabled");
                    $('.RefreshCustomerYesbtn').removeAttr("disabled");
                    $("#econtract_deal").show();
                    $("#econtract_deal").removeAttr("disabled", "disabled");
                    $("#econtract_deal").removeClass('disableLinkUnwind');
                    $("#audittrail_deal").show();
                    $("#audittrail_deal").removeAttr("disabled", "disabled");
                    $("#cancel_deal").show();
                    $("#cancel_deal").removeAttr("disabled", "disabled");
                    $("#alertok, #alertIndexok").removeAttr("disabled", "disabled");
                    document.getElementById("error_message").style.display = "none";
                    if (result.NewDeskStatus == "Open Deal" || result.NewDeskStatus == "Scenario")
                        $("#Span_RDR").hide();
                    else {
                        if (result.RDRStatus != "") {
                            $("#Span_RDR").show();
                            $('#Label_Title_RDR').css('color', 'white');
                            $("#Label_Title_RDR").html("Cancel RDR In Progress");
                        }
                    }
                }
                else if (deskstatus == "Delivered Deal" && scenariostatus == "Delivered Deal") {
                    document.getElementById("error_message").style.display = "none";
                    $("#create_deal").hide();
                    $("#delivered_deal").show();
                    $("#unwind_deal").show();
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    $("#alertok, #alertIndexok").removeAttr("disabled", "disabled");
                }
                else if (deskstatus == "Rejected Deal" && scenariostatus == "Rejected Deal") {
                    document.getElementById("error_message").style.display = "none";
                    $("#create_deal").hide();
                    $("#unwind_deal").show();
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    $("#econtract_deal").hide();
                    $("#audittrail_deal").hide();
                    $("#cancel_deal").hide();
                    $("#delivered_deal").show();
                    $("#alertok, #alertIndexok").removeAttr("disabled", "disabled");
                }
                else if (deskstatus == "Rejected Posted Deal" && scenariostatus == "Rejected Posted Deal") {
                    document.getElementById("error_message").style.display = "none";
                    $("#create_deal").hide();
                    $("#unwind_deal").show();
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    $("#econtract_deal").hide();
                    $("#audittrail_deal").hide();
                    $("#cancel_deal").hide();
                    $("#delivered_deal").show();
                    $("#alertok, #alertIndexok").removeAttr("disabled", "disabled");
                }
                else if (deskstatus == "Rejected Closed Deal" && scenariostatus == "Rejected Closed Deal") {
                    $("#create_deal").hide();
                    $("#unwind_deal").show();
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    document.getElementById("error_message").style.display = "none";
                    $("#econtract_deal").hide();
                    $("#audittrail_deal").hide();
                    $("#cancel_deal").hide();
                    $("#delivered_deal").hide();
                }
                else if (deskstatus == "Posted Deal" || deskstatus == "Closed Deal") {
                    $("#create_deal").hide();
                    $("#unwind_deal").show();
                    $("#unwind_deal").removeAttr("disabled", "disabled");
                    document.getElementById("error_message").style.display = "none";
                    $("#econtract_deal").hide();
                    $("#audittrail_deal").hide();
                    $("#cancel_deal").hide();

                }
                if (result.DealNumber != 0 && result.DealNumber != null) {
                    var LableName = result.NewDeskStatus + " " + result.DealNumber + " " + result.DealFinanceType;
                    $("#Label_Title").text(LableName);
                }
            }
        }
    });
});

$("#audittrail_deal").click(function () {
    $.ajax({
        type: "POST",
        url: "./../Scenario/EContractDeal",
        success: function (result) {

            if (result.Success == false) {
                if (result.SectionName == "Customer") {
                    CustomerValidations(result.CustStatus);
                }
                else if (result.SectionName == "Vehicle") {
                    VehicleValidation(result.FieldName);
                }
                else if (result.SectionName == "Lender") {
                    LenderValidation(result.FieldName);
                }
                else if (result.SectionName == "DealType") {
                    ShowAlertMessageIndex("DealType field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "Insurance") {
                    ShowAlertMessageIndex("Insurance field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "TradeIn") {
                    TradeInValidations(result.FieldName);
                }
                else if (result.SectionName == "Rebate") {
                    ShowAlertMessageIndex("Rebate field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "ServiceContract") {
                    ServiceContractValidations(result.FieldName);
                }
                else if (result.SectionName == "Fees") {
                    ShowAlertMessageIndex("Fees field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "Tax") {
                    ShowAlertMessageIndex("Tax field for active section failed validation. Please update the section.");
                }
                else if (result.SectionName == "Status") {
                    ShowAlertMessageIndex(result.FieldName + " section status is not complete. Please update the section.");
                }
                else if (result.SectionName == "Finance") {
                    if (result.FieldName == "Miscellaneous") {
                        ShowAlertMessageIndex("Miscellaneous section is in progress.  Please complete this section and try again.");
                    }
                    else if (result.FieldName == "MSRP") {
                        ShowAlertMessageIndex("MSRP section is in progress.  Please complete this section and try again.");
                    }
                    else {
                        ShowAlertMessageIndex("The following fields failed validation :</br> " + result.FieldName);
                    }
                }
            }
            else if (result.Success == true) {
                ShowAlertMessageIndex("Validation Successful.");
            }
        }
    });
});

$("#econtract_deal").click(function () {
    var fintype = $('#HiddenActivScenarioFinanceType').val();
    CallEContract();
});

//Added by Shalu David on 9/25/13 for Task 11519
$("#btnYes_Deal1").click(function () {
    disablePopupConfirmation("#backgroundDeal1", "#printFormsDeal");
    //Modified by Shalu David as per Geoffrey on 10/02/13 for Task 11519
    var url = $('#HiddenFormsURL').val() + '?Deal=' + $('#HiddenDealNumber').val();
    window.location.href = url;
});

var j = jQuery.noConflict();

var chkstcknum;
function GetAutoforStock(control, DetailsYesNo, ScenarioID) {
    j("#" + control.id).css('background-color', '#fff');
    j("#tbxActiveStockNum").css('color', '#000');
    var prevval = j("#" + control.id).val();
    j("#" + control.id).live("keypress", function (event) {
        chkstcknum != null ? chkstcknum.abort() : "";
        if (event != null || event != undefined) {
            if (event.keyCode === j.ui.keyCode.TAB && j(this).data("autocomplete").menu.active) {
                event.preventDefault();
            }
        }
    })
    j("#" + control.id).autocomplete({
        source: function (request, response) {
            chkstcknum = j.ajax({
                url: "./../Scenario/GetStockNumber",
                type: "POST",
                dataType: "json",
                data: { searchText: request.term, maxResults: 10 },
                complete: function (chkstcknum) {
                    chkstcknum = null;
                    j("#" + control.id).removeClass('ui-autocomplete-loading');
                },
                success: function (data) {
                    if (data.Msg == "Failed") {
                        ShowAlertMessageIndex('No vehicle found matching this stock number. Please try again.');
                    }
                    else {
                        if (data.noResult == "yes") {
                            ShowAlertMessageIndex('No vehicle found matching this stock number. Please try again.');
                        }
                        else {
                            response(j.map(data.listStock, function (listStock) {
                                j("#hiddenvehID").val(listStock.VehicleID);
                                var stocknumber = listStock.StockNumber;
                                if (stocknumber != undefined && stocknumber != null) {
                                    if (stocknumber.indexOf("*") > -1) {
                                        stocknumber = stocknumber.split("*");
                                        stocknumber = stocknumber[1];
                                        stocknumber = stocknumber.split(" ");
                                        stocknumber = stocknumber[0];
                                    }
                                    else {
                                        stocknumber = stocknumber.split(" ");

                                        stocknumber = stocknumber[0];
                                    }
                                }
                                return { label: listStock.StockNumber, value: stocknumber, id: listStock.VehicleID }
                            }))
                        }
                    }
                },
                error: function (error) {
                }
            });
        },
        select: function (event, ui) {
            //Set the value to yes if selected from automocompelete 
            j("#HiddenIsSelected").val('Yes');
            var prevStockNUm = j('#HiddenStockNum').val();
            var ConfirmMsg = "";
            var stk = ui.item.label.split(' ');
            j("#prevvalstck").val(prevval);
            if (prevStockNUm == "")
                ShowAlertVehicle('Are you sure you want to add vehicle to this scenario?', stk[0], ui.item.id, ScenarioID, DetailsYesNo, control);
            else {
                // Bug -- 8428
                if (prevval.toUpperCase() == stk[0].toUpperCase()) {
                    j("#" + control.id).val(prevval);
                    return;
                }
                //End
                ShowAlertVehicle('Would you like to replace the existing vehicle for this scenario?', stk[0], ui.item.id, ScenarioID, DetailsYesNo, control);
            }
        }
    });
}

j(document).ready(function () {
    j('.jcarousel').jcarousel({
        //Settings here.
    });
    j('#MainDiv').show();
    if (j('.jcarousel-item').length < 6) {
        j('.jcarousel-prev').remove();
        j('.jcarousel-next').remove();
        j('#jcarousel').append('<div class="jcarousel-next jcarousel-next-horizontal jcarousel-next-disabled jcarousel-next-disabled-horizontal" style="display: block;" disabled="disabled"></div><div class="jcarousel-prev jcarousel-prev-horizontal jcarousel-prev-disabled jcarousel-prev-disabled-horizontal" style="display: block;" disabled="disabled"></div>');
    }

    var windowHeight = document.documentElement.clientHeight;
    j(".deskingleftcont").css({
        "height": windowHeight - 95
    });
});

$(window).resize(function () {
    centerPopup();
});

